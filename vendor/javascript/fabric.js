function t(d,g,_){return(g=function(d){var g=function(d,g){if("object"!=typeof d||!d)return d;var _=d[Symbol.toPrimitive];if(void 0!==_){var x=_.call(d,g||"default");if("object"!=typeof x)return x;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===g?String:Number)(d)}(d,"string");return"symbol"==typeof g?g:g+""}(g))in d?Object.defineProperty(d,g,{value:_,enumerable:!0,configurable:!0,writable:!0}):d[g]=_,d}function e(d,g){var _=Object.keys(d);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(d);g&&(x=x.filter((function(g){return Object.getOwnPropertyDescriptor(d,g).enumerable}))),_.push.apply(_,x)}return _}function s(d){for(var g=1;g<arguments.length;g++){var _=null!=arguments[g]?arguments[g]:{};g%2?e(Object(_),!0).forEach((function(g){t(d,g,_[g])})):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(_)):e(Object(_)).forEach((function(g){Object.defineProperty(d,g,Object.getOwnPropertyDescriptor(_,g))}))}return d}function i(d,g){if(null==d)return{};var _,x,b=function(d,g){if(null==d)return{};var _={};for(var x in d)if({}.hasOwnProperty.call(d,x)){if(g.indexOf(x)>=0)continue;_[x]=d[x]}return _}(d,g);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(d);for(x=0;x<S.length;x++)_=S[x],g.indexOf(_)>=0||{}.propertyIsEnumerable.call(d,_)&&(b[_]=d[_])}return b}function r(d,g){return g||(g=d.slice(0)),Object.freeze(Object.defineProperties(d,{raw:{value:Object.freeze(g)}}))}class n{constructor(){t(this,"browserShadowBlurConstant",1),t(this,"DPI",96),t(this,"devicePixelRatio","undefined"!=typeof window?window.devicePixelRatio:1),t(this,"perfLimitSizeTotal",2097152),t(this,"maxCacheSideLimit",4096),t(this,"minCacheSideLimit",256),t(this,"disableStyleCopyPaste",!1),t(this,"enableGLFiltering",!0),t(this,"textureSize",4096),t(this,"forceGLPutImageData",!1),t(this,"cachesBoundsOfCurve",!1),t(this,"fontPaths",{}),t(this,"NUM_FRACTION_DIGITS",4)}}const d=new class extends n{constructor(d){super(),this.configure(d)}configure(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,d)}addFonts(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=s(s({},this.fontPaths),d)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((d=>{delete this.fontPaths[d]}))}clearFonts(){this.fontPaths={}}restoreDefaults(d){const g=new n,_=(null==d?void 0:d.reduce(((d,_)=>(d[_]=g[_],d)),{}))||g;this.configure(_)}},a=function(d){for(var g=arguments.length,_=new Array(g>1?g-1:0),x=1;x<g;x++)_[x-1]=arguments[x];return console[d]("fabric",..._)};class h extends Error{constructor(d,g){super("fabric: ".concat(d),g)}}class c extends h{constructor(d){super("".concat(d," 'options.signal' is in 'aborted' state"))}}class l{}class u extends l{testPrecision(d,g){const _="precision ".concat(g," float;\nvoid main(){}"),x=d.createShader(d.FRAGMENT_SHADER);return!!x&&(d.shaderSource(x,_),d.compileShader(x),!!d.getShaderParameter(x,d.COMPILE_STATUS))}queryWebGL(d){const g=d.getContext("webgl");g&&(this.maxTextureSize=g.getParameter(g.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((d=>this.testPrecision(g,d))),g.getExtension("WEBGL_lose_context").loseContext(),a("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(d){return!!this.maxTextureSize&&this.maxTextureSize>=d}}const g={};let _;const f=d=>{_=d},p=()=>_||(_={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new u,dispose(){},copyPasteData:g}),m=()=>p().document,v=()=>p().window,y=()=>{var g;return Math.max(null!==(g=d.devicePixelRatio)&&void 0!==g?g:v().devicePixelRatio,1)};const x=new class{constructor(){t(this,"charWidthsCache",{}),t(this,"boundsOfCurveCache",{})}getFontCache(d){let{fontFamily:g,fontStyle:_,fontWeight:x}=d;g=g.toLowerCase(),this.charWidthsCache[g]||(this.charWidthsCache[g]={});const b=this.charWidthsCache[g],S="".concat(_.toLowerCase(),"_").concat((x+"").toLowerCase());return b[S]||(b[S]={}),b[S]}clearFontCache(d){(d=(d||"").toLowerCase())?this.charWidthsCache[d]&&delete this.charWidthsCache[d]:this.charWidthsCache={}}limitDimsByArea(g){const{perfLimitSizeTotal:_}=d,x=Math.sqrt(_*g);return[Math.floor(x),Math.floor(_/x)]}};const b="6.4.3";function C(){}const S=Math.PI/2,w=2*Math.PI,T=Math.PI/180,O=Object.freeze([1,0,0,1,0,0]),D=16,k=.4477152502,M="center",P="left",E="top",A="bottom",j="right",F="none",L=/\r?\n/,B="moving",R="scaling",X="rotating",W="rotate",Y="skewing",V="resizing",z="modifyPoly",G="modifyPath",N="changed",H="scale",U="scaleX",q="scaleY",K="skewX",Q="skewY",J="fill",Z="stroke",$="modified",tt="json",et="svg";const at=new class{constructor(){this[tt]=new Map,this[et]=new Map}has(d){return this[tt].has(d)}getClass(d){const g=this[tt].get(d);if(!g)throw new h("No class registered for ".concat(d));return g}setClass(d,g){g?this[tt].set(g,d):(this[tt].set(d.type,d),this[tt].set(d.type.toLowerCase(),d))}getSVGClass(d){return this[et].get(d)}setSVGClass(d,g){this[et].set(null!=g?g:d.type.toLowerCase(),d)}};const gt=new class extends Array{remove(d){const g=this.indexOf(d);g>-1&&this.splice(g,1)}cancelAll(){const d=this.splice(0);return d.forEach((d=>d.abort())),d}cancelByCanvas(d){if(!d)return[];const g=this.filter((g=>{var _;return g.target===d||"object"==typeof g.target&&(null===(_=g.target)||void 0===_?void 0:_.canvas)===d}));return g.forEach((d=>d.abort())),g}cancelByTarget(d){if(!d)return[];const g=this.filter((g=>g.target===d));return g.forEach((d=>d.abort())),g}};class st{constructor(){t(this,"__eventListeners",{})}on(d,g){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof d)return Object.entries(d).forEach((d=>{let[g,_]=d;this.on(g,_)})),()=>this.off(d);if(g){const _=d;return this.__eventListeners[_]||(this.__eventListeners[_]=[]),this.__eventListeners[_].push(g),()=>this.off(_,g)}return()=>!1}once(d,g){if("object"==typeof d){const g=[];return Object.entries(d).forEach((d=>{let[_,x]=d;g.push(this.once(_,x))})),()=>g.forEach((d=>d()))}if(g){const _=this.on(d,(function(){for(var d=arguments.length,x=new Array(d),b=0;b<d;b++)x[b]=arguments[b];g.call(this,...x),_()}));return _}return()=>!1}_removeEventListener(d,g){if(this.__eventListeners[d])if(g){const _=this.__eventListeners[d],x=_.indexOf(g);x>-1&&_.splice(x,1)}else this.__eventListeners[d]=[]}off(d,g){if(this.__eventListeners)if(void 0===d)for(const d in this.__eventListeners)this._removeEventListener(d);else"object"==typeof d?Object.entries(d).forEach((d=>{let[g,_]=d;this._removeEventListener(g,_)})):this._removeEventListener(d,g)}fire(d,g){var _;if(!this.__eventListeners)return;const x=null===(_=this.__eventListeners[d])||void 0===_?void 0:_.concat();if(x)for(let d=0;d<x.length;d++)x[d].call(this,g||{})}}const it=(d,g)=>{const _=d.indexOf(g);return-1!==_&&d.splice(_,1),d},rt=d=>{if(0===d)return 1;switch(Math.abs(d)/S){case 1:case 3:return 0;case 2:return-1}return Math.cos(d)},nt=d=>{if(0===d)return 0;const g=d/S,_=Math.sign(d);switch(g){case 1:return _;case 2:return 0;case 3:return-_}return Math.sin(d)};class ot{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof d?(this.x=d.x,this.y=d.y):(this.x=d,this.y=g)}add(d){return new ot(this.x+d.x,this.y+d.y)}addEquals(d){return this.x+=d.x,this.y+=d.y,this}scalarAdd(d){return new ot(this.x+d,this.y+d)}scalarAddEquals(d){return this.x+=d,this.y+=d,this}subtract(d){return new ot(this.x-d.x,this.y-d.y)}subtractEquals(d){return this.x-=d.x,this.y-=d.y,this}scalarSubtract(d){return new ot(this.x-d,this.y-d)}scalarSubtractEquals(d){return this.x-=d,this.y-=d,this}multiply(d){return new ot(this.x*d.x,this.y*d.y)}scalarMultiply(d){return new ot(this.x*d,this.y*d)}scalarMultiplyEquals(d){return this.x*=d,this.y*=d,this}divide(d){return new ot(this.x/d.x,this.y/d.y)}scalarDivide(d){return new ot(this.x/d,this.y/d)}scalarDivideEquals(d){return this.x/=d,this.y/=d,this}eq(d){return this.x===d.x&&this.y===d.y}lt(d){return this.x<d.x&&this.y<d.y}lte(d){return this.x<=d.x&&this.y<=d.y}gt(d){return this.x>d.x&&this.y>d.y}gte(d){return this.x>=d.x&&this.y>=d.y}lerp(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return g=Math.max(Math.min(1,g),0),new ot(this.x+(d.x-this.x)*g,this.y+(d.y-this.y)*g)}distanceFrom(d){const g=this.x-d.x,_=this.y-d.y;return Math.sqrt(g*g+_*_)}midPointFrom(d){return this.lerp(d)}min(d){return new ot(Math.min(this.x,d.x),Math.min(this.y,d.y))}max(d){return new ot(Math.max(this.x,d.x),Math.max(this.y,d.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(d,g){return this.x=d,this.y=g,this}setX(d){return this.x=d,this}setY(d){return this.y=d,this}setFromPoint(d){return this.x=d.x,this.y=d.y,this}swap(d){const g=this.x,_=this.y;this.x=d.x,this.y=d.y,d.x=g,d.y=_}clone(){return new ot(this.x,this.y)}rotate(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wt;const _=nt(d),x=rt(d),b=this.subtract(g);return new ot(b.x*x-b.y*_,b.x*_+b.y*x).add(g)}transform(d){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new ot(d[0]*this.x+d[2]*this.y+(g?0:d[4]),d[1]*this.x+d[3]*this.y+(g?0:d[5]))}}const Wt=new ot(0,0),ht=d=>!!d&&Array.isArray(d._objects);function ct(d){class s extends d{constructor(){super(...arguments),t(this,"_objects",[])}_onObjectAdded(d){}_onObjectRemoved(d){}_onStackOrderChanged(d){}add(){for(var d=arguments.length,g=new Array(d),_=0;_<d;_++)g[_]=arguments[_];const x=this._objects.push(...g);return g.forEach((d=>this._onObjectAdded(d))),x}insertAt(d){for(var g=arguments.length,_=new Array(g>1?g-1:0),x=1;x<g;x++)_[x-1]=arguments[x];return this._objects.splice(d,0,..._),_.forEach((d=>this._onObjectAdded(d))),this._objects.length}remove(){const d=this._objects,g=[];for(var _=arguments.length,x=new Array(_),b=0;b<_;b++)x[b]=arguments[b];return x.forEach((_=>{const x=d.indexOf(_);-1!==x&&(d.splice(x,1),g.push(_),this._onObjectRemoved(_))})),g}forEachObject(d){this.getObjects().forEach(((g,_,x)=>d(g,_,x)))}getObjects(){for(var d=arguments.length,g=new Array(d),_=0;_<d;_++)g[_]=arguments[_];return 0===g.length?[...this._objects]:this._objects.filter((d=>d.isType(...g)))}item(d){return this._objects[d]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(d,g){return!!this._objects.includes(d)||!!g&&this._objects.some((g=>g instanceof s&&g.contains(d,!0)))}complexity(){return this._objects.reduce(((d,g)=>d+(g.complexity?g.complexity():0)),0)}sendObjectToBack(d){return!(!d||d===this._objects[0])&&(it(this._objects,d),this._objects.unshift(d),this._onStackOrderChanged(d),!0)}bringObjectToFront(d){return!(!d||d===this._objects[this._objects.length-1])&&(it(this._objects,d),this._objects.push(d),this._onStackOrderChanged(d),!0)}sendObjectBackwards(d,g){if(!d)return!1;const _=this._objects.indexOf(d);if(0!==_){const x=this.findNewLowerIndex(d,_,g);return it(this._objects,d),this._objects.splice(x,0,d),this._onStackOrderChanged(d),!0}return!1}bringObjectForward(d,g){if(!d)return!1;const _=this._objects.indexOf(d);if(_!==this._objects.length-1){const x=this.findNewUpperIndex(d,_,g);return it(this._objects,d),this._objects.splice(x,0,d),this._onStackOrderChanged(d),!0}return!1}moveObjectTo(d,g){return d!==this._objects[g]&&(it(this._objects,d),this._objects.splice(g,0,d),this._onStackOrderChanged(d),!0)}findNewLowerIndex(d,g,_){let x;if(_){x=g;for(let _=g-1;_>=0;--_)if(d.isOverlapping(this._objects[_])){x=_;break}}else x=g-1;return x}findNewUpperIndex(d,g,_){let x;if(_){x=g;for(let _=g+1;_<this._objects.length;++_)if(d.isOverlapping(this._objects[_])){x=_;break}}else x=g+1;return x}collectObjects(d){let{left:g,top:_,width:x,height:b}=d,{includeIntersecting:S=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const w=[],T=new ot(g,_),O=T.add(new ot(x,b));for(let d=this._objects.length-1;d>=0;d--){const g=this._objects[d];g.selectable&&g.visible&&(S&&g.intersectsWithRect(T,O)||g.isContainedWithinRect(T,O)||S&&g.containsPoint(T)||S&&g.containsPoint(O))&&w.push(g)}return w}}return s}class lt extends st{_setOptions(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const g in d)this.set(g,d[g])}_setObject(d){for(const g in d)this._set(g,d[g])}set(d,g){return"object"==typeof d?this._setObject(d):this._set(d,g),this}_set(d,g){this[d]=g}toggle(d){const g=this.get(d);return"boolean"==typeof g&&this.set(d,!g),this}get(d){return this[d]}}function ut(d){return v().requestAnimationFrame(d)}function dt(d){return v().cancelAnimationFrame(d)}let le=0;const ft=()=>le++,pt=()=>{const d=m().createElement("canvas");if(!d||void 0===d.getContext)throw new h("Failed to create `canvas` element");return d},mt=()=>m().createElement("img"),vt=(d,g,_)=>d.toDataURL("image/".concat(g),_),yt=d=>d*T,_t=d=>d/T,xt=d=>d.every(((d,g)=>d===O[g])),Ct=(d,g,_)=>new ot(d).transform(g,_),bt=d=>{const g=1/(d[0]*d[3]-d[1]*d[2]),_=[g*d[3],-g*d[1],-g*d[2],g*d[0],0,0],{x:x,y:b}=new ot(d[4],d[5]).transform(_,!0);return _[4]=-x,_[5]=-b,_},wt=(d,g,_)=>[d[0]*g[0]+d[2]*g[1],d[1]*g[0]+d[3]*g[1],d[0]*g[2]+d[2]*g[3],d[1]*g[2]+d[3]*g[3],_?0:d[0]*g[4]+d[2]*g[5]+d[4],_?0:d[1]*g[4]+d[3]*g[5]+d[5]],St=(d,g)=>d.reduceRight(((d,_)=>_&&d?wt(_,d,g):_||d),void 0)||O.concat(),Tt=d=>{let[g,_]=d;return Math.atan2(_,g)},Ot=d=>{const g=Tt(d),_=Math.pow(d[0],2)+Math.pow(d[1],2),x=Math.sqrt(_),b=(d[0]*d[3]-d[2]*d[1])/x,S=Math.atan2(d[0]*d[2]+d[1]*d[3],_);return{angle:_t(g),scaleX:x,scaleY:b,skewX:_t(S),skewY:0,translateX:d[4]||0,translateY:d[5]||0}},kt=function(d){return[1,0,0,1,d,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function Dt(){let{angle:d=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:g=0,y:_=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x=yt(d),b=rt(x),S=nt(x);return[b,S,-S,b,g?g-(b*g-S*_):0,_?_-(S*g+b*_):0]}const Mt=function(d){return[d,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:d,0,0]},Pt=d=>Math.tan(yt(d)),Et=d=>[1,0,Pt(d),1,0,0],At=d=>[1,Pt(d),0,1,0,0],jt=d=>{let{scaleX:g=1,scaleY:_=1,flipX:x=!1,flipY:b=!1,skewX:S=0,skewY:w=0}=d,T=Mt(x?-g:g,b?-_:_);return S&&(T=wt(T,Et(S),!0)),w&&(T=wt(T,At(w),!0)),T},Ft=d=>{const{translateX:g=0,translateY:_=0,angle:x=0}=d;let b=kt(g,_);x&&(b=wt(b,Dt({angle:x})));const S=jt(d);return xt(S)||(b=wt(b,S)),b},Lt=function(d){let{signal:g,crossOrigin:_=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(x,b){if(g&&g.aborted)return b(new c("loadImage"));const S=mt();let w;g&&(w=function(d){S.src="",b(d)},g.addEventListener("abort",w,{once:!0}));const a=function(){S.onload=S.onerror=null,w&&(null==g||g.removeEventListener("abort",w)),x(S)};d?(S.onload=a,S.onerror=function(){w&&(null==g||g.removeEventListener("abort",w)),b(new h("Error loading ".concat(S.src)))},_&&(S.crossOrigin=_),S.src=d):a()}))},Rt=function(d){let{signal:g,reviver:_=C}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((x,b)=>{const S=[];g&&g.addEventListener("abort",b,{once:!0}),Promise.all(d.map((d=>at.getClass(d.type).fromObject(d,{signal:g}).then((g=>(_(d,g),S.push(g),g)))))).then(x).catch((d=>{S.forEach((d=>{d.dispose&&d.dispose()})),b(d)})).finally((()=>{g&&g.removeEventListener("abort",b)}))}))},It=function(d){let{signal:g}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((_,x)=>{const b=[];g&&g.addEventListener("abort",x,{once:!0});const S=Object.values(d).map((d=>d&&d.type&&at.has(d.type)?Rt([d],{signal:g}).then((d=>{let[g]=d;return b.push(g),g})):d)),w=Object.keys(d);Promise.all(S).then((d=>d.reduce(((d,g,_)=>(d[w[_]]=g,d)),{}))).then(_).catch((d=>{b.forEach((d=>{d.dispose&&d.dispose()})),x(d)})).finally((()=>{g&&g.removeEventListener("abort",x)}))}))},Bt=function(d){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce(((g,_)=>(_ in d&&(g[_]=d[_]),g)),{})},Xt=(d,g)=>Object.keys(d).reduce(((_,x)=>(g(d[x],x,d)&&(_[x]=d[x]),_)),{}),de={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},Yt=(d,g,_)=>(_<0&&(_+=1),_>1&&(_-=1),_<1/6?d+6*(g-d)*_:_<.5?g:_<2/3?d+(g-d)*(2/3-_)*6:d),Vt=(d,g,_,x)=>{d/=255,g/=255,_/=255;const b=Math.max(d,g,_),S=Math.min(d,g,_);let w,T;const O=(b+S)/2;if(b===S)w=T=0;else{const x=b-S;switch(T=O>.5?x/(2-b-S):x/(b+S),b){case d:w=(g-_)/x+(g<_?6:0);break;case g:w=(_-d)/x+2;break;case _:w=(d-g)/x+4}w/=6}return[Math.round(360*w),Math.round(100*T),Math.round(100*O),x]},Ht=function(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(d)/(d.endsWith("%")?100:1)},zt=d=>Math.min(Math.round(d),255).toString(16).toUpperCase().padStart(2,"0"),Gt=d=>{let[g,_,x,b=1]=d;const S=Math.round(.3*g+.59*_+.11*x);return[S,S,S,b]};class Nt{constructor(d){if(t(this,"isUnrecognised",!1),d)if(d instanceof Nt)this.setSource([...d._source]);else if(Array.isArray(d)){const[g,_,x,b=1]=d;this.setSource([g,_,x,b])}else this.setSource(this._tryParsingColor(d));else this.setSource([0,0,0,1])}_tryParsingColor(d){return d in de&&(d=de[d]),"transparent"===d?[255,255,255,0]:Nt.sourceFromHex(d)||Nt.sourceFromRgb(d)||Nt.sourceFromHsl(d)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(d){this._source=d}toRgb(){const[d,g,_]=this.getSource();return"rgb(".concat(d,",").concat(g,",").concat(_,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[d,g,_]=Vt(...this.getSource());return"hsl(".concat(d,",").concat(g,"%,").concat(_,"%)")}toHsla(){const[d,g,_,x]=Vt(...this.getSource());return"hsla(".concat(d,",").concat(g,"%,").concat(_,"%,").concat(x,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[d,g,_,x]=this.getSource();return"".concat(zt(d)).concat(zt(g)).concat(zt(_)).concat(zt(Math.round(255*x)))}getAlpha(){return this.getSource()[3]}setAlpha(d){return this._source[3]=d,this}toGrayscale(){return this.setSource(Gt(this.getSource())),this}toBlackWhite(d){const[g,,,_]=Gt(this.getSource()),x=g<(d||127)?0:255;return this.setSource([x,x,x,_]),this}overlayWith(d){d instanceof Nt||(d=new Nt(d));const g=this.getSource(),_=d.getSource(),[x,b,S]=g.map(((d,g)=>Math.round(.5*d+.5*_[g])));return this.setSource([x,b,S,g[3]]),this}static fromRgb(d){return Nt.fromRgba(d)}static fromRgba(d){return new Nt(Nt.sourceFromRgb(d))}static sourceFromRgb(d){const g=d.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(g){const[d,_,x]=g.slice(1,4).map((d=>{const g=parseFloat(d);return d.endsWith("%")?Math.round(2.55*g):g}));return[d,_,x,Ht(g[4])]}}static fromHsl(d){return Nt.fromHsla(d)}static fromHsla(d){return new Nt(Nt.sourceFromHsl(d))}static sourceFromHsl(d){const g=d.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!g)return;const _=(Nt.parseAngletoDegrees(g[1])%360+360)%360/360,x=parseFloat(g[2])/100,b=parseFloat(g[3])/100;let S,w,T;if(0===x)S=w=T=b;else{const d=b<=.5?b*(x+1):b+x-b*x,g=2*b-d;S=Yt(g,d,_+1/3),w=Yt(g,d,_),T=Yt(g,d,_-1/3)}return[Math.round(255*S),Math.round(255*w),Math.round(255*T),Ht(g[4])]}static fromHex(d){return new Nt(Nt.sourceFromHex(d))}static sourceFromHex(d){if(d.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const g=d.slice(d.indexOf("#")+1);let _;_=g.length<=4?g.split("").map((d=>d+d)):g.match(/.{2}/g);const[x,b,S,w=255]=_.map((d=>parseInt(d,16)));return[x,b,S,w/255]}}static parseAngletoDegrees(d){const g=d.toLowerCase(),_=parseFloat(g);return g.includes("rad")?_t(_):g.includes("turn")?360*_:_}}const Ut=(d,g)=>parseFloat(Number(d).toFixed(g)),qt=function(g){let _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D;const x=/\D{0,2}$/.exec(g),b=parseFloat(g),S=d.DPI;switch(null==x?void 0:x[0]){case"mm":return b*S/25.4;case"cm":return b*S/2.54;case"in":return b*S;case"pt":return b*S/72;case"pc":return b*S/72*12;case"em":return b*_;default:return b}},Kt=d=>{const[g,_]=d.trim().split(" "),[x,b]=(S=g)&&S!==F?[S.slice(1,4),S.slice(5,8)]:S===F?[S,S]:["Mid","Mid"];var S;return{meetOrSlice:_||"meet",alignX:x,alignY:b}},Jt=g=>"matrix("+g.map((g=>Ut(g,d.NUM_FRACTION_DIGITS))).join(" ")+")",Qt=function(d,g){let _,x,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(g)if(g.toLive)_="url(#SVGID_".concat(g.id,")");else{const d=new Nt(g),b=d.getAlpha();_=d.toRgb(),1!==b&&(x=b.toString())}else _="none";return b?"".concat(d,": ").concat(_,"; ").concat(x?"".concat(d,"-opacity: ").concat(x,"; "):""):"".concat(d,'="').concat(_,'" ').concat(x?"".concat(d,'-opacity="').concat(x,'" '):"")},Zt=d=>!!d&&void 0!==d.toLive,$t=d=>!!d&&"function"==typeof d.toObject,te=d=>!!d&&void 0!==d.offsetX&&"source"in d,ee=d=>!!d&&"function"==typeof d._renderText,se=d=>!!d&&"multiSelectionStacking"in d;function ie(d){const g=d&&re(d);let _=0,x=0;if(!d||!g)return{left:_,top:x};let b=d;const S=g.documentElement,w=g.body||{scrollLeft:0,scrollTop:0};for(;b&&(b.parentNode||b.host)&&(b=b.parentNode||b.host,b===g?(_=w.scrollLeft||S.scrollLeft||0,x=w.scrollTop||S.scrollTop||0):(_+=b.scrollLeft||0,x+=b.scrollTop||0),1!==b.nodeType||"fixed"!==b.style.position););return{left:_,top:x}}const re=d=>d.ownerDocument||null,ne=d=>{var g;return(null===(g=d.ownerDocument)||void 0===g?void 0:g.defaultView)||null},oe=function(d,g,_){let{width:x,height:b}=_,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;d.width=x,d.height=b,S>1&&(d.setAttribute("width",(x*S).toString()),d.setAttribute("height",(b*S).toString()),g.scale(S,S))},ae=(d,g)=>{let{width:_,height:x}=g;_&&(d.style.width="number"==typeof _?"".concat(_,"px"):_),x&&(d.style.height="number"==typeof x?"".concat(x,"px"):x)};function he(d){return void 0!==d.onselectstart&&(d.onselectstart=()=>!1),d.style.userSelect=F,d}class ce{constructor(d){t(this,"_originalCanvasStyle",void 0),t(this,"lower",void 0);const g=this.createLowerCanvas(d);this.lower={el:g,ctx:g.getContext("2d")}}createLowerCanvas(d){const g=(_=d)&&void 0!==_.getContext?d:d&&m().getElementById(d)||pt();var _;if(g.hasAttribute("data-fabric"))throw new h("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=g.style.cssText,g.setAttribute("data-fabric","main"),g.classList.add("lower-canvas"),g}cleanupDOM(d){let{width:g,height:_}=d;const{el:x}=this.lower;x.classList.remove("lower-canvas"),x.removeAttribute("data-fabric"),x.setAttribute("width","".concat(g)),x.setAttribute("height","".concat(_)),x.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(d,g){const{el:_,ctx:x}=this.lower;oe(_,x,d,g)}setCSSDimensions(d){ae(this.lower.el,d)}calcOffset(){return function(d){var g;const _=d&&re(d),x={left:0,top:0};if(!_)return x;const b=(null===(g=ne(d))||void 0===g?void 0:g.getComputedStyle(d,null))||{};x.left+=parseInt(b.borderLeftWidth,10)||0,x.top+=parseInt(b.borderTopWidth,10)||0,x.left+=parseInt(b.paddingLeft,10)||0,x.top+=parseInt(b.paddingTop,10)||0;let S={left:0,top:0};const w=_.documentElement;void 0!==d.getBoundingClientRect&&(S=d.getBoundingClientRect());const T=ie(d);return{left:S.left+T.left-(w.clientLeft||0)+x.left,top:S.top+T.top-(w.clientTop||0)+x.top}}(this.lower.el)}dispose(){p().dispose(this.lower.el),delete this.lower}}const ve={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...O]};class ue extends(ct(lt)){get lowerCanvasEl(){var d;return null===(d=this.elements.lower)||void 0===d?void 0:d.el}get contextContainer(){var d;return null===(d=this.elements.lower)||void 0===d?void 0:d.ctx}static getDefaults(){return ue.ownDefaults}constructor(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(g),this.initElements(d),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(d){this.elements=new ce(d)}add(){const d=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),d}insertAt(d){for(var g=arguments.length,_=new Array(g>1?g-1:0),x=1;x<g;x++)_[x-1]=arguments[x];const b=super.insertAt(d,..._);return _.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),b}remove(){const d=super.remove(...arguments);return d.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),d}_onObjectAdded(d){d.canvas&&d.canvas!==this&&(a("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),d.canvas.remove(d)),d._set("canvas",this),d.setCoords(),this.fire("object:added",{target:d}),d.fire("added",{target:this})}_onObjectRemoved(d){d._set("canvas",void 0),this.fire("object:removed",{target:d}),d.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?y():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(d,g){return this.setDimensions({width:d},g)}setHeight(d,g){return this.setDimensions({height:d},g)}_setDimensionsImpl(d){let{cssOnly:g=!1,backstoreOnly:_=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!g){const g=s({width:this.width,height:this.height},d);this.elements.setDimensions(g,this.getRetinaScaling()),this.hasLostContext=!0,this.width=g.width,this.height=g.height}_||this.elements.setCSSDimensions(d),this.calcOffset()}setDimensions(d,g){this._setDimensionsImpl(d,g),g&&g.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(d){this.viewportTransform=d,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(d,g){const _=d,x=[...this.viewportTransform],b=Ct(d,bt(x));x[0]=g,x[3]=g;const S=Ct(b,x);x[4]+=_.x-S.x,x[5]+=_.y-S.y,this.setViewportTransform(x)}setZoom(d){this.zoomToPoint(new ot(0,0),d)}absolutePan(d){const g=[...this.viewportTransform];return g[4]=-d.x,g[5]=-d.y,this.setViewportTransform(g)}relativePan(d){return this.absolutePan(new ot(-d.x-this.viewportTransform[4],-d.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(d){d.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=ut((()=>this.renderAndReset())))}calcViewportBoundaries(){const d=this.width,g=this.height,_=bt(this.viewportTransform),x=Ct({x:0,y:0},_),b=Ct({x:d,y:g},_),S=x.min(b),w=x.max(b);return this.vptCoords={tl:S,tr:new ot(w.x,S.y),bl:new ot(S.x,w.y),br:w}}cancelRequestedRender(){this.nextRenderHandle&&(dt(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(d){}renderCanvas(d,g){if(this.destroyed)return;const _=this.viewportTransform,x=this.clipPath;this.calcViewportBoundaries(),this.clearContext(d),d.imageSmoothingEnabled=this.imageSmoothingEnabled,d.patternQuality="best",this.fire("before:render",{ctx:d}),this._renderBackground(d),d.save(),d.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this._renderObjects(d,g),d.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(d),x&&(x._set("canvas",this),x.shouldCache(),x._transformDone=!0,x.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(d,x)),this._renderOverlay(d),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(d),this.fire("after:render",{ctx:d}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(d,g){const _=this.viewportTransform;d.save(),d.transform(..._),d.globalCompositeOperation="destination-in",g.transform(d),d.scale(1/g.zoomX,1/g.zoomY),d.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),d.restore()}_renderObjects(d,g){for(let _=0,x=g.length;_<x;++_)g[_]&&g[_].render(d)}_renderBackgroundOrOverlay(d,g){const _=this["".concat(g,"Color")],x=this["".concat(g,"Image")],b=this.viewportTransform,S=this["".concat(g,"Vpt")];if(!_&&!x)return;const w=Zt(_);if(_){if(d.save(),d.beginPath(),d.moveTo(0,0),d.lineTo(this.width,0),d.lineTo(this.width,this.height),d.lineTo(0,this.height),d.closePath(),d.fillStyle=w?_.toLive(d):_,S&&d.transform(...b),w){d.transform(1,0,0,1,_.offsetX||0,_.offsetY||0);const g=_.gradientTransform||_.patternTransform;g&&d.transform(...g)}d.fill(),d.restore()}if(x){d.save();const{skipOffscreen:g}=this;this.skipOffscreen=S,S&&d.transform(...b),x.render(d),this.skipOffscreen=g,d.restore()}}_renderBackground(d){this._renderBackgroundOrOverlay(d,"background")}_renderOverlay(d){this._renderBackgroundOrOverlay(d,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new ot(this.width/2,this.height/2)}centerObjectH(d){return this._centerObject(d,new ot(this.getCenterPoint().x,d.getCenterPoint().y))}centerObjectV(d){return this._centerObject(d,new ot(d.getCenterPoint().x,this.getCenterPoint().y))}centerObject(d){return this._centerObject(d,this.getCenterPoint())}viewportCenterObject(d){return this._centerObject(d,this.getVpCenter())}viewportCenterObjectH(d){return this._centerObject(d,new ot(this.getVpCenter().x,d.getCenterPoint().y))}viewportCenterObjectV(d){return this._centerObject(d,new ot(d.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Ct(this.getCenterPoint(),bt(this.viewportTransform))}_centerObject(d,g){d.setXY(g,M,M),d.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(d){return this.toDatalessObject(d)}toObject(d){return this._toObjectMethod("toObject",d)}toJSON(){return this.toObject()}toDatalessObject(d){return this._toObjectMethod("toDatalessObject",d)}_toObjectMethod(d,g){const _=this.clipPath,x=_&&!_.excludeFromExport?this._toObject(_,d,g):null;return s(s(s({version:b},Bt(this,g)),{},{objects:this._objects.filter((d=>!d.excludeFromExport)).map((_=>this._toObject(_,d,g)))},this.__serializeBgOverlay(d,g)),x?{clipPath:x}:null)}_toObject(d,g,_){let x;this.includeDefaultValues||(x=d.includeDefaultValues,d.includeDefaultValues=!1);const b=d[g](_);return this.includeDefaultValues||(d.includeDefaultValues=!!x),b}__serializeBgOverlay(d,g){const _={},x=this.backgroundImage,b=this.overlayImage,S=this.backgroundColor,w=this.overlayColor;return Zt(S)?S.excludeFromExport||(_.background=S.toObject(g)):S&&(_.background=S),Zt(w)?w.excludeFromExport||(_.overlay=w.toObject(g)):w&&(_.overlay=w),x&&!x.excludeFromExport&&(_.backgroundImage=this._toObject(x,d,g)),b&&!b.excludeFromExport&&(_.overlayImage=this._toObject(b,d,g)),_}toSVG(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=arguments.length>1?arguments[1]:void 0;d.reviver=g;const _=[];return this._setSVGPreamble(_,d),this._setSVGHeader(_,d),this.clipPath&&_.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(_,"background"),this._setSVGBgOverlayImage(_,"backgroundImage",g),this._setSVGObjects(_,g),this.clipPath&&_.push("</g>\n"),this._setSVGBgOverlayColor(_,"overlay"),this._setSVGBgOverlayImage(_,"overlayImage",g),_.push("</svg>"),_.join("")}_setSVGPreamble(d,g){g.suppressPreamble||d.push('<?xml version="1.0" encoding="',g.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(g,_){const x=_.width||"".concat(this.width),S=_.height||"".concat(this.height),w=d.NUM_FRACTION_DIGITS,T=_.viewBox;let O;if(T)O='viewBox="'.concat(T.x," ").concat(T.y," ").concat(T.width," ").concat(T.height,'" ');else if(this.svgViewportTransformation){const d=this.viewportTransform;O='viewBox="'.concat(Ut(-d[4]/d[0],w)," ").concat(Ut(-d[5]/d[3],w)," ").concat(Ut(this.width/d[0],w)," ").concat(Ut(this.height/d[3],w),'" ')}else O='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',x,'" ','height="',S,'" ',O,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",b,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(_),"</defs>\n")}createSVGClipPathMarkup(d){const g=this.clipPath;return g?(g.clipPathId="CLIPPATH_".concat(ft()),'<clipPath id="'.concat(g.clipPathId,'" >\n').concat(g.toClipPathSVG(d.reviver),"</clipPath>\n")):""}createSVGRefElementsMarkup(){return["background","overlay"].map((d=>{const g=this["".concat(d,"Color")];if(Zt(g)){const _=this["".concat(d,"Vpt")],x=this.viewportTransform,b={isType:()=>!1,width:this.width/(_?x[0]:1),height:this.height/(_?x[3]:1)};return g.toSVG(b,{additionalTransform:_?Jt(x):""})}})).join("")}createSVGFontFacesMarkup(){const g=[],_={},x=d.fontPaths;this._objects.forEach((function e(d){g.push(d),ht(d)&&d._objects.forEach(e)})),g.forEach((d=>{if(!ee(d))return;const{styles:g,fontFamily:b}=d;!_[b]&&x[b]&&(_[b]=!0,g&&Object.values(g).forEach((d=>{Object.values(d).forEach((d=>{let{fontFamily:g=""}=d;!_[g]&&x[g]&&(_[g]=!0)}))})))}));const b=Object.keys(_).map((d=>"\t\t@font-face {\n\t\t\tfont-family: '".concat(d,"';\n\t\t\tsrc: url('").concat(x[d],"');\n\t\t}\n"))).join("");return b?'\t<style type="text/css"><![CDATA[\n'.concat(b,"]]></style>\n"):""}_setSVGObjects(d,g){this.forEachObject((_=>{_.excludeFromExport||this._setSVGObject(d,_,g)}))}_setSVGObject(d,g,_){d.push(g.toSVG(_))}_setSVGBgOverlayImage(d,g,_){const x=this[g];x&&!x.excludeFromExport&&x.toSVG&&d.push(x.toSVG(_))}_setSVGBgOverlayColor(d,g){const _=this["".concat(g,"Color")];if(_)if(Zt(_)){const x=_.repeat||"",b=this.width,S=this.height,w=this["".concat(g,"Vpt")]?Jt(bt(this.viewportTransform)):"";d.push('<rect transform="'.concat(w," translate(").concat(b/2,",").concat(S/2,')" x="').concat(_.offsetX-b/2,'" y="').concat(_.offsetY-S/2,'" width="').concat("repeat-y"!==x&&"no-repeat"!==x||!te(_)?b:_.source.width,'" height="').concat("repeat-x"!==x&&"no-repeat"!==x||!te(_)?S:_.source.height,'" fill="url(#SVGID_').concat(_.id,')"></rect>\n'))}else d.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',_,'"',"></rect>\n")}loadFromJSON(d,g){let{signal:_}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!d)return Promise.reject(new h("`json` is undefined"));const x="string"==typeof d?JSON.parse(d):d,{objects:b=[],backgroundImage:S,background:w,overlayImage:T,overlay:O,clipPath:D}=x,k=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Rt(b,{reviver:g,signal:_}),It({backgroundImage:S,backgroundColor:w,overlayImage:T,overlayColor:O,clipPath:D},{signal:_})]).then((d=>{let[g,_]=d;return this.clear(),this.add(...g),this.set(x),this.set(_),this.renderOnAddRemove=k,this}))}clone(d){const g=this.toObject(d);return this.cloneWithoutData().loadFromJSON(g)}cloneWithoutData(){const d=pt();return d.width=this.width,d.height=this.height,new this.constructor(d)}toDataURL(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:g="png",quality:_=1,multiplier:x=1,enableRetinaScaling:b=!1}=d,S=x*(b?this.getRetinaScaling():1);return vt(this.toCanvasElement(S,d),g,_)}toCanvasElement(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:g,height:_,left:x,top:b,filter:S}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const w=(g||this.width)*d,T=(_||this.height)*d,O=this.getZoom(),D=this.width,k=this.height,M=this.skipControlsDrawing,P=O*d,E=this.viewportTransform,A=[P,0,0,P,(E[4]-(x||0))*d,(E[5]-(b||0))*d],j=this.enableRetinaScaling,F=pt(),L=S?this._objects.filter((d=>S(d))):this._objects;return F.width=w,F.height=T,this.enableRetinaScaling=!1,this.viewportTransform=A,this.width=w,this.height=T,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(F.getContext("2d"),L),this.viewportTransform=E,this.width=D,this.height=k,this.calcViewportBoundaries(),this.enableRetinaScaling=j,this.skipControlsDrawing=M,F}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),gt.cancelByCanvas(this),this.disposed=!0,new Promise(((d,g)=>{const s=()=>{this.destroy(),d(!0)};s.kill=g,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?d(!1):this.nextRenderHandle?this.__cleanupTask=s:s()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((d=>d.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}t(ue,"ownDefaults",ve);const De=["touchstart","touchmove","touchend"];const ge=d=>{const g=ie(d.target),_=function(d){const g=d.changedTouches;return g&&g[0]?g[0]:d}(d);return new ot(_.clientX+g.left,_.clientY+g.top)},fe=d=>De.includes(d.type)||"touch"===d.pointerType,pe=d=>{d.preventDefault(),d.stopPropagation()},me=d=>{let g=0,_=0,x=0,b=0;for(let S=0,w=d.length;S<w;S++){const{x:w,y:T}=d[S];(w>x||!S)&&(x=w),(w<g||!S)&&(g=w),(T>b||!S)&&(b=T),(T<_||!S)&&(_=T)}return{left:g,top:_,width:x-g,height:b-_}},Pe=["translateX","translateY","scaleX","scaleY"],ye=(d,g)=>_e(d,wt(g,d.calcOwnMatrix())),_e=(d,g)=>{const _=Ot(g),{translateX:x,translateY:b,scaleX:S,scaleY:w}=_,T=i(_,Pe),O=new ot(x,b);d.flipX=!1,d.flipY=!1,Object.assign(d,T),d.set({scaleX:S,scaleY:w}),d.setPositionByOrigin(O,M,M)},xe=d=>{d.scaleX=1,d.scaleY=1,d.skewX=0,d.skewY=0,d.flipX=!1,d.flipY=!1,d.rotate(0)},Ce=d=>({scaleX:d.scaleX,scaleY:d.scaleY,skewX:d.skewX,skewY:d.skewY,angle:d.angle,left:d.left,flipX:d.flipX,flipY:d.flipY,top:d.top}),be=(d,g,_)=>{const x=d/2,b=g/2,S=[new ot(-x,-b),new ot(x,-b),new ot(-x,b),new ot(x,b)].map((d=>d.transform(_))),w=me(S);return new ot(w.width,w.height)},we=function(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O;return wt(bt(arguments.length>1&&void 0!==arguments[1]?arguments[1]:O),d)},Se=function(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O;return d.transform(we(g,_))},Te=function(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O;return d.transform(we(g,_),!0)},Oe=(d,g,_)=>{const x=we(g,_);return _e(d,wt(x,d.calcOwnMatrix())),x},ke=(d,g)=>{var _;const{transform:{target:x}}=g;null===(_=x.canvas)||void 0===_||_.fire("object:".concat(d),s(s({},g),{},{target:x})),x.fire(d,g)},We={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Me=d=>"string"==typeof d?We[d]:d-.5,Ye="not-allowed";function Ee(d){return Me(d.originX)===Me(M)&&Me(d.originY)===Me(M)}function Ae(d){return.5-Me(d)}const je=(d,g)=>d[g],Fe=(d,g,_,x)=>({e:d,transform:g,pointer:new ot(_,x)});function Le(d,g){const _=d.getTotalAngle()+_t(Math.atan2(g.y,g.x))+360;return Math.round(_%360/45)}function Re(d,g,_,x,b){var S;let{target:w,corner:T}=d;const O=w.controls[T],D=(null===(S=w.canvas)||void 0===S?void 0:S.getZoom())||1,k=w.padding/D,P=function(d,g,_,x){const b=d.getRelativeCenterPoint(),S=void 0!==_&&void 0!==x?d.translateToGivenOrigin(b,M,M,_,x):new ot(d.left,d.top);return(d.angle?g.rotate(-yt(d.angle),b):g).subtract(S)}(w,new ot(x,b),g,_);return P.x>=k&&(P.x-=k),P.x<=-k&&(P.x+=k),P.y>=k&&(P.y-=k),P.y<=k&&(P.y+=k),P.x-=O.offsetX,P.y-=O.offsetY,P}const Ie=(d,g,_,x)=>{const{target:b,offsetX:S,offsetY:w}=g,T=_-S,O=x-w,D=!je(b,"lockMovementX")&&b.left!==T,k=!je(b,"lockMovementY")&&b.top!==O;return D&&b.set(P,T),k&&b.set(E,O),(D||k)&&ke(B,Fe(d,g,_,x)),D||k};class Be{getSvgStyles(d){const g=this.fillRule?this.fillRule:"nonzero",_=this.strokeWidth?this.strokeWidth:"0",x=this.strokeDashArray?this.strokeDashArray.join(" "):F,b=this.strokeDashOffset?this.strokeDashOffset:"0",S=this.strokeLineCap?this.strokeLineCap:"butt",w=this.strokeLineJoin?this.strokeLineJoin:"miter",T=this.strokeMiterLimit?this.strokeMiterLimit:"4",O=void 0!==this.opacity?this.opacity:"1",D=this.visible?"":" visibility: hidden;",k=d?"":this.getSvgFilter(),M=Qt(J,this.fill);return[Qt(Z,this.stroke),"stroke-width: ",_,"; ","stroke-dasharray: ",x,"; ","stroke-linecap: ",S,"; ","stroke-dashoffset: ",b,"; ","stroke-linejoin: ",w,"; ","stroke-miterlimit: ",T,"; ",M,"fill-rule: ",g,"; ","opacity: ",O,";",k,D].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const _=d?this.calcTransformMatrix():this.calcOwnMatrix(),x='transform="'.concat(Jt(_));return"".concat(x).concat(g,'" ')}_toSVG(d){return[""]}toSVG(d){return this._createBaseSVGMarkup(this._toSVG(d),{reviver:d})}toClipPathSVG(d){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(d),{reviver:d})}_createBaseClipPathSVGMarkup(d){let{reviver:g,additionalTransform:_=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const x=[this.getSvgTransform(!0,_),this.getSvgCommons()].join(""),b=d.indexOf("COMMON_PARTS");return d[b]=x,g?g(d.join("")):d.join("")}_createBaseSVGMarkup(d){let{noStyle:g,reviver:_,withShadow:x,additionalTransform:b}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const S=g?"":'style="'.concat(this.getSvgStyles(),'" '),w=x?'style="'.concat(this.getSvgFilter(),'" '):"",T=this.clipPath,O=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",D=T&&T.absolutePositioned,k=this.stroke,M=this.fill,P=this.shadow,E=[],A=d.indexOf("COMMON_PARTS");let j;T&&(T.clipPathId="CLIPPATH_".concat(ft()),j='<clipPath id="'.concat(T.clipPathId,'" >\n').concat(T.toClipPathSVG(_),"</clipPath>\n")),D&&E.push("<g ",w,this.getSvgCommons()," >\n"),E.push("<g ",this.getSvgTransform(!1),D?"":w+this.getSvgCommons()," >\n");const F=[S,O,g?"":this.addPaintOrder()," ",b?'transform="'.concat(b,'" '):""].join("");return d[A]=F,Zt(M)&&E.push(M.toSVG(this)),Zt(k)&&E.push(k.toSVG(this)),P&&E.push(P.toSVG(this)),T&&E.push(j),E.push(d.join("")),E.push("</g>\n"),D&&E.push("</g>\n"),_?_(E.join("")):E.join("")}addPaintOrder(){return this.paintFirst!==J?' paint-order="'.concat(this.paintFirst,'" '):""}}function Xe(d){return new RegExp("^("+d.join("|")+")\\b","i")}var Ve;const ze=String.raw(Ve||(Ve=r(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),Ge="http://www.w3.org/2000/svg",Ne=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+ze+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+ze+"))?\\s+(.*)"),He={cx:P,x:P,r:"radius",cy:E,y:E,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},Ue="font-size",qe="clip-path",Ke=Xe(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),Qe=Xe(["symbol","image","marker","pattern","view","svg"]),Je=Xe(["symbol","g","a","svg","clipPath","defs"]),Ze=new RegExp("^\\s*("+ze+"+)\\s*,?\\s*("+ze+"+)\\s*,?\\s*("+ze+"+)\\s*,?\\s*("+ze+"+)\\s*$"),cs=new ot(1,0),ls=new ot,$e=(d,g)=>d.rotate(g),ts=(d,g)=>new ot(g).subtract(d),es=d=>d.distanceFrom(ls),ss=(d,g)=>Math.atan2(os(d,g),as(d,g)),is=d=>ss(cs,d),rs=d=>d.eq(ls)?d:d.scalarDivide(es(d)),ns=function(d){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return rs(new ot(-d.y,d.x).scalarMultiply(g?1:-1))},os=(d,g)=>d.x*g.y-d.y*g.x,as=(d,g)=>d.x*g.x+d.y*g.y,hs=(d,g,_)=>{if(d.eq(g)||d.eq(_))return!0;const x=os(g,_),b=os(g,d),S=os(_,d);return x>=0?b>=0&&S<=0:!(b<=0&&S>=0)},gs="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",fs=new RegExp("(?:\\s|^)"+gs+gs+"("+ze+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class us{constructor(d){const g="string"==typeof d?us.parseShadow(d):d;Object.assign(this,us.ownDefaults,g),this.id=ft()}static parseShadow(d){const g=d.trim(),[,_=0,x=0,b=0]=(fs.exec(g)||[]).map((d=>parseFloat(d)||0));return{color:(g.replace(fs,"")||"rgb(0,0,0)").trim(),offsetX:_,offsetY:x,blur:b}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(g){const _=$e(new ot(this.offsetX,this.offsetY),yt(-g.angle)),x=new Nt(this.color);let b=40,S=40;return g.width&&g.height&&(b=100*Ut((Math.abs(_.x)+this.blur)/g.width,d.NUM_FRACTION_DIGITS)+20,S=100*Ut((Math.abs(_.y)+this.blur)/g.height,d.NUM_FRACTION_DIGITS)+20),g.flipX&&(_.x*=-1),g.flipY&&(_.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(S,'%" height="').concat(100+2*S,'%" x="-').concat(b,'%" width="').concat(100+2*b,'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(Ut(this.blur?this.blur/2:0,d.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n\t<feOffset dx="').concat(Ut(_.x,d.NUM_FRACTION_DIGITS),'" dy="').concat(Ut(_.y,d.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="').concat(x.toRgb(),'" flood-opacity="').concat(x.getAlpha(),'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')}toObject(){const d={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},g=us.ownDefaults;return this.includeDefaultValues?d:Xt(d,((d,_)=>d!==g[_]))}static async fromObject(d){return new this(d)}}t(us,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),t(us,"type","shadow"),at.setClass(us,"shadow");const ds=(d,g,_)=>Math.max(d,Math.min(g,_)),ps=[E,P,U,q,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",K,Q],Cs=[J,Z,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],Ss={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:P,originY:E,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:J,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},ms=(d,g,_,x)=>(d<Math.abs(g)?(d=g,x=_/4):x=0===g&&0===d?_/w*Math.asin(1):_/w*Math.asin(g/d),{a:d,c:g,p:_,s:x}),vs=(d,g,_,x,b)=>d*Math.pow(2,10*(x-=1))*Math.sin((x*b-g)*w/_),ys=(d,g,_,x)=>-_*Math.cos(d/x*S)+_+g,_s=(d,g,_,x)=>(d/=x)<1/2.75?_*(7.5625*d*d)+g:d<2/2.75?_*(7.5625*(d-=1.5/2.75)*d+.75)+g:d<2.5/2.75?_*(7.5625*(d-=2.25/2.75)*d+.9375)+g:_*(7.5625*(d-=2.625/2.75)*d+.984375)+g,xs=(d,g,_,x)=>_-_s(x-d,0,_,x)+g;var Os=Object.freeze({__proto__:null,defaultEasing:ys,easeInBack:function(d,g,_,x){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return _*(d/=x)*d*((b+1)*d-b)+g},easeInBounce:xs,easeInCirc:(d,g,_,x)=>-_*(Math.sqrt(1-(d/=x)*d)-1)+g,easeInCubic:(d,g,_,x)=>_*(d/x)**3+g,easeInElastic:(d,g,_,x)=>{const b=_;let S=0;if(0===d)return g;if(1===(d/=x))return g+_;S||(S=.3*x);const{a:w,s:T,p:O}=ms(b,_,S,1.70158);return-vs(w,T,O,d,x)+g},easeInExpo:(d,g,_,x)=>0===d?g:_*2**(10*(d/x-1))+g,easeInOutBack:function(d,g,_,x){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(d/=x/2)<1?_/2*(d*d*((1+(b*=1.525))*d-b))+g:_/2*((d-=2)*d*((1+(b*=1.525))*d+b)+2)+g},easeInOutBounce:(d,g,_,x)=>d<x/2?.5*xs(2*d,0,_,x)+g:.5*_s(2*d-x,0,_,x)+.5*_+g,easeInOutCirc:(d,g,_,x)=>(d/=x/2)<1?-_/2*(Math.sqrt(1-d**2)-1)+g:_/2*(Math.sqrt(1-(d-=2)*d)+1)+g,easeInOutCubic:(d,g,_,x)=>(d/=x/2)<1?_/2*d**3+g:_/2*((d-2)**3+2)+g,easeInOutElastic:(d,g,_,x)=>{const b=_;let S=0;if(0===d)return g;if(2===(d/=x/2))return g+_;S||(S=x*(.3*1.5));const{a:T,s:O,p:D,c:k}=ms(b,_,S,1.70158);return d<1?-.5*vs(T,O,D,d,x)+g:T*Math.pow(2,-10*(d-=1))*Math.sin((d*x-O)*w/D)*.5+k+g},easeInOutExpo:(d,g,_,x)=>0===d?g:d===x?g+_:(d/=x/2)<1?_/2*2**(10*(d-1))+g:_/2*-(2**(-10*--d)+2)+g,easeInOutQuad:(d,g,_,x)=>(d/=x/2)<1?_/2*d**2+g:-_/2*(--d*(d-2)-1)+g,easeInOutQuart:(d,g,_,x)=>(d/=x/2)<1?_/2*d**4+g:-_/2*((d-=2)*d**3-2)+g,easeInOutQuint:(d,g,_,x)=>(d/=x/2)<1?_/2*d**5+g:_/2*((d-2)**5+2)+g,easeInOutSine:(d,g,_,x)=>-_/2*(Math.cos(Math.PI*d/x)-1)+g,easeInQuad:(d,g,_,x)=>_*(d/=x)*d+g,easeInQuart:(d,g,_,x)=>_*(d/=x)*d**3+g,easeInQuint:(d,g,_,x)=>_*(d/x)**5+g,easeInSine:(d,g,_,x)=>-_*Math.cos(d/x*S)+_+g,easeOutBack:function(d,g,_,x){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return _*((d=d/x-1)*d*((b+1)*d+b)+1)+g},easeOutBounce:_s,easeOutCirc:(d,g,_,x)=>_*Math.sqrt(1-(d=d/x-1)*d)+g,easeOutCubic:(d,g,_,x)=>_*((d/x-1)**3+1)+g,easeOutElastic:(d,g,_,x)=>{const b=_;let S=0;if(0===d)return g;if(1===(d/=x))return g+_;S||(S=.3*x);const{a:T,s:O,p:D,c:k}=ms(b,_,S,1.70158);return T*2**(-10*d)*Math.sin((d*x-O)*w/D)+k+g},easeOutExpo:(d,g,_,x)=>d===x?g+_:_*-(2**(-10*d/x)+1)+g,easeOutQuad:(d,g,_,x)=>-_*(d/=x)*(d-2)+g,easeOutQuart:(d,g,_,x)=>-_*((d=d/x-1)*d**3-1)+g,easeOutQuint:(d,g,_,x)=>_*((d/x-1)**5+1)+g,easeOutSine:(d,g,_,x)=>_*Math.sin(d/x*S)+g});const bs=()=>!1;class ws{constructor(d){let{startValue:g,byValue:_,duration:x=500,delay:b=0,easing:S=ys,onStart:w=C,onChange:T=C,onComplete:O=C,abort:D=bs,target:k}=d;t(this,"_state","pending"),t(this,"durationProgress",0),t(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=x,this.delay=b,this.easing=S,this._onStart=w,this._onChange=T,this._onComplete=O,this._abort=D,this.target=k,this.startValue=g,this.byValue=_,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){const t=d=>{"pending"===this._state&&(this.startTime=d||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>ut(t)),this.delay):ut(t)}tick(d){const g=(d||+new Date)-this.startTime,_=Math.min(g,this.duration);this.durationProgress=_/this.duration;const{value:x,valueProgress:b}=this.calculate(_);this.value=Object.freeze(x),this.valueProgress=b,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):g>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),ut(this.tick)))}register(){gt.push(this)}unregister(){gt.remove(this)}abort(){this._state="aborted",this.unregister()}}const Ds=["startValue","endValue"];class Ts extends ws{constructor(d){let{startValue:g=0,endValue:_=100}=d;super(s(s({},i(d,Ds)),{},{startValue:g,byValue:_-g}))}calculate(d){const g=this.easing(d,this.startValue,this.byValue,this.duration);return{value:g,valueProgress:Math.abs((g-this.startValue)/this.byValue)}}}const Bs=["startValue","endValue"];class ks extends ws{constructor(d){let{startValue:g=[0],endValue:_=[100]}=d;super(s(s({},i(d,Bs)),{},{startValue:g,byValue:_.map(((d,_)=>d-g[_]))}))}calculate(d){const g=this.startValue.map(((g,_)=>this.easing(d,g,this.byValue[_],this.duration,_)));return{value:g,valueProgress:Math.abs((g[0]-this.startValue[0])/this.byValue[0])}}}const Rs=["startValue","endValue","easing","onChange","onComplete","abort"],Ms=(d,g,_,x)=>g+_*(1-Math.cos(d/x*S)),Ps=d=>d&&((g,_,x)=>d(new Nt(g).toRgba(),_,x));class Es extends ws{constructor(d){let{startValue:g,endValue:_,easing:x=Ms,onChange:b,onComplete:S,abort:w}=d,T=i(d,Rs);const O=new Nt(g).getSource(),D=new Nt(_).getSource();super(s(s({},T),{},{startValue:O,byValue:D.map(((d,g)=>d-O[g])),easing:x,onChange:Ps(b),onComplete:Ps(S),abort:Ps(w)}))}calculate(d){const[g,_,x,b]=this.startValue.map(((g,_)=>this.easing(d,g,this.byValue[_],this.duration,_))),S=[...[g,_,x].map(Math.round),ds(0,b,1)];return{value:S,valueProgress:S.map(((d,g)=>0!==this.byValue[g]?Math.abs((d-this.startValue[g])/this.byValue[g]):0)).find((d=>0!==d))||0}}}function As(d){const g=(d=>Array.isArray(d.startValue)||Array.isArray(d.endValue))(d)?new ks(d):new Ts(d);return g.start(),g}function js(d){const g=new Es(d);return g.start(),g}class Fs{constructor(d){this.status=d,this.points=[]}includes(d){return this.points.some((g=>g.eq(d)))}append(){for(var d=arguments.length,g=new Array(d),_=0;_<d;_++)g[_]=arguments[_];return this.points=this.points.concat(g.filter((d=>!this.includes(d)))),this}static isPointContained(d,g,_){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(g.eq(_))return d.eq(g);if(g.x===_.x)return d.x===g.x&&(x||d.y>=Math.min(g.y,_.y)&&d.y<=Math.max(g.y,_.y));if(g.y===_.y)return d.y===g.y&&(x||d.x>=Math.min(g.x,_.x)&&d.x<=Math.max(g.x,_.x));{const b=ts(g,_),S=ts(g,d).divide(b);return x?Math.abs(S.x)===Math.abs(S.y):S.x===S.y&&S.x>=0&&S.x<=1}}static isPointInPolygon(d,g){const _=new ot(d).setX(Math.min(d.x-1,...g.map((d=>d.x))));let x=0;for(let b=0;b<g.length;b++){const S=this.intersectSegmentSegment(g[b],g[(b+1)%g.length],d,_);if(S.includes(d))return!0;x+=Number("Intersection"===S.status)}return x%2==1}static intersectLineLine(d,g,_,x){let b=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const w=g.x-d.x,T=g.y-d.y,O=x.x-_.x,D=x.y-_.y,k=d.x-_.x,M=d.y-_.y,P=O*M-D*k,E=w*M-T*k,A=D*w-O*T;if(0!==A){const g=P/A,_=E/A;return(b||0<=g&&g<=1)&&(S||0<=_&&_<=1)?new Fs("Intersection").append(new ot(d.x+g*w,d.y+g*T)):new Fs}if(0===P||0===E){const w=b||S||Fs.isPointContained(d,_,x)||Fs.isPointContained(g,_,x)||Fs.isPointContained(_,d,g)||Fs.isPointContained(x,d,g);return new Fs(w?"Coincident":void 0)}return new Fs("Parallel")}static intersectSegmentLine(d,g,_,x){return Fs.intersectLineLine(d,g,_,x,!1,!0)}static intersectSegmentSegment(d,g,_,x){return Fs.intersectLineLine(d,g,_,x,!1,!1)}static intersectLinePolygon(d,g,_){let x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const b=new Fs,S=_.length;for(let w,T,O,D=0;D<S;D++){if(w=_[D],T=_[(D+1)%S],O=Fs.intersectLineLine(d,g,w,T,x,!1),"Coincident"===O.status)return O;b.append(...O.points)}return b.points.length>0&&(b.status="Intersection"),b}static intersectSegmentPolygon(d,g,_){return Fs.intersectLinePolygon(d,g,_,!1)}static intersectPolygonPolygon(d,g){const _=new Fs,x=d.length,b=[];for(let S=0;S<x;S++){const w=d[S],T=d[(S+1)%x],O=Fs.intersectSegmentPolygon(w,T,g);"Coincident"===O.status?(b.push(O),_.append(w,T)):_.append(...O.points)}return b.length>0&&b.length===d.length?new Fs("Coincident"):(_.points.length>0&&(_.status="Intersection"),_)}static intersectPolygonRectangle(d,g,_){const x=g.min(_),b=g.max(_),S=new ot(b.x,x.y),w=new ot(x.x,b.y);return Fs.intersectPolygonPolygon(d,[x,S,b,w])}}class Ls extends lt{getX(){return this.getXY().x}setX(d){this.setXY(this.getXY().setX(d))}getY(){return this.getXY().y}setY(d){this.setXY(this.getXY().setY(d))}getRelativeX(){return this.left}setRelativeX(d){this.left=d}getRelativeY(){return this.top}setRelativeY(d){this.top=d}getXY(){const d=this.getRelativeXY();return this.group?Ct(d,this.group.calcTransformMatrix()):d}setXY(d,g,_){this.group&&(d=Ct(d,bt(this.group.calcTransformMatrix()))),this.setRelativeXY(d,g,_)}getRelativeXY(){return new ot(this.left,this.top)}setRelativeXY(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(d,g,_)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:d,tr:g,br:_,bl:x}=this.aCoords||(this.aCoords=this.calcACoords()),b=[d,g,_,x];if(this.group){const d=this.group.calcTransformMatrix();return b.map((g=>Ct(g,d)))}return b}intersectsWithRect(d,g){return"Intersection"===Fs.intersectPolygonRectangle(this.getCoords(),d,g).status}intersectsWithObject(d){const g=Fs.intersectPolygonPolygon(this.getCoords(),d.getCoords());return"Intersection"===g.status||"Coincident"===g.status||d.isContainedWithinObject(this)||this.isContainedWithinObject(d)}isContainedWithinObject(d){return this.getCoords().every((g=>d.containsPoint(g)))}isContainedWithinRect(d,g){const{left:_,top:x,width:b,height:S}=this.getBoundingRect();return _>=d.x&&_+b<=g.x&&x>=d.y&&x+S<=g.y}isOverlapping(d){return this.intersectsWithObject(d)||this.isContainedWithinObject(d)||d.isContainedWithinObject(this)}containsPoint(d){return Fs.isPointInPolygon(d,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:d,br:g}=this.canvas.vptCoords;return!!this.getCoords().some((_=>_.x<=g.x&&_.x>=d.x&&_.y<=g.y&&_.y>=d.y))||!!this.intersectsWithRect(d,g)||this.containsPoint(d.midPointFrom(g))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:d,br:g}=this.canvas.vptCoords;return!!this.intersectsWithRect(d,g)||this.getCoords().every((_=>(_.x>=g.x||_.x<=d.x)&&(_.y>=g.y||_.y<=d.y)))&&this.containsPoint(d.midPointFrom(g))}getBoundingRect(){return me(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(d){this._set(U,d),this._set(q,d),this.setCoords()}scaleToWidth(d){const g=this.getBoundingRect().width/this.getScaledWidth();return this.scale(d/this.width/g)}scaleToHeight(d){const g=this.getBoundingRect().height/this.getScaledHeight();return this.scale(d/this.height/g)}getCanvasRetinaScaling(){var d;return(null===(d=this.canvas)||void 0===d?void 0:d.getRetinaScaling())||1}getTotalAngle(){return this.group?_t(Tt(this.calcTransformMatrix())):this.angle}getViewportTransform(){var d;return(null===(d=this.canvas)||void 0===d?void 0:d.viewportTransform)||O.concat()}calcACoords(){const d=Dt({angle:this.angle}),{x:g,y:_}=this.getRelativeCenterPoint(),x=kt(g,_),b=wt(x,d),S=this._getTransformedDimensions(),w=S.x/2,T=S.y/2;return{tl:Ct({x:-w,y:-T},b),tr:Ct({x:w,y:-T},b),bl:Ct({x:-w,y:T},b),br:Ct({x:w,y:T},b)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=[];return!d&&this.group&&(g=this.group.transformMatrixKey(d)),g.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Me(this.originX),Me(this.originY)),g}calcTransformMatrix(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=this.calcOwnMatrix();if(d||!this.group)return g;const _=this.transformMatrixKey(d),x=this.matrixCache;return x&&x.key.every(((d,g)=>d===_[g]))?x.value:(this.group&&(g=wt(this.group.calcTransformMatrix(!1),g)),this.matrixCache={key:_,value:g},g)}calcOwnMatrix(){const d=this.transformMatrixKey(!0),g=this.ownMatrixCache;if(g&&g.key===d)return g.value;const _=this.getRelativeCenterPoint(),x={angle:this.angle,translateX:_.x,translateY:_.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},b=Ft(x);return this.ownMatrixCache={key:d,value:b},b}_getNonTransformedDimensions(){return new ot(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(d){return this._getTransformedDimensions(d).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const g=s({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},d),_=g.strokeWidth;let x=_,b=0;this.strokeUniform&&(x=0,b=_);const S=g.width+x,w=g.height+x;let T;return T=0===g.skewX&&0===g.skewY?new ot(S*g.scaleX,w*g.scaleY):be(S,w,jt(g)),T.scalarAdd(b)}translateToGivenOrigin(d,g,_,x,b){let S=d.x,w=d.y;const T=Me(x)-Me(g),O=Me(b)-Me(_);if(T||O){const d=this._getTransformedDimensions();S+=T*d.x,w+=O*d.y}return new ot(S,w)}translateToCenterPoint(d,g,_){if(g===M&&_===M)return d;const x=this.translateToGivenOrigin(d,g,_,M,M);return this.angle?x.rotate(yt(this.angle),d):x}translateToOriginPoint(d,g,_){const x=this.translateToGivenOrigin(d,M,M,g,_);return this.angle?x.rotate(yt(this.angle),d):x}getCenterPoint(){const d=this.getRelativeCenterPoint();return this.group?Ct(d,this.group.calcTransformMatrix()):d}getRelativeCenterPoint(){return this.translateToCenterPoint(new ot(this.left,this.top),this.originX,this.originY)}getPointByOrigin(d,g){return this.translateToOriginPoint(this.getRelativeCenterPoint(),d,g)}setPositionByOrigin(d,g,_){const x=this.translateToCenterPoint(d,g,_),b=this.translateToOriginPoint(x,this.originX,this.originY);this.set({left:b.x,top:b.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),P,E)}}const Is=["type"],Ys=["extraParam"];let Ns=class e extends Ls{static getDefaults(){return e.ownDefaults}get type(){const d=this.constructor.type;return"FabricObject"===d?"object":d.toLowerCase()}set type(d){a("warn","Setting type has no effect",d)}constructor(d){super(),t(this,"_cacheContext",null),Object.assign(this,e.ownDefaults),this.setOptions(d)}_createCacheCanvas(){this._cacheCanvas=pt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(g){const _=g.width,b=g.height,S=d.maxCacheSideLimit,w=d.minCacheSideLimit;if(_<=S&&b<=S&&_*b<=d.perfLimitSizeTotal)return _<w&&(g.width=w),b<w&&(g.height=w),g;const T=_/b,[O,D]=x.limitDimsByArea(T),k=ds(w,O,S),M=ds(w,D,S);return _>k&&(g.zoomX/=_/k,g.width=k,g.capped=!0),b>M&&(g.zoomY/=b/M,g.height=M,g.capped=!0),g}_getCacheCanvasDimensions(){const d=this.getTotalObjectScaling(),g=this._getTransformedDimensions({skewX:0,skewY:0}),_=g.x*d.x/this.scaleX,x=g.y*d.y/this.scaleY;return{width:_+2,height:x+2,zoomX:d.x,zoomY:d.y,x:_,y:x}}_updateCacheCanvas(){const g=this._cacheCanvas,_=this._cacheContext,x=this._limitCacheSize(this._getCacheCanvasDimensions()),b=d.minCacheSideLimit,S=x.width,w=x.height,T=x.zoomX,O=x.zoomY,D=S!==g.width||w!==g.height,k=this.zoomX!==T||this.zoomY!==O;if(!g||!_)return!1;let M,P,E=D||k,A=0,j=0,F=!1;if(D){const d=this._cacheCanvas.width,g=this._cacheCanvas.height,_=S>d||w>g;F=_||(S<.9*d||w<.9*g)&&d>b&&g>b,_&&!x.capped&&(S>b||w>b)&&(A=.1*S,j=.1*w)}return ee(this)&&this.path&&(E=!0,F=!0,A+=this.getHeightOfLine(0)*this.zoomX,j+=this.getHeightOfLine(0)*this.zoomY),!!E&&(F?(g.width=Math.ceil(S+A),g.height=Math.ceil(w+j)):(_.setTransform(1,0,0,1,0,0),_.clearRect(0,0,g.width,g.height)),M=x.x/2,P=x.y/2,this.cacheTranslationX=Math.round(g.width/2-M)+M,this.cacheTranslationY=Math.round(g.height/2-P)+P,_.translate(this.cacheTranslationX,this.cacheTranslationY),_.scale(T,O),this.zoomX=T,this.zoomY=O,!0)}setOptions(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(d)}transform(d){const g=this.group&&!this.group._transformDone||this.group&&this.canvas&&d===this.canvas.contextTop,_=this.calcTransformMatrix(!g);d.transform(_[0],_[1],_[2],_[3],_[4],_[5])}getObjectScaling(){if(!this.group)return new ot(Math.abs(this.scaleX),Math.abs(this.scaleY));const d=Ot(this.calcTransformMatrix());return new ot(Math.abs(d.scaleX),Math.abs(d.scaleY))}getTotalObjectScaling(){const d=this.getObjectScaling();if(this.canvas){const g=this.canvas.getZoom(),_=this.getCanvasRetinaScaling();return d.scalarMultiply(g*_)}return d}getObjectOpacity(){let d=this.opacity;return this.group&&(d*=this.group.getObjectOpacity()),d}_constrainScale(d){return Math.abs(d)<this.minScaleLimit?d<0?-this.minScaleLimit:this.minScaleLimit:0===d?1e-4:d}_set(d,g){d!==U&&d!==q||(g=this._constrainScale(g)),d===U&&g<0?(this.flipX=!this.flipX,g*=-1):"scaleY"===d&&g<0?(this.flipY=!this.flipY,g*=-1):"shadow"!==d||!g||g instanceof us||(g=new us(g));const _=this[d]!==g;return this[d]=g,_&&this.constructor.cacheProperties.includes(d)&&(this.dirty=!0),this.parent&&(this.dirty||_&&this.constructor.stateProperties.includes(d))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(d){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(d.save(),this._setupCompositeOperation(d),this.drawSelectionBackground(d),this.transform(d),this._setOpacity(d),this._setShadow(d),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(d)):(this._removeCacheCanvas(),this.drawObject(d),this.dirty=!1),d.restore())}drawSelectionBackground(d){}renderCache(d){d=d||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext&&(this.drawObject(this._cacheContext,d.forClipping),this.dirty=!1)}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!(this.paintFirst===Z&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.parent||!this.parent.isOnACache()),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(d,g){if(d.save(),g.inverted?d.globalCompositeOperation="destination-out":d.globalCompositeOperation="destination-in",g.absolutePositioned){const g=bt(this.calcTransformMatrix());d.transform(g[0],g[1],g[2],g[3],g[4],g[5])}g.transform(d),d.scale(1/g.zoomX,1/g.zoomY),d.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),d.restore()}drawObject(d,g){const _=this.fill,x=this.stroke;g?(this.fill="black",this.stroke="",this._setClippingProperties(d)):this._renderBackground(d),this._render(d),this._drawClipPath(d,this.clipPath),this.fill=_,this.stroke=x}_drawClipPath(d,g){g&&(g._set("canvas",this.canvas),g.shouldCache(),g._transformDone=!0,g.renderCache({forClipping:!0}),this.drawClipPathOnCache(d,g))}drawCacheOnCanvas(d){d.scale(1/this.zoomX,1/this.zoomY),d.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;const g=this._cacheCanvas,_=this._cacheContext;return!(!g||!_||d||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(g&&_&&!d&&(_.save(),_.setTransform(1,0,0,1,0,0),_.clearRect(0,0,g.width,g.height),_.restore()),!0)}_renderBackground(d){if(!this.backgroundColor)return;const g=this._getNonTransformedDimensions();d.fillStyle=this.backgroundColor,d.fillRect(-g.x/2,-g.y/2,g.x,g.y),this._removeShadow(d)}_setOpacity(d){this.group&&!this.group._transformDone?d.globalAlpha=this.getObjectOpacity():d.globalAlpha*=this.opacity}_setStrokeStyles(d,g){const _=g.stroke;_&&(d.lineWidth=g.strokeWidth,d.lineCap=g.strokeLineCap,d.lineDashOffset=g.strokeDashOffset,d.lineJoin=g.strokeLineJoin,d.miterLimit=g.strokeMiterLimit,Zt(_)?"percentage"===_.gradientUnits||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(d,_):(d.strokeStyle=_.toLive(d),this._applyPatternGradientTransform(d,_)):d.strokeStyle=g.stroke)}_setFillStyles(d,g){let{fill:_}=g;_&&(Zt(_)?(d.fillStyle=_.toLive(d),this._applyPatternGradientTransform(d,_)):d.fillStyle=_)}_setClippingProperties(d){d.globalAlpha=1,d.strokeStyle="transparent",d.fillStyle="#000000"}_setLineDash(d,g){g&&0!==g.length&&(1&g.length&&g.push(...g),d.setLineDash(g))}_setShadow(g){if(!this.shadow)return;const _=this.shadow,x=this.canvas,b=this.getCanvasRetinaScaling(),[S,,,w]=(null==x?void 0:x.viewportTransform)||O,T=S*b,D=w*b,k=_.nonScaling?new ot(1,1):this.getObjectScaling();g.shadowColor=_.color,g.shadowBlur=_.blur*d.browserShadowBlurConstant*(T+D)*(k.x+k.y)/4,g.shadowOffsetX=_.offsetX*T*k.x,g.shadowOffsetY=_.offsetY*D*k.y}_removeShadow(d){this.shadow&&(d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0)}_applyPatternGradientTransform(d,g){if(!Zt(g))return{offsetX:0,offsetY:0};const _=g.gradientTransform||g.patternTransform,x=-this.width/2+g.offsetX||0,b=-this.height/2+g.offsetY||0;return"percentage"===g.gradientUnits?d.transform(this.width,0,0,this.height,x,b):d.transform(1,0,0,1,x,b),_&&d.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:x,offsetY:b}}_renderPaintInOrder(d){this.paintFirst===Z?(this._renderStroke(d),this._renderFill(d)):(this._renderFill(d),this._renderStroke(d))}_render(d){}_renderFill(d){this.fill&&(d.save(),this._setFillStyles(d,this),"evenodd"===this.fillRule?d.fill("evenodd"):d.fill(),d.restore())}_renderStroke(d){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(d),d.save(),this.strokeUniform){const g=this.getObjectScaling();d.scale(1/g.x,1/g.y)}this._setLineDash(d,this.strokeDashArray),this._setStrokeStyles(d,this),d.stroke(),d.restore()}}_applyPatternForTransformedGradient(d,g){var _;const x=this._limitCacheSize(this._getCacheCanvasDimensions()),b=pt(),S=this.getCanvasRetinaScaling(),w=x.x/this.scaleX/S,T=x.y/this.scaleY/S;b.width=Math.ceil(w),b.height=Math.ceil(T);const O=b.getContext("2d");O&&(O.beginPath(),O.moveTo(0,0),O.lineTo(w,0),O.lineTo(w,T),O.lineTo(0,T),O.closePath(),O.translate(w/2,T/2),O.scale(x.zoomX/this.scaleX/S,x.zoomY/this.scaleY/S),this._applyPatternGradientTransform(O,g),O.fillStyle=g.toLive(d),O.fill(),d.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),d.scale(S*this.scaleX/x.zoomX,S*this.scaleY/x.zoomY),d.strokeStyle=null!==(_=O.createPattern(b,"no-repeat"))&&void 0!==_?_:"")}_findCenterFromElement(){return new ot(this.left+this.width/2,this.top+this.height/2)}clone(d){const g=this.toObject(d);return this.constructor.fromObject(g)}cloneAsImage(d){const g=this.toCanvasElement(d);return new(at.getClass("image"))(g)}toCanvasElement(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const g=Ce(this),_=this.group,x=this.shadow,b=Math.abs,S=d.enableRetinaScaling?y():1,w=(d.multiplier||1)*S,T=d.canvasProvider||(d=>new ue(d,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,d.withoutTransform&&xe(this),d.withoutShadow&&(this.shadow=null),d.viewportTransform&&Oe(this,this.getViewportTransform()),this.setCoords();const O=pt(),D=this.getBoundingRect(),k=this.shadow,P=new ot;if(k){const d=k.blur,g=k.nonScaling?new ot(1,1):this.getObjectScaling();P.x=2*Math.round(b(k.offsetX)+d)*b(g.x),P.y=2*Math.round(b(k.offsetY)+d)*b(g.y)}const E=D.width+P.x,A=D.height+P.y;O.width=Math.ceil(E),O.height=Math.ceil(A);const j=T(O);"jpeg"===d.format&&(j.backgroundColor="#fff"),this.setPositionByOrigin(new ot(j.width/2,j.height/2),M,M);const F=this.canvas;j._objects=[this],this.set("canvas",j),this.setCoords();const L=j.toCanvasElement(w||1,d);return this.set("canvas",F),this.shadow=x,_&&(this.group=_),this.set(g),this.setCoords(),j._objects=[],j.destroy(),L}toDataURL(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return vt(this.toCanvasElement(d),d.format||"png",d.quality||1)}isType(){for(var d=arguments.length,g=new Array(d),_=0;_<d;_++)g[_]=arguments[_];return g.includes(this.constructor.type)||g.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(d){const{centeredRotation:g,originX:_,originY:x}=this;if(g){const{x:d,y:g}=this.getRelativeCenterPoint();this.originX=M,this.originY=M,this.left=d,this.top=g}if(this.set("angle",d),g){const{x:d,y:g}=this.translateToOriginPoint(this.getRelativeCenterPoint(),_,x);this.left=d,this.top=g,this.originX=_,this.originY=x}}setOnGroup(){}_setupCompositeOperation(d){this.globalCompositeOperation&&(d.globalCompositeOperation=this.globalCompositeOperation)}dispose(){gt.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&p().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(d,g){return Object.entries(d).reduce(((d,_)=>{let[x,b]=_;return d[x]=this._animate(x,b,g),d}),{})}_animate(d,g){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const x=d.split("."),b=this.constructor.colorProperties.includes(x[x.length-1]),{abort:S,startValue:w,onChange:T,onComplete:O}=_,D=s(s({},_),{},{target:this,startValue:null!=w?w:x.reduce(((d,g)=>d[g]),this),endValue:g,abort:null==S?void 0:S.bind(this),onChange:(d,g,_)=>{x.reduce(((g,_,b)=>(b===x.length-1&&(g[_]=d),g[_])),this),T&&T(d,g,_)},onComplete:(d,g,_)=>{this.setCoords(),O&&O(d,g,_)}});return b?js(D):As(D)}isDescendantOf(d){const{parent:g,group:_}=this;return g===d||_===d||!!g&&g.isDescendantOf(d)||!!_&&_!==g&&_.isDescendantOf(d)}getAncestors(){const d=[];let g=this;do{g=g.parent,g&&d.push(g)}while(g);return d}findCommonAncestors(d){if(this===d)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const g=this.getAncestors(),_=d.getAncestors();if(0===g.length&&_.length>0&&this===_[_.length-1])return{fork:[],otherFork:[d,..._.slice(0,_.length-1)],common:[this]};for(let x,b=0;b<g.length;b++){if(x=g[b],x===d)return{fork:[this,...g.slice(0,b)],otherFork:[],common:g.slice(b)};for(let S=0;S<_.length;S++){if(this===_[S])return{fork:[],otherFork:[d,..._.slice(0,S)],common:[this,...g]};if(x===_[S])return{fork:[this,...g.slice(0,b)],otherFork:[d,..._.slice(0,S)],common:g.slice(b)}}}return{fork:[this,...g],otherFork:[d,..._],common:[]}}hasCommonAncestors(d){const g=this.findCommonAncestors(d);return g&&!!g.common.length}isInFrontOf(d){if(this===d)return;const g=this.findCommonAncestors(d);if(g.fork.includes(d))return!0;if(g.otherFork.includes(this))return!1;const _=g.common[0]||this.canvas;if(!_)return;const x=g.fork.pop(),b=g.otherFork.pop(),S=_._objects.indexOf(x),w=_._objects.indexOf(b);return S>-1&&S>w}toObject(){const g=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(e.customProperties,this.constructor.customProperties||[]);let _;const x=d.NUM_FRACTION_DIGITS,{clipPath:S,fill:w,stroke:T,shadow:O,strokeDashArray:D,left:k,top:M,originX:P,originY:E,width:A,height:j,strokeWidth:F,strokeLineCap:L,strokeDashOffset:B,strokeLineJoin:R,strokeUniform:X,strokeMiterLimit:W,scaleX:Y,scaleY:V,angle:z,flipX:G,flipY:N,opacity:H,visible:U,backgroundColor:q,fillRule:K,paintFirst:Q,globalCompositeOperation:J,skewX:Z,skewY:$}=this;S&&!S.excludeFromExport&&(_=S.toObject(g.concat("inverted","absolutePositioned")));const I=d=>Ut(d,x),tt=s(s({},Bt(this,g)),{},{type:this.constructor.type,version:b,originX:P,originY:E,left:I(k),top:I(M),width:I(A),height:I(j),fill:$t(w)?w.toObject():w,stroke:$t(T)?T.toObject():T,strokeWidth:I(F),strokeDashArray:D?D.concat():D,strokeLineCap:L,strokeDashOffset:B,strokeLineJoin:R,strokeUniform:X,strokeMiterLimit:I(W),scaleX:I(Y),scaleY:I(V),angle:I(z),flipX:G,flipY:N,opacity:I(H),shadow:O?O.toObject():O,visible:U,backgroundColor:q,fillRule:K,paintFirst:Q,globalCompositeOperation:J,skewX:I(Z),skewY:I($)},_?{clipPath:_}:null);return this.includeDefaultValues?tt:this._removeDefaultValues(tt)}toDatalessObject(d){return this.toObject(d)}_removeDefaultValues(d){const g=this.constructor.getDefaults(),_=Object.keys(g).length>0?g:Object.getPrototypeOf(this);return Xt(d,((d,g)=>{if(g===P||g===E||"type"===g)return!0;const x=_[g];return d!==x&&!(Array.isArray(d)&&Array.isArray(x)&&0===d.length&&0===x.length)}))}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(d){let g=i(d,Is),_=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:x}=_,b=i(_,Ys);return It(g,b).then((d=>x?(delete d[x],new this(g[x],d)):new this(d)))}static fromObject(d,g){return this._fromObject(d,g)}};t(Ns,"stateProperties",ps),t(Ns,"cacheProperties",Cs),t(Ns,"ownDefaults",Ss),t(Ns,"type","FabricObject"),t(Ns,"colorProperties",[J,Z,"backgroundColor"]),t(Ns,"customProperties",[]),at.setClass(Ns),at.setClass(Ns,"object");const Xs=(d,g,_)=>(x,b,S,w)=>{const T=g(x,b,S,w);return T&&ke(d,s(s({},Fe(x,b,S,w)),_)),T};function Ws(d){return(g,_,x,b)=>{const{target:S,originX:w,originY:T}=_,O=S.getRelativeCenterPoint(),D=S.translateToOriginPoint(O,w,T),k=d(g,_,x,b);return S.setPositionByOrigin(D,_.originX,_.originY),k}}const Ks=Xs(V,Ws(((d,g,_,x)=>{const b=Re(g,g.originX,g.originY,_,x);if(Me(g.originX)===Me(M)||Me(g.originX)===Me(j)&&b.x<0||Me(g.originX)===Me(P)&&b.x>0){const{target:d}=g,_=d.strokeWidth/(d.strokeUniform?d.scaleX:1),x=Ee(g)?2:1,S=d.width,w=Math.abs(b.x*x/d.scaleX)-_;return d.set("width",Math.max(w,1)),S!==d.width}return!1})));function Vs(d,g,_,x,b){x=x||{};const S=this.sizeX||x.cornerSize||b.cornerSize,T=this.sizeY||x.cornerSize||b.cornerSize,O=void 0!==x.transparentCorners?x.transparentCorners:b.transparentCorners,D=O?Z:J,k=!O&&(x.cornerStrokeColor||b.cornerStrokeColor);let M,P=g,E=_;d.save(),d.fillStyle=x.cornerColor||b.cornerColor||"",d.strokeStyle=x.cornerStrokeColor||b.cornerStrokeColor||"",S>T?(M=S,d.scale(1,T/S),E=_*S/T):T>S?(M=T,d.scale(S/T,1),P=g*T/S):M=S,d.lineWidth=1,d.beginPath(),d.arc(P,E,M/2,0,w,!1),d[D](),k&&d.stroke(),d.restore()}function Hs(d,g,_,x,b){x=x||{};const S=this.sizeX||x.cornerSize||b.cornerSize,w=this.sizeY||x.cornerSize||b.cornerSize,T=void 0!==x.transparentCorners?x.transparentCorners:b.transparentCorners,O=T?Z:J,D=!T&&(x.cornerStrokeColor||b.cornerStrokeColor),k=S/2,M=w/2;d.save(),d.fillStyle=x.cornerColor||b.cornerColor||"",d.strokeStyle=x.cornerStrokeColor||b.cornerStrokeColor||"",d.lineWidth=1,d.translate(g,_);const P=b.getTotalAngle();d.rotate(yt(P)),d["".concat(O,"Rect")](-k,-M,S,w),D&&d.strokeRect(-k,-M,S,w),d.restore()}class zs{constructor(d){t(this,"visible",!0),t(this,"actionName",H),t(this,"angle",0),t(this,"x",0),t(this,"y",0),t(this,"offsetX",0),t(this,"offsetY",0),t(this,"sizeX",0),t(this,"sizeY",0),t(this,"touchSizeX",0),t(this,"touchSizeY",0),t(this,"cursorStyle","crosshair"),t(this,"withConnection",!1),Object.assign(this,d)}shouldActivate(d,g,_,x){var b;let{tl:S,tr:w,br:T,bl:O}=x;return(null===(b=g.canvas)||void 0===b?void 0:b.getActiveObject())===g&&g.isControlVisible(d)&&Fs.isPointInPolygon(_,[S,w,T,O])}getActionHandler(d,g,_){return this.actionHandler}getMouseDownHandler(d,g,_){return this.mouseDownHandler}getMouseUpHandler(d,g,_){return this.mouseUpHandler}cursorStyleHandler(d,g,_){return g.cursorStyle}getActionName(d,g,_){return g.actionName}getVisibility(d,g){var _,x;return null!==(_=null===(x=d._controlsVisibility)||void 0===x?void 0:x[g])&&void 0!==_?_:this.visible}setVisibility(d,g,_){this.visible=d}positionHandler(d,g,_,x){return new ot(this.x*d.x+this.offsetX,this.y*d.y+this.offsetY).transform(g)}calcCornerCoords(d,g,_,x,b,S){const w=St([kt(_,x),Dt({angle:d}),Mt((b?this.touchSizeX:this.sizeX)||g,(b?this.touchSizeY:this.sizeY)||g)]);return{tl:new ot(-.5,-.5).transform(w),tr:new ot(.5,-.5).transform(w),br:new ot(.5,.5).transform(w),bl:new ot(-.5,.5).transform(w)}}render(d,g,_,x,b){"circle"===((x=x||{}).cornerStyle||b.cornerStyle)?Vs.call(this,d,g,_,x,b):Hs.call(this,d,g,_,x,b)}}const Gs=(d,g,_)=>_.lockRotation?Ye:g.cursorStyle,Zs=Xs(X,Ws(((d,g,_,x)=>{let{target:b,ex:S,ey:w,theta:T,originX:O,originY:D}=g;const k=b.translateToOriginPoint(b.getRelativeCenterPoint(),O,D);if(je(b,"lockRotation"))return!1;const M=Math.atan2(w-k.y,S-k.x),P=Math.atan2(x-k.y,_-k.x);let E=_t(P-M+T);if(b.snapAngle&&b.snapAngle>0){const d=b.snapAngle,g=b.snapThreshold||d,_=Math.ceil(E/d)*d,x=Math.floor(E/d)*d;Math.abs(E-x)<g?E=x:Math.abs(E-_)<g&&(E=_)}E<0&&(E=360+E),E%=360;const A=b.angle!==E;return b.angle=E,A})));function Us(d,g){const _=g.canvas,x=d[_.uniScaleKey];return _.uniformScaling&&!x||!_.uniformScaling&&x}function qs(d,g,_){const x=je(d,"lockScalingX"),b=je(d,"lockScalingY");if(x&&b)return!0;if(!g&&(x||b)&&_)return!0;if(x&&"x"===g)return!0;if(b&&"y"===g)return!0;const{width:S,height:w,strokeWidth:T}=d;return 0===S&&0===T&&"y"!==g||0===w&&0===T&&"x"!==g}const $s=["e","se","s","sw","w","nw","n","ne","e"],Js=(d,g,_)=>{const x=Us(d,_);if(qs(_,0!==g.x&&0===g.y?"x":0===g.x&&0!==g.y?"y":"",x))return Ye;const b=Le(_,g);return"".concat($s[b],"-resize")};function Qs(d,g,_,x){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const S=g.target,w=b.by,T=Us(d,S);let O,D,k,M,P,E;if(qs(S,w,T))return!1;if(g.gestureScale)D=g.scaleX*g.gestureScale,k=g.scaleY*g.gestureScale;else{if(O=Re(g,g.originX,g.originY,_,x),P="y"!==w?Math.sign(O.x||g.signX||1):1,E="x"!==w?Math.sign(O.y||g.signY||1):1,g.signX||(g.signX=P),g.signY||(g.signY=E),je(S,"lockScalingFlip")&&(g.signX!==P||g.signY!==E))return!1;if(M=S._getTransformedDimensions(),T&&!w){const d=Math.abs(O.x)+Math.abs(O.y),{original:_}=g,x=d/(Math.abs(M.x*_.scaleX/S.scaleX)+Math.abs(M.y*_.scaleY/S.scaleY));D=_.scaleX*x,k=_.scaleY*x}else D=Math.abs(O.x*S.scaleX/M.x),k=Math.abs(O.y*S.scaleY/M.y);Ee(g)&&(D*=2,k*=2),g.signX!==P&&"y"!==w&&(g.originX=Ae(g.originX),D*=-1,g.signX=P),g.signY!==E&&"x"!==w&&(g.originY=Ae(g.originY),k*=-1,g.signY=E)}const A=S.scaleX,j=S.scaleY;return w?("x"===w&&S.set(U,D),"y"===w&&S.set(q,k)):(!je(S,"lockScalingX")&&S.set(U,D),!je(S,"lockScalingY")&&S.set(q,k)),A!==S.scaleX||j!==S.scaleY}const ti=Xs(R,Ws(((d,g,_,x)=>Qs(d,g,_,x)))),ei=Xs(R,Ws(((d,g,_,x)=>Qs(d,g,_,x,{by:"x"})))),si=Xs(R,Ws(((d,g,_,x)=>Qs(d,g,_,x,{by:"y"})))),ii=["target","ex","ey","skewingSide"],Ci={x:{counterAxis:"y",scale:U,skew:K,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:q,skew:Q,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Mi=["ns","nesw","ew","nwse"],ri=(d,g,_)=>{if(0!==g.x&&je(_,"lockSkewingY"))return Ye;if(0!==g.y&&je(_,"lockSkewingX"))return Ye;const x=Le(_,g)%4;return"".concat(Mi[x],"-resize")};function ni(d,g,_,x,b){const{target:S}=_,{counterAxis:w,origin:T,lockSkewing:O,skew:D,flip:k}=Ci[d];if(je(S,O))return!1;const{origin:P,flip:E}=Ci[w],A=Me(_[P])*(S[E]?-1:1),j=-Math.sign(A)*(S[k]?-1:1),F=-(0===S[D]&&Re(_,M,M,x,b)[d]>0||S[D]>0?1:-1)*j*.5+.5,L=Xs(Y,Ws(((g,_,x,b)=>function(d,g,_){let{target:x,ex:b,ey:S,skewingSide:w}=g,T=i(g,ii);const{skew:O}=Ci[d],D=_.subtract(new ot(b,S)).divide(new ot(x.scaleX,x.scaleY))[d],k=x[O],M=T[O],P=Math.tan(yt(M)),E="y"===d?x._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:x._getTransformedDimensions({scaleX:1,scaleY:1}).y,A=2*D*w/Math.max(E,1)+P,j=_t(Math.atan(A));x.set(O,j);const F=k!==x[O];if(F&&"y"===d){const{skewX:d,scaleX:g}=x,_=x._getTransformedDimensions({skewY:k}),b=x._getTransformedDimensions(),S=0!==d?_.x/b.x:1;1!==S&&x.set(U,S*g)}return F}(d,_,new ot(x,b)))));return L(g,s(s({},_),{},{[T]:F,skewingSide:j}),x,b)}const oi=(d,g,_,x)=>ni("x",d,g,_,x),ai=(d,g,_,x)=>ni("y",d,g,_,x);function hi(d,g){return d[g.canvas.altActionKey]}const ci=(d,g,_)=>{const x=hi(d,_);return 0===g.x?x?K:q:0===g.y?x?Q:U:""},li=(d,g,_)=>hi(d,_)?ri(0,g,_):Js(d,g,_),ui=(d,g,_,x)=>hi(d,g.target)?ai(d,g,_,x):ei(d,g,_,x),di=(d,g,_,x)=>hi(d,g.target)?oi(d,g,_,x):si(d,g,_,x),gi=()=>({ml:new zs({x:-.5,y:0,cursorStyleHandler:li,actionHandler:ui,getActionName:ci}),mr:new zs({x:.5,y:0,cursorStyleHandler:li,actionHandler:ui,getActionName:ci}),mb:new zs({x:0,y:.5,cursorStyleHandler:li,actionHandler:di,getActionName:ci}),mt:new zs({x:0,y:-.5,cursorStyleHandler:li,actionHandler:di,getActionName:ci}),tl:new zs({x:-.5,y:-.5,cursorStyleHandler:Js,actionHandler:ti}),tr:new zs({x:.5,y:-.5,cursorStyleHandler:Js,actionHandler:ti}),bl:new zs({x:-.5,y:.5,cursorStyleHandler:Js,actionHandler:ti}),br:new zs({x:.5,y:.5,cursorStyleHandler:Js,actionHandler:ti}),mtr:new zs({x:0,y:-.5,actionHandler:Zs,cursorStyleHandler:Gs,offsetY:-40,withConnection:!0,actionName:W})}),fi=()=>({mr:new zs({x:.5,y:0,actionHandler:Ks,cursorStyleHandler:li,actionName:V}),ml:new zs({x:-.5,y:0,actionHandler:Ks,cursorStyleHandler:li,actionName:V})}),pi=()=>s(s({},gi()),fi());class mi extends Ns{static getDefaults(){return s(s({},super.getDefaults()),mi.ownDefaults)}constructor(d){super(),Object.assign(this,this.constructor.createControls(),mi.ownDefaults),this.setOptions(d)}static createControls(){return{controls:gi()}}_updateCacheCanvas(){const d=this.canvas;if(this.noScaleCache&&d&&d._currentTransform){const g=d._currentTransform,_=g.target,x=g.action;if(this===_&&x&&x.startsWith(H))return!1}return super._updateCacheCanvas()}getActiveControl(){const d=this.__corner;return d?{key:d,control:this.controls[d],coord:this.oCoords[d]}:void 0}findControl(d){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const _=Object.entries(this.oCoords);for(let x=_.length-1;x>=0;x--){const[b,S]=_[x],w=this.controls[b];if(w.shouldActivate(b,this,d,g?S.touchCorner:S.corner))return this.__corner=b,{key:b,control:w,coord:this.oCoords[b]}}}calcOCoords(){const d=this.getViewportTransform(),g=this.getCenterPoint(),_=kt(g.x,g.y),x=Dt({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),b=wt(_,x),S=wt(d,b),w=wt(S,[1/d[0],0,0,1/d[3],0,0]),T=this.group?Ot(this.calcTransformMatrix()):void 0;T&&(T.scaleX=Math.abs(T.scaleX),T.scaleY=Math.abs(T.scaleY));const O=this._calculateCurrentDimensions(T),D={};return this.forEachControl(((d,g)=>{const _=d.positionHandler(O,w,this,d);D[g]=Object.assign(_,this._calcCornerCoords(d,_))})),D}_calcCornerCoords(d,g){const _=this.getTotalAngle();return{corner:d.calcCornerCoords(_,this.cornerSize,g.x,g.y,!1,this),touchCorner:d.calcCornerCoords(_,this.touchCornerSize,g.x,g.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(d){for(const g in this.controls)d(this.controls[g],g,this)}drawSelectionBackground(d){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;d.save();const g=this.getRelativeCenterPoint(),_=this._calculateCurrentDimensions(),x=this.getViewportTransform();d.translate(g.x,g.y),d.scale(1/x[0],1/x[3]),d.rotate(yt(this.angle)),d.fillStyle=this.selectionBackgroundColor,d.fillRect(-_.x/2,-_.y/2,_.x,_.y),d.restore()}strokeBorders(d,g){d.strokeRect(-g.x/2,-g.y/2,g.x,g.y)}_drawBorders(d,g){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const x=s({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},_);d.save(),d.strokeStyle=x.borderColor,this._setLineDash(d,x.borderDashArray),this.strokeBorders(d,g),x.hasControls&&this.drawControlsConnectingLines(d,g),d.restore()}_renderControls(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{hasBorders:_,hasControls:x}=this,b=s({hasBorders:_,hasControls:x},g),S=this.getViewportTransform(),w=b.hasBorders,T=b.hasControls,O=wt(S,this.calcTransformMatrix()),D=Ot(O);d.save(),d.translate(D.translateX,D.translateY),d.lineWidth=1*this.borderScaleFactor,this.group===this.parent&&(d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(D.angle-=180),d.rotate(yt(this.group?D.angle:this.angle)),w&&this.drawBorders(d,D,g),T&&this.drawControls(d,g),d.restore()}drawBorders(d,g,_){let x;if(_&&_.forActiveSelection||this.group){const d=be(this.width,this.height,jt(g)),_=this.isStrokeAccountedForInDimensions()?Wt:(this.strokeUniform?(new ot).scalarAdd(this.canvas?this.canvas.getZoom():1):new ot(g.scaleX,g.scaleY)).scalarMultiply(this.strokeWidth);x=d.add(_).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else x=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(d,x,_)}drawControlsConnectingLines(d,g){let _=!1;d.beginPath(),this.forEachControl(((x,b)=>{x.withConnection&&x.getVisibility(this,b)&&(_=!0,d.moveTo(x.x*g.x,x.y*g.y),d.lineTo(x.x*g.x+x.offsetX,x.y*g.y+x.offsetY))})),_&&d.stroke()}drawControls(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.save();const _=this.getCanvasRetinaScaling(),{cornerStrokeColor:x,cornerDashArray:b,cornerColor:S}=this,w=s({cornerStrokeColor:x,cornerDashArray:b,cornerColor:S},g);d.setTransform(_,0,0,_,0,0),d.strokeStyle=d.fillStyle=w.cornerColor,this.transparentCorners||(d.strokeStyle=w.cornerStrokeColor),this._setLineDash(d,w.cornerDashArray),this.forEachControl(((g,_)=>{if(g.getVisibility(this,_)){const x=this.oCoords[_];g.render(d,x.x,x.y,w,this)}})),d.restore()}isControlVisible(d){return this.controls[d]&&this.controls[d].getVisibility(this,d)}setControlVisible(d,g){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[d]=g}setControlsVisibility(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(d).forEach((d=>{let[g,_]=d;return this.setControlVisible(g,_)}))}clearContextTop(d){if(!this.canvas)return;const g=this.canvas.contextTop;if(!g)return;const _=this.canvas.viewportTransform;g.save(),g.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this.transform(g);const x=this.width+4,b=this.height+4;return g.clearRect(-x/2,-b/2,x,b),d||g.restore(),g}onDeselect(d){return!1}onSelect(d){return!1}shouldStartDragging(d){return!1}onDragStart(d){return!1}canDrop(d){return!1}renderDragSourceEffect(d){}renderDropTargetEffect(d){}}function vi(d,g){return g.forEach((g=>{Object.getOwnPropertyNames(g.prototype).forEach((_=>{"constructor"!==_&&Object.defineProperty(d.prototype,_,Object.getOwnPropertyDescriptor(g.prototype,_)||Object.create(null))}))})),d}t(mi,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class yi extends mi{}vi(yi,[Be]),at.setClass(yi),at.setClass(yi,"object");const _i=(d,g,_,x)=>{const b=2*(x=Math.round(x))+1,{data:S}=d.getImageData(g-x,_-x,b,b);for(let d=3;d<S.length;d+=4)if(S[d]>0)return!1;return!0};class xi{constructor(d){this.options=d,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new ot(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new ot(1/this.options.scaleX,1/this.options.scaleY):new ot(1,1)}createSideVector(d,g){const _=ts(d,g);return this.options.strokeUniform?_.multiply(this.scale):_}projectOrthogonally(d,g,_){return this.applySkew(d.add(this.calcOrthogonalProjection(d,g,_)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(d){const g=new ot(d);return g.y+=g.x*Math.tan(yt(this.options.skewY)),g.x+=g.y*Math.tan(yt(this.options.skewX)),g}scaleUnitVector(d,g){return d.multiply(this.strokeUniformScalar).scalarMultiply(g)}}const ji=new ot;class bi extends xi{static getOrthogonalRotationFactor(d,g){const _=g?ss(d,g):is(d);return Math.abs(_)<S?-1:1}constructor(d,g,_,x){super(x),t(this,"AB",void 0),t(this,"AC",void 0),t(this,"alpha",void 0),t(this,"bisector",void 0),this.A=new ot(d),this.B=new ot(g),this.C=new ot(_),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=ss(this.AB,this.AC),this.bisector=rs($e(this.AB.eq(ji)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(d,g){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const x=this.createSideVector(d,g),b=ns(x),S=bi.getOrthogonalRotationFactor(b,this.bisector);return this.scaleUnitVector(b,_*S)}projectBevel(){const d=[];return(this.alpha%w==0?[this.B]:[this.B,this.C]).forEach((g=>{d.push(this.projectOrthogonally(this.A,g)),d.push(this.projectOrthogonally(this.A,g,-this.strokeProjectionMagnitude))})),d}projectMiter(){const d=[],g=Math.abs(this.alpha),_=1/Math.sin(g/2),x=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*_),b=this.options.strokeUniform?es(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return es(x)/this.strokeProjectionMagnitude<=b&&d.push(this.applySkew(this.A.add(x))),d.push(...this.projectBevel()),d}projectRoundNoSkew(d,g){const _=[],x=new ot(bi.getOrthogonalRotationFactor(this.bisector),bi.getOrthogonalRotationFactor(new ot(this.bisector.y,this.bisector.x)));return[new ot(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(x),new ot(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(x)].forEach((x=>{hs(x,d,g)&&_.push(this.A.add(x))})),_}projectRoundWithSkew(d,g){const _=[],{skewX:x,skewY:b,scaleX:S,scaleY:w,strokeUniform:T}=this.options,O=new ot(Math.tan(yt(x)),Math.tan(yt(b))),D=this.strokeProjectionMagnitude,k=T?D/w/Math.sqrt(1/w**2+1/S**2*O.y**2):D/Math.sqrt(1+O.y**2),M=new ot(Math.sqrt(Math.max(D**2-k**2,0)),k),P=T?D/Math.sqrt(1+O.x**2*(1/w)**2/(1/S+1/S*O.x*O.y)**2):D/Math.sqrt(1+O.x**2/(1+O.x*O.y)**2),E=new ot(P,Math.sqrt(Math.max(D**2-P**2,0)));return[E,E.scalarMultiply(-1),M,M.scalarMultiply(-1)].map((d=>this.applySkew(T?d.multiply(this.strokeUniformScalar):d))).forEach((x=>{hs(x,d,g)&&_.push(this.applySkew(this.A).add(x))})),_}projectRound(){const d=[];d.push(...this.projectBevel());const g=this.alpha%w==0,_=this.applySkew(this.A),x=d[g?0:2].subtract(_),b=d[g?1:0].subtract(_),S=g?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),T=os(x,S)>0,O=T?x:b,D=T?b:x;return this.isSkewed()?d.push(...this.projectRoundWithSkew(O,D)):d.push(...this.projectRoundNoSkew(O,D)),d}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((d=>({originPoint:this.A,projectedPoint:d,angle:this.alpha,bisector:this.bisector})))}}class wi extends xi{constructor(d,g,_){super(_),this.A=new ot(d),this.T=new ot(g)}calcOrthogonalProjection(d,g){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const x=this.createSideVector(d,g);return this.scaleUnitVector(ns(x),_)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const d=[];if(!this.isSkewed()&&this.A.eq(this.T)){const g=new ot(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);d.push(this.applySkew(this.A.add(g)),this.applySkew(this.A.subtract(g)))}else d.push(...new bi(this.A,this.T,this.T,this.options).projectRound());return d}projectSquare(){const d=[];if(this.A.eq(this.T)){const g=new ot(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);d.push(this.A.add(g),this.A.subtract(g))}else{const g=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),_=this.scaleUnitVector(rs(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),x=this.A.add(_);d.push(x.add(g),x.subtract(g))}return d.map((d=>this.applySkew(d)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((d=>({originPoint:this.A,projectedPoint:d})))}}const Si=function(d,g){let _=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=[];if(0===d.length)return x;const b=d.reduce(((d,g)=>(d[d.length-1].eq(g)||d.push(new ot(g)),d)),[new ot(d[0])]);if(1===b.length)_=!0;else if(!_){const d=b[0],g=((d,g)=>{for(let _=d.length-1;_>=0;_--)if(g(d[_],_,d))return _;return-1})(b,(g=>!g.eq(d)));b.splice(g+1)}return b.forEach(((d,b,S)=>{let w,T;0===b?(T=S[1],w=_?d:S[S.length-1]):b===S.length-1?(w=S[b-1],T=_?d:S[0]):(w=S[b-1],T=S[b+1]),_&&1===S.length?x.push(...new wi(d,d,g).project()):!_||0!==b&&b!==S.length-1?x.push(...new bi(d,w,T,g).project()):x.push(...new wi(d,0===b?T:w,g).project())})),x},Ti=d=>{const g={};return Object.keys(d).forEach((_=>{g[_]={},Object.keys(d[_]).forEach((x=>{g[_][x]=s({},d[_][x])}))})),g},Oi=d=>d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ki=d=>{const g=[];for(let _,x=0;x<d.length;x++)!1!==(_=Di(d,x))&&g.push(_);return g},Di=(d,g)=>{const _=d.charCodeAt(g);if(isNaN(_))return"";if(_<55296||_>57343)return d.charAt(g);if(55296<=_&&_<=56319){if(d.length<=g+1)throw"High surrogate without following low surrogate";const _=d.charCodeAt(g+1);if(56320>_||_>57343)throw"High surrogate without following low surrogate";return d.charAt(g)+d.charAt(g+1)}if(0===g)throw"Low surrogate without preceding high surrogate";const x=d.charCodeAt(g-1);if(55296>x||x>56319)throw"Low surrogate without preceding high surrogate";return!1};var Ii=Object.freeze({__proto__:null,capitalize:function(d){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(d.charAt(0).toUpperCase()).concat(g?d.slice(1):d.slice(1).toLowerCase())},escapeXml:Oi,graphemeSplit:ki});const Pi=function(d,g){let _=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return d.fill!==g.fill||d.stroke!==g.stroke||d.strokeWidth!==g.strokeWidth||d.fontSize!==g.fontSize||d.fontFamily!==g.fontFamily||d.fontWeight!==g.fontWeight||d.fontStyle!==g.fontStyle||d.textBackgroundColor!==g.textBackgroundColor||d.deltaY!==g.deltaY||_&&(d.overline!==g.overline||d.underline!==g.underline||d.linethrough!==g.linethrough)},Ei=(d,g)=>{const _=g.split("\n"),x=[];let b=-1,S={};d=Ti(d);for(let g=0;g<_.length;g++){const w=ki(_[g]);if(d[g])for(let _=0;_<w.length;_++){b++;const w=d[g][_];w&&Object.keys(w).length>0&&(Pi(S,w,!0)?x.push({start:b,end:b+1,style:w}):x[x.length-1].end++),S=w||{}}else b+=w.length,S={}}return x},Ai=(d,g)=>{if(!Array.isArray(d))return Ti(d);const _=g.split(L),x={};let b=-1,S=0;for(let g=0;g<_.length;g++){const w=ki(_[g]);for(let _=0;_<w.length;_++)b++,d[S]&&d[S].start<=b&&b<d[S].end&&(x[g]=x[g]||{},x[g][_]=s({},d[S].style),b===d[S].end-1&&S++)}return x},Xi=["display","transform",J,"fill-opacity","fill-rule","opacity",Z,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function Fi(d,g){const _=d.nodeName,x=d.getAttribute("class"),b=d.getAttribute("id"),S="(?![a-zA-Z\\-]+)";let w;if(w=new RegExp("^"+_,"i"),g=g.replace(w,""),b&&g.length&&(w=new RegExp("#"+b+S,"i"),g=g.replace(w,"")),x&&g.length){const d=x.split(" ");for(let _=d.length;_--;)w=new RegExp("\\."+d[_]+S,"i"),g=g.replace(w,"")}return 0===g.length}function Li(d,g){let _=!0;const x=Fi(d,g.pop());return x&&g.length&&(_=function(d,g){let _,x=!0;for(;d.parentElement&&1===d.parentElement.nodeType&&g.length;)x&&(_=g.pop()),x=Fi(d=d.parentElement,_);return 0===g.length}(d,g)),x&&_&&0===g.length}const Ri=d=>{var g;return null!==(g=He[d])&&void 0!==g?g:d},Wi=new RegExp("(".concat(ze,")"),"gi"),Bi=d=>d.replace(Wi," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var Yi,Vi,zi,Gi,Ni,Hi,Ui;const qi="(".concat(ze,")"),Ki=String.raw(Yi||(Yi=r(["(skewX)(",")"],["(skewX)\\(","\\)"])),qi),Qi=String.raw(Vi||(Vi=r(["(skewY)(",")"],["(skewY)\\(","\\)"])),qi),Ji=String.raw(zi||(zi=r(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),qi,qi,qi),Zi=String.raw(Gi||(Gi=r(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),qi,qi),$i=String.raw(Ni||(Ni=r(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),qi,qi),tr=String.raw(Hi||(Hi=r(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),qi,qi,qi,qi,qi,qi),er="(?:".concat(tr,"|").concat($i,"|").concat(Ji,"|").concat(Zi,"|").concat(Ki,"|").concat(Qi,")"),sr="(?:".concat(er,"*)"),ir=String.raw(Ui||(Ui=r(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),sr),rr=new RegExp(ir),lr=new RegExp(er),dr=new RegExp(er,"g");function nr(d){const g=[];if(!(d=Bi(d).replace(/\s*([()])\s*/gi,"$1"))||d&&!rr.test(d))return[...O];for(const _ of d.matchAll(dr)){const d=lr.exec(_[0]);if(!d)continue;let x=O;const b=d.filter((d=>!!d)),[,S,...w]=b,[T,D,k,M,P,E]=w.map((d=>parseFloat(d)));switch(S){case"translate":x=kt(T,D);break;case W:x=Dt({angle:T},{x:D,y:k});break;case H:x=Mt(T,D);break;case K:x=Et(T);break;case Q:x=At(T);break;case"matrix":x=[T,D,k,M,P,E]}g.push(x)}return St(g)}function or(d,g,_,x){const b=Array.isArray(g);let S,w=g;if(d!==J&&d!==Z||g!==F){if("strokeUniform"===d)return"non-scaling-stroke"===g;if("strokeDashArray"===d)w=g===F?null:g.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===d)w=_&&_.transformMatrix?wt(_.transformMatrix,nr(g)):nr(g);else if("visible"===d)w=g!==F&&"hidden"!==g,_&&!1===_.visible&&(w=!1);else if("opacity"===d)w=parseFloat(g),_&&void 0!==_.opacity&&(w*=_.opacity);else if("textAnchor"===d)w="start"===g?P:"end"===g?j:M;else if("charSpacing"===d)S=qt(g,x)/x*1e3;else if("paintFirst"===d){const d=g.indexOf(J),_=g.indexOf(Z);w=J,(d>-1&&_>-1&&_<d||-1===d&&_>-1)&&(w=Z)}else{if("href"===d||"xlink:href"===d||"font"===d||"id"===d)return g;if("imageSmoothing"===d)return"optimizeQuality"===g;S=b?g.map(qt):qt(g,x)}}else w="";return!b&&isNaN(S)?w:S}function ar(d,g){const _=d.match(Ne);if(!_)return;const x=_[1],b=_[3],S=_[4],w=_[5],T=_[6];x&&(g.fontStyle=x),b&&(g.fontWeight=isNaN(parseFloat(b))?b:parseFloat(b)),S&&(g.fontSize=qt(S)),T&&(g.fontFamily=T),w&&(g.lineHeight="normal"===w?1:w)}function hr(d,g){d.replace(/;\s*$/,"").split(";").forEach((d=>{if(!d)return;const[_,x]=d.split(":");g[_.trim().toLowerCase()]=x.trim()}))}function cr(d){const g={},_=d.getAttribute("style");return _?("string"==typeof _?hr(_,g):function(d,g){Object.entries(d).forEach((d=>{let[_,x]=d;void 0!==x&&(g[_.toLowerCase()]=x)}))}(_,g),g):g}const gr={stroke:"strokeOpacity",fill:"fillOpacity"};function ur(d,g,_){if(!d)return{};let x,b={},S=D;d.parentNode&&Je.test(d.parentNode.nodeName)&&(b=ur(d.parentElement,g,_),b.fontSize&&(x=S=qt(b.fontSize)));const w=s(s(s({},g.reduce(((g,_)=>{const x=d.getAttribute(_);return x&&(g[_]=x),g}),{})),function(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_={};for(const x in g)Li(d,x.split(" "))&&(_=s(s({},_),g[x]));return _}(d,_)),cr(d));w[qe]&&d.setAttribute(qe,w[qe]),w[Ue]&&(x=qt(w[Ue],S),w[Ue]="".concat(x));const T={};for(const d in w){const g=Ri(d),_=or(g,w[d],b,x);T[g]=_}T&&T.font&&ar(T.font,T);const O=s(s({},b),T);return Je.test(d.nodeName)?O:function(d){const g=yi.getDefaults();return Object.entries(gr).forEach((_=>{let[x,b]=_;if(void 0===d[b]||""===d[x])return;if(void 0===d[x]){if(!g[x])return;d[x]=g[x]}if(0===d[x].indexOf("url("))return;const S=new Nt(d[x]);d[x]=S.setAlpha(Ut(S.getAlpha()*d[b],2)).toRgba()})),d}(O)}const pr=["left","top","width","height","visible"],mr=["rx","ry"];class fr extends yi{static getDefaults(){return s(s({},super.getDefaults()),fr.ownDefaults)}constructor(d){super(),Object.assign(this,fr.ownDefaults),this.setOptions(d),this._initRxRy()}_initRxRy(){const{rx:d,ry:g}=this;d&&!g?this.ry=d:g&&!d&&(this.rx=g)}_render(d){const{width:g,height:_}=this,x=-g/2,b=-_/2,S=this.rx?Math.min(this.rx,g/2):0,w=this.ry?Math.min(this.ry,_/2):0,T=0!==S||0!==w;d.beginPath(),d.moveTo(x+S,b),d.lineTo(x+g-S,b),T&&d.bezierCurveTo(x+g-k*S,b,x+g,b+k*w,x+g,b+w),d.lineTo(x+g,b+_-w),T&&d.bezierCurveTo(x+g,b+_-k*w,x+g-k*S,b+_,x+g-S,b+_),d.lineTo(x+S,b+_),T&&d.bezierCurveTo(x+k*S,b+_,x,b+_-k*w,x,b+_-w),d.lineTo(x,b+w),T&&d.bezierCurveTo(x,b+k*w,x+k*S,b,x+S,b),d.closePath(),this._renderPaintInOrder(d)}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...mr,...d])}_toSVG(){const{width:d,height:g,rx:_,ry:x}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-d/2,'" y="').concat(-g/2,'" rx="').concat(_,'" ry="').concat(x,'" width="').concat(d,'" height="').concat(g,'" />\n')]}static async fromElement(d,g,_){const x=ur(d,this.ATTRIBUTE_NAMES,_),{left:b=0,top:S=0,width:w=0,height:T=0,visible:O=!0}=x,D=i(x,pr);return new this(s(s(s({},g),D),{},{left:b,top:S,width:w,height:T,visible:Boolean(O&&w&&T)}))}}t(fr,"type","Rect"),t(fr,"cacheProperties",[...Cs,...mr]),t(fr,"ownDefaults",{rx:0,ry:0}),t(fr,"ATTRIBUTE_NAMES",[...Xi,"x","y","rx","ry","width","height"]),at.setClass(fr),at.setSVGClass(fr);const vr="initialization",yr="added",br="removed",Sr="imperative",_r=(d,g)=>{const{strokeUniform:_,strokeWidth:x,width:b,height:S,group:w}=g,T=w&&w!==d?we(w.calcTransformMatrix(),d.calcTransformMatrix()):null,O=T?g.getRelativeCenterPoint().transform(T):g.getRelativeCenterPoint(),D=!g.isStrokeAccountedForInDimensions(),k=_&&D?Te(new ot(x,x),void 0,d.calcTransformMatrix()):Wt,M=!_&&D?x:0,P=be(b+M,S+M,St([T,g.calcOwnMatrix()],!0)).add(k).scalarDivide(2);return[O.subtract(P),O.add(P)]};class xr{calcLayoutResult(d,g){if(this.shouldPerformLayout(d))return this.calcBoundingBox(g,d)}shouldPerformLayout(d){let{type:g,prevStrategy:_,strategy:x}=d;return g===vr||g===Sr||!!_&&x!==_}shouldLayoutClipPath(d){let{type:g,target:{clipPath:_}}=d;return g!==vr&&_&&!_.absolutePositioned}getInitialSize(d,g){return g.size}calcBoundingBox(d,g){const{type:_,target:x}=g;if(_===Sr&&g.overrides)return g.overrides;if(0===d.length)return;const{left:b,top:S,width:w,height:T}=me(d.map((d=>_r(x,d))).reduce(((d,g)=>d.concat(g)),[])),O=new ot(w,T),D=new ot(b,S).add(O.scalarDivide(2));if(_===vr){const d=this.getInitialSize(g,{size:O,center:D});return{center:D,relativeCorrection:new ot(0,0),size:d}}return{center:D.transform(x.calcOwnMatrix()),size:O}}}t(xr,"type","strategy");class Cr extends xr{shouldPerformLayout(d){return!0}}t(Cr,"type","fit-content"),at.setClass(Cr);const wr=["strategy"],Or=["target","strategy","bubbles","prevStrategy"],Er="layoutManager";class Tr{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Cr;t(this,"strategy",void 0),this.strategy=d,this._subscriptions=new Map}performLayout(d){const g=s(s({bubbles:!0,strategy:this.strategy},d),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(g);const _=this.getLayoutResult(g);_&&this.commitLayout(g,_),this.onAfterLayout(g,_),this._prevLayoutStrategy=g.strategy}attachHandlers(d,g){const{target:_}=g;return[$,B,V,X,R,Y,N,z,G].map((g=>d.on(g,(d=>this.performLayout(g===$?{type:"object_modified",trigger:g,e:d,target:_}:{type:"object_modifying",trigger:g,e:d,target:_})))))}subscribe(d,g){this.unsubscribe(d,g);const _=this.attachHandlers(d,g);this._subscriptions.set(d,_)}unsubscribe(d,g){(this._subscriptions.get(d)||[]).forEach((d=>d())),this._subscriptions.delete(d)}unsubscribeTargets(d){d.targets.forEach((g=>this.unsubscribe(g,d)))}subscribeTargets(d){d.targets.forEach((g=>this.subscribe(g,d)))}onBeforeLayout(d){const{target:g,type:_}=d,{canvas:x}=g;if(_===vr||_===yr?this.subscribeTargets(d):_===br&&this.unsubscribeTargets(d),g.fire("layout:before",{context:d}),x&&x.fire("object:layout:before",{target:g,context:d}),_===Sr&&d.deep){const _=i(d,wr);g.forEachObject((d=>d.layoutManager&&d.layoutManager.performLayout(s(s({},_),{},{bubbles:!1,target:d}))))}}getLayoutResult(d){const{target:g,strategy:_,type:x}=d,b=_.calcLayoutResult(d,g.getObjects());if(!b)return;const S=x===vr?new ot:g.getRelativeCenterPoint(),{center:w,correction:T=new ot,relativeCorrection:D=new ot}=b,k=S.subtract(w).add(T).transform(x===vr?O:bt(g.calcOwnMatrix()),!0).add(D);return{result:b,prevCenter:S,nextCenter:w,offset:k}}commitLayout(d,g){const{target:_}=d,{result:{size:x},nextCenter:b}=g;var S,w;_.set({width:x.x,height:x.y}),this.layoutObjects(d,g),d.type===vr?_.set({left:null!==(S=d.x)&&void 0!==S?S:b.x+x.x*Me(_.originX),top:null!==(w=d.y)&&void 0!==w?w:b.y+x.y*Me(_.originY)}):(_.setPositionByOrigin(b,M,M),_.setCoords(),_.set("dirty",!0))}layoutObjects(d,g){const{target:_}=d;_.forEachObject((x=>{x.group===_&&this.layoutObject(d,g,x)})),d.strategy.shouldLayoutClipPath(d)&&this.layoutObject(d,g,_.clipPath)}layoutObject(d,g,_){let{offset:x}=g;_.set({left:_.left+x.x,top:_.top+x.y})}onAfterLayout(d,g){const{target:_,strategy:x,bubbles:b,prevStrategy:S}=d,w=i(d,Or),{canvas:T}=_;_.fire("layout:after",{context:d,result:g}),T&&T.fire("object:layout:after",{context:d,result:g,target:_});const O=_.parent;b&&null!=O&&O.layoutManager&&((w.path||(w.path=[])).push(_),O.layoutManager.performLayout(s(s({},w),{},{target:O}))),_.set("dirty",!0)}dispose(){const{_subscriptions:d}=this;d.forEach((d=>d.forEach((d=>d())))),d.clear()}toObject(){return{type:Er,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}at.setClass(Tr,Er);const Ar=["type","objects","layoutManager"];class kr extends Tr{performLayout(){}}class Dr extends(ct(yi)){static getDefaults(){return s(s({},super.getDefaults()),Dr.ownDefaults)}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),t(this,"_activeObjects",[]),t(this,"__objectSelectionTracker",void 0),t(this,"__objectSelectionDisposer",void 0),Object.assign(this,Dr.ownDefaults),this.setOptions(g),this.groupInit(d,g)}groupInit(d,g){var _;this._objects=[...d],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((d=>{this.enterGroup(d,!1)})),this.layoutManager=null!==(_=g.layoutManager)&&void 0!==_?_:new Tr,this.layoutManager.performLayout({type:vr,target:this,targets:[...d],x:g.left,y:g.top})}canEnterGroup(d){return d===this||this.isDescendantOf(d)?(a("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(d)||(a("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(d){return d.filter(((d,g,_)=>this.canEnterGroup(d)&&_.indexOf(d)===g))}add(){for(var d=arguments.length,g=new Array(d),_=0;_<d;_++)g[_]=arguments[_];const x=this._filterObjectsBeforeEnteringGroup(g),b=super.add(...x);return this._onAfterObjectsChange(yr,x),b}insertAt(d){for(var g=arguments.length,_=new Array(g>1?g-1:0),x=1;x<g;x++)_[x-1]=arguments[x];const b=this._filterObjectsBeforeEnteringGroup(_),S=super.insertAt(d,...b);return this._onAfterObjectsChange(yr,b),S}remove(){const d=super.remove(...arguments);return this._onAfterObjectsChange(br,d),d}_onObjectAdded(d){this.enterGroup(d,!0),this.fire("object:added",{target:d}),d.fire("added",{target:this})}_onObjectRemoved(d,g){this.exitGroup(d,g),this.fire("object:removed",{target:d}),d.fire("removed",{target:this})}_onAfterObjectsChange(d,g){this.layoutManager.performLayout({type:d,targets:g,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(d,g){const _=this[d];return super._set(d,g),"canvas"===d&&_!==g&&(this._objects||[]).forEach((_=>{_._set(d,g)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(d,g){let{target:_}=g;const x=this._activeObjects;if(d)x.push(_),this._set("dirty",!0);else if(x.length>0){const d=x.indexOf(_);d>-1&&(x.splice(d,1),this._set("dirty",!0))}}_watchObject(d,g){d&&this._watchObject(!1,g),d?(g.on("selected",this.__objectSelectionTracker),g.on("deselected",this.__objectSelectionDisposer)):(g.off("selected",this.__objectSelectionTracker),g.off("deselected",this.__objectSelectionDisposer))}enterGroup(d,g){d.group&&d.group.remove(d),d._set("parent",this),this._enterGroup(d,g)}_enterGroup(d,g){g&&_e(d,wt(bt(this.calcTransformMatrix()),d.calcTransformMatrix())),this._shouldSetNestedCoords()&&d.setCoords(),d._set("group",this),d._set("canvas",this.canvas),this._watchObject(!0,d);const _=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();_&&(_===d||d.isDescendantOf(_))&&this._activeObjects.push(d)}exitGroup(d,g){this._exitGroup(d,g),d._set("parent",void 0),d._set("canvas",void 0)}_exitGroup(d,g){d._set("group",void 0),g||(_e(d,wt(this.calcTransformMatrix(),d.calcTransformMatrix())),d.setCoords()),this._watchObject(!1,d);const _=this._activeObjects.length>0?this._activeObjects.indexOf(d):-1;_>-1&&this._activeObjects.splice(_,1)}shouldCache(){const d=yi.prototype.shouldCache.call(this);if(d)for(let d=0;d<this._objects.length;d++)if(this._objects[d].willDrawShadow())return this.ownCaching=!1,!1;return d}willDrawShadow(){if(super.willDrawShadow())return!0;for(let d=0;d<this._objects.length;d++)if(this._objects[d].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(d){this._renderBackground(d);for(let _=0;_<this._objects.length;_++){var g;null!==(g=this.canvas)&&void 0!==g&&g.preserveObjectStacking&&this._objects[_].group!==this?(d.save(),d.transform(...bt(this.calcTransformMatrix())),this._objects[_].render(d),d.restore()):this._objects[_].group===this&&this._objects[_].render(d)}this._drawClipPath(d,this.clipPath)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((d=>d.setCoords()))}triggerLayout(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(s({target:this,type:Sr},d))}render(d){this._transformDone=!0,super.render(d),this._transformDone=!1}__serializeObjects(d,g){const _=this.includeDefaultValues;return this._objects.filter((function(d){return!d.excludeFromExport})).map((function(x){const b=x.includeDefaultValues;x.includeDefaultValues=_;const S=x[d||"toObject"](g);return x.includeDefaultValues=b,S}))}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const g=this.layoutManager.toObject();return s(s(s({},super.toObject(["subTargetCheck","interactive",...d])),"fit-content"!==g.strategy||this.includeDefaultValues?{layoutManager:g}:{}),{},{objects:this.__serializeObjects("toObject",d)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((d=>{this._watchObject(!1,d),d.dispose()})),super.dispose()}_createSVGBgRect(d){if(!this.backgroundColor)return"";const g=fr.prototype._toSVG.call(this),_=g.indexOf("COMMON_PARTS");g[_]='for="group" ';const x=g.join("");return d?d(x):x}_toSVG(d){const g=["<g ","COMMON_PARTS"," >\n"],_=this._createSVGBgRect(d);_&&g.push("\t\t",_);for(let _=0;_<this._objects.length;_++)g.push("\t\t",this._objects[_].toSVG(d));return g.push("</g>\n"),g}getSvgStyles(){const d=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",g=this.visible?"":" visibility: hidden;";return[d,this.getSvgFilter(),g].join("")}toClipPathSVG(d){const g=[],_=this._createSVGBgRect(d);_&&g.push("\t",_);for(let _=0;_<this._objects.length;_++)g.push("\t",this._objects[_].toClipPathSVG(d));return this._createBaseClipPathSVGMarkup(g,{reviver:d})}static fromObject(d,g){let{type:_,objects:x=[],layoutManager:b}=d,S=i(d,Ar);return Promise.all([Rt(x,g),It(S,g)]).then((d=>{let[g,_]=d;const x=new this(g,s(s(s({},S),_),{},{layoutManager:new kr}));if(b){const d=at.getClass(b.type),g=at.getClass(b.strategy);x.layoutManager=new d(new g)}else x.layoutManager=new Tr;return x.layoutManager.subscribeTargets({type:vr,target:x,targets:x.getObjects()}),x.setCoords(),x}))}}t(Dr,"type","Group"),t(Dr,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),at.setClass(Dr);const Mr=(d,g)=>Math.min(g.width/d.width,g.height/d.height),Pr=(d,g)=>Math.max(g.width/d.width,g.height/d.height),jr="\\s*,?\\s*",Fr="".concat(jr,"(").concat(ze,")"),Zr="".concat(Fr).concat(Fr).concat(Fr).concat(jr,"([01])").concat(jr,"([01])").concat(Fr).concat(Fr),$r={m:"l",M:"L"},Lr=(d,g,_,x,b,S,w,T,O,D,k)=>{const M=rt(d),P=nt(d),E=rt(g),A=nt(g),j=_*b*E-x*S*A+w,F=x*b*E+_*S*A+T;return["C",D+O*(-_*b*P-x*S*M),k+O*(-x*b*P+_*S*M),j+O*(_*b*A+x*S*E),F+O*(x*b*A-_*S*E),j,F]},Rr=(d,g,_,x)=>{const b=Math.atan2(g,d),S=Math.atan2(x,_);return S>=b?S-b:2*Math.PI-(b-S)};function Ir(g,_,b,S,w,T,O,D){let k;if(d.cachesBoundsOfCurve&&(k=[...arguments].join(),x.boundsOfCurveCache[k]))return x.boundsOfCurveCache[k];const M=Math.sqrt,P=Math.abs,E=[],A=[[0,0],[0,0]];let j=6*g-12*b+6*w,F=-3*g+9*b-9*w+3*O,L=3*b-3*g;for(let d=0;d<2;++d){if(d>0&&(j=6*_-12*S+6*T,F=-3*_+9*S-9*T+3*D,L=3*S-3*_),P(F)<1e-12){if(P(j)<1e-12)continue;const d=-L/j;0<d&&d<1&&E.push(d);continue}const g=j*j-4*L*F;if(g<0)continue;const x=M(g),b=(-j+x)/(2*F);0<b&&b<1&&E.push(b);const w=(-j-x)/(2*F);0<w&&w<1&&E.push(w)}let B=E.length;const R=B,X=Yr(g,_,b,S,w,T,O,D);for(;B--;){const{x:d,y:g}=X(E[B]);A[0][B]=d,A[1][B]=g}A[0][R]=g,A[1][R]=_,A[0][R+1]=O,A[1][R+1]=D;const W=[new ot(Math.min(...A[0]),Math.min(...A[1])),new ot(Math.max(...A[0]),Math.max(...A[1]))];return d.cachesBoundsOfCurve&&(x.boundsOfCurveCache[k]=W),W}const Br=(d,g,_)=>{let[x,b,S,w,O,D,k,M]=_;const P=((d,g,_,x,b,S,w)=>{if(0===_||0===x)return[];let O=0,D=0,k=0;const M=Math.PI,P=w*T,E=nt(P),A=rt(P),j=.5*(-A*d-E*g),F=.5*(-A*g+E*d),L=_**2,B=x**2,R=F**2,X=j**2,W=L*B-L*R-B*X;let Y=Math.abs(_),V=Math.abs(x);if(W<0){const d=Math.sqrt(1-W/(L*B));Y*=d,V*=d}else k=(b===S?-1:1)*Math.sqrt(W/(L*R+B*X));const z=k*Y*F/V,G=-k*V*j/Y,N=A*z-E*G+.5*d,H=E*z+A*G+.5*g;let U=Rr(1,0,(j-z)/Y,(F-G)/V),q=Rr((j-z)/Y,(F-G)/V,(-j-z)/Y,(-F-G)/V);0===S&&q>0?q-=2*M:1===S&&q<0&&(q+=2*M);const K=Math.ceil(Math.abs(q/M*2)),Q=[],J=q/K,Z=8/3*Math.sin(J/4)*Math.sin(J/4)/Math.sin(J/2);let $=U+J;for(let d=0;d<K;d++)Q[d]=Lr(U,$,A,E,Y,V,N,H,Z,O,D),O=Q[d][5],D=Q[d][6],U=$,$+=J;return Q})(k-d,M-g,b,S,O,D,w);for(let _=0,x=P.length;_<x;_++)P[_][1]+=d,P[_][2]+=g,P[_][3]+=d,P[_][4]+=g,P[_][5]+=d,P[_][6]+=g;return P},Xr=d=>{let g=0,_=0,x=0,b=0;const S=[];let w,T=0,O=0;for(const D of d){const d=[...D];let k;switch(d[0]){case"l":d[1]+=g,d[2]+=_;case"L":g=d[1],_=d[2],k=["L",g,_];break;case"h":d[1]+=g;case"H":g=d[1],k=["L",g,_];break;case"v":d[1]+=_;case"V":_=d[1],k=["L",g,_];break;case"m":d[1]+=g,d[2]+=_;case"M":g=d[1],_=d[2],x=d[1],b=d[2],k=["M",g,_];break;case"c":d[1]+=g,d[2]+=_,d[3]+=g,d[4]+=_,d[5]+=g,d[6]+=_;case"C":T=d[3],O=d[4],g=d[5],_=d[6],k=["C",d[1],d[2],T,O,g,_];break;case"s":d[1]+=g,d[2]+=_,d[3]+=g,d[4]+=_;case"S":"C"===w?(T=2*g-T,O=2*_-O):(T=g,O=_),g=d[3],_=d[4],k=["C",T,O,d[1],d[2],g,_],T=k[3],O=k[4];break;case"q":d[1]+=g,d[2]+=_,d[3]+=g,d[4]+=_;case"Q":T=d[1],O=d[2],g=d[3],_=d[4],k=["Q",T,O,g,_];break;case"t":d[1]+=g,d[2]+=_;case"T":"Q"===w?(T=2*g-T,O=2*_-O):(T=g,O=_),g=d[1],_=d[2],k=["Q",T,O,g,_];break;case"a":d[6]+=g,d[7]+=_;case"A":Br(g,_,d).forEach((d=>S.push(d))),g=d[6],_=d[7];break;case"z":case"Z":g=x,_=b,k=["Z"]}k?(S.push(k),w=k[0]):w=""}return S},Wr=(d,g,_,x)=>Math.sqrt((_-d)**2+(x-g)**2),Yr=(d,g,_,x,b,S,w,T)=>O=>{const D=O**3,k=(d=>3*d**2*(1-d))(O),M=(d=>3*d*(1-d)**2)(O),P=(d=>(1-d)**3)(O);return new ot(w*D+b*k+_*M+d*P,T*D+S*k+x*M+g*P)},Vr=d=>d**2,Hr=d=>2*d*(1-d),zr=d=>(1-d)**2,Gr=(d,g,_,x,b,S,w,T)=>O=>{const D=Vr(O),k=Hr(O),M=zr(O),P=3*(M*(_-d)+k*(b-_)+D*(w-b)),E=3*(M*(x-g)+k*(S-x)+D*(T-S));return Math.atan2(E,P)},Nr=(d,g,_,x,b,S)=>w=>{const T=Vr(w),O=Hr(w),D=zr(w);return new ot(b*T+_*O+d*D,S*T+x*O+g*D)},Ur=(d,g,_,x,b,S)=>w=>{const T=1-w,O=2*(T*(_-d)+w*(b-_)),D=2*(T*(x-g)+w*(S-x));return Math.atan2(D,O)},qr=(d,g,_)=>{let x=new ot(g,_),b=0;for(let g=1;g<=100;g+=1){const _=d(g/100);b+=Wr(x.x,x.y,_.x,_.y),x=_}return b},Kr=(d,g)=>{let _,x=0,b=0,S={x:d.x,y:d.y},w=s({},S),T=.01,O=0;const D=d.iterator,k=d.angleFinder;for(;b<g&&T>1e-4;)w=D(x),O=x,_=Wr(S.x,S.y,w.x,w.y),_+b>g?(x-=T,T/=2):(S=w,x+=T,b+=_);return s(s({},w),{},{angle:k(O)})},Jr=d=>{let g,_,x=0,b=0,S=0,w=0,T=0;const O=[];for(const D of d){const d={x:b,y:S,command:D[0],length:0};switch(D[0]){case"M":_=d,_.x=w=b=D[1],_.y=T=S=D[2];break;case"L":_=d,_.length=Wr(b,S,D[1],D[2]),b=D[1],S=D[2];break;case"C":g=Yr(b,S,D[1],D[2],D[3],D[4],D[5],D[6]),_=d,_.iterator=g,_.angleFinder=Gr(b,S,D[1],D[2],D[3],D[4],D[5],D[6]),_.length=qr(g,b,S),b=D[5],S=D[6];break;case"Q":g=Nr(b,S,D[1],D[2],D[3],D[4]),_=d,_.iterator=g,_.angleFinder=Ur(b,S,D[1],D[2],D[3],D[4]),_.length=qr(g,b,S),b=D[3],S=D[4];break;case"Z":_=d,_.destX=w,_.destY=T,_.length=Wr(b,S,w,T),b=w,S=T}x+=_.length,O.push(_)}return O.push({length:x,x:b,y:S}),O},Qr=function(d,g){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Jr(d),x=0;for(;g-_[x].length>0&&x<_.length-2;)g-=_[x].length,x++;const b=_[x],S=g/b.length,w=d[x];switch(b.command){case"M":return{x:b.x,y:b.y,angle:0};case"Z":return s(s({},new ot(b.x,b.y).lerp(new ot(b.destX,b.destY),S)),{},{angle:Math.atan2(b.destY-b.y,b.destX-b.x)});case"L":return s(s({},new ot(b.x,b.y).lerp(new ot(w[1],w[2]),S)),{},{angle:Math.atan2(w[2]-b.y,w[1]-b.x)});case"C":case"Q":return Kr(b,g)}},tn=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),en=new RegExp(Zr,"g"),ln=new RegExp(ze,"gi"),fn={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},sn=d=>{var g;const _=[],x=null!==(g=d.match(tn))&&void 0!==g?g:[];for(const d of x){const g=d[0];if("z"===g||"Z"===g){_.push([g]);continue}const x=fn[g.toLowerCase()];let b=[];if("a"===g||"A"===g){en.lastIndex=0;for(let g=null;g=en.exec(d);)b.push(...g.slice(1))}else b=d.match(ln)||[];for(let d=0;d<b.length;d+=x){const S=new Array(x),w=$r[g];S[0]=d>0&&w?w:g;for(let g=0;g<x;g++)S[g+1]=parseFloat(b[d+g]);_.push(S)}}return _},rn=function(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,_=new ot(d[0]),x=new ot(d[1]),b=1,S=0;const w=[],T=d.length,O=T>2;let D;for(O&&(b=d[2].x<x.x?-1:d[2].x===x.x?0:1,S=d[2].y<x.y?-1:d[2].y===x.y?0:1),w.push(["M",_.x-b*g,_.y-S*g]),D=1;D<T;D++){if(!_.eq(x)){const d=_.midPointFrom(x);w.push(["Q",_.x,_.y,d.x,d.y])}_=d[D],D+1<d.length&&(x=d[D+1])}return O&&(b=_.x>d[D-2].x?1:_.x===d[D-2].x?0:-1,S=_.y>d[D-2].y?1:_.y===d[D-2].y?0:-1),w.push(["L",_.x+b*g,_.y+S*g]),w},nn=(d,g)=>d.map((d=>d.map(((d,_)=>0===_||void 0===g?d:Ut(d,g))).join(" "))).join(" ");function on(d,g){const _=d.style;_&&g&&("string"==typeof g?_.cssText+=";"+g:Object.entries(g).forEach((d=>{let[g,x]=d;return _.setProperty(g,x)})))}const an=(d,g)=>Math.floor(Math.random()*(g-d+1))+d;function hn(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const _=g.onComplete||C,x=new(v().XMLHttpRequest),b=g.signal,n=function(){x.abort()},o=function(){b&&b.removeEventListener("abort",n),x.onerror=x.ontimeout=C};if(b&&b.aborted)throw new c("request");return b&&b.addEventListener("abort",n,{once:!0}),x.onreadystatechange=function(){4===x.readyState&&(o(),_(x),x.onreadystatechange=C)},x.onerror=x.ontimeout=o,x.open("get",d,!0),x.send(),x}const cn=(d,g)=>{let _=d._findCenterFromElement();d.transformMatrix&&((d=>{if(d.transformMatrix){const{scaleX:g,scaleY:_,angle:x,skewX:b}=Ot(d.transformMatrix);d.flipX=!1,d.flipY=!1,d.set(U,g),d.set(q,_),d.angle=x,d.skewX=b,d.skewY=0}})(d),_=_.transform(d.transformMatrix)),delete d.transformMatrix,g&&(d.scaleX*=g.scaleX,d.scaleY*=g.scaleY,d.cropX=g.cropX,d.cropY=g.cropY,_.x+=g.offsetLeft,_.y+=g.offsetTop,d.width=g.width,d.height=g.height),d.setPositionByOrigin(_,M,M)};var pn=Object.freeze({__proto__:null,addTransformToObject:ye,animate:As,animateColor:js,applyTransformToObject:_e,calcAngleBetweenVectors:ss,calcDimensionsMatrix:jt,calcPlaneChangeMatrix:we,calcVectorRotation:is,cancelAnimFrame:dt,capValue:ds,composeMatrix:Ft,copyCanvasElement:d=>{var g;const _=pt();return _.width=d.width,_.height=d.height,null===(g=_.getContext("2d"))||void 0===g||g.drawImage(d,0,0),_},cos:rt,createCanvasElement:pt,createImage:mt,createRotateMatrix:Dt,createScaleMatrix:Mt,createSkewXMatrix:Et,createSkewYMatrix:At,createTranslateMatrix:kt,createVector:ts,crossProduct:os,degreesToRadians:yt,dotProduct:as,ease:Os,enlivenObjectEnlivables:It,enlivenObjects:Rt,findScaleToCover:Pr,findScaleToFit:Mr,getBoundsOfCurve:Ir,getOrthonormalVector:ns,getPathSegmentsInfo:Jr,getPointOnPath:Qr,getPointer:ge,getRandomInt:an,getRegularPolygonPath:(d,g)=>{const _=2*Math.PI/d;let x=-S;d%2==0&&(x+=_/2);const b=new Array(d+1);for(let S=0;S<d;S++){const d=S*_+x,{x:w,y:T}=new ot(rt(d),nt(d)).scalarMultiply(g);b[S]=[0===S?"M":"L",w,T]}return b[d]=["Z"],b},getSmoothPathFromPoints:rn,getSvgAttributes:d=>{const g=["instantiated_by_use","style","id","class"];switch(d){case"linearGradient":return g.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return g.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return g.concat(["offset","stop-color","stop-opacity"])}return g},getUnitVector:rs,groupSVGElements:(d,g)=>d&&1===d.length?d[0]:new Dr(d,g),hasStyleChanged:Pi,invertTransform:bt,isBetweenVectors:hs,isIdentityMatrix:xt,isTouchEvent:fe,isTransparent:_i,joinPath:nn,loadImage:Lt,magnitude:es,makeBoundingBoxFromPoints:me,makePathSimpler:Xr,matrixToSVG:Jt,mergeClipPaths:(d,g)=>{var _;let x=d,b=g;x.inverted&&!b.inverted&&(x=g,b=d),Oe(b,null===(_=b.group)||void 0===_?void 0:_.calcTransformMatrix(),x.calcTransformMatrix());const S=x.inverted&&b.inverted;return S&&(x.inverted=b.inverted=!1),new Dr([x],{clipPath:b,inverted:S})},multiplyTransformMatrices:wt,multiplyTransformMatrixArray:St,parsePath:sn,parsePreserveAspectRatioAttribute:Kt,parseUnit:qt,pick:Bt,projectStrokeOnPoints:Si,qrDecompose:Ot,radiansToDegrees:_t,removeFromArray:it,removeTransformFromObject:(d,g)=>{const _=bt(g),x=wt(_,d.calcOwnMatrix());_e(d,x)},removeTransformMatrixForSvgParsing:cn,request:hn,requestAnimFrame:ut,resetObjectTransform:xe,rotatePoint:(d,g,_)=>d.rotate(_,g),rotateVector:$e,saveObjectTransform:Ce,sendObjectToPlane:Oe,sendPointToPlane:Se,sendVectorToPlane:Te,setStyle:on,sin:nt,sizeAfterTransform:be,string:Ii,stylesFromArray:Ai,stylesToArray:Ei,toDataURL:vt,toFixed:Ut,transformPath:(d,g,_)=>(_&&(g=wt(g,[1,0,0,1,-_.x,-_.y])),d.map((d=>{const _=[...d];for(let x=1;x<d.length-1;x+=2){const{x:b,y:S}=Ct({x:d[x],y:d[x+1]},g);_[x]=b,_[x+1]=S}return _}))),transformPoint:Ct});class un extends ce{constructor(d){let{allowTouchScrolling:g=!1,containerClass:_=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(d),t(this,"upper",void 0),t(this,"container",void 0);const{el:x}=this.lower,b=this.createUpperCanvas();this.upper={el:b,ctx:b.getContext("2d")},this.applyCanvasStyle(x,{allowTouchScrolling:g}),this.applyCanvasStyle(b,{allowTouchScrolling:g,styles:{position:"absolute",left:"0",top:"0"}});const S=this.createContainerElement();S.classList.add(_),x.parentNode&&x.parentNode.replaceChild(S,x),S.append(x,b),this.container=S}createUpperCanvas(){const{el:d}=this.lower,g=pt();return g.className=d.className,g.classList.remove("lower-canvas"),g.classList.add("upper-canvas"),g.setAttribute("data-fabric","top"),g.style.cssText=d.style.cssText,g.setAttribute("draggable","true"),g}createContainerElement(){const d=m().createElement("div");return d.setAttribute("data-fabric","wrapper"),on(d,{position:"relative"}),he(d),d}applyCanvasStyle(d,g){const{styles:_,allowTouchScrolling:x}=g;on(d,s(s({},_),{},{"touch-action":x?"manipulation":F})),he(d)}setDimensions(d,g){super.setDimensions(d,g);const{el:_,ctx:x}=this.upper;oe(_,x,d,g)}setCSSDimensions(d){super.setCSSDimensions(d),ae(this.upper.el,d),ae(this.container,d)}cleanupDOM(d){const g=this.container,{el:_}=this.lower,{el:x}=this.upper;super.cleanupDOM(d),g.removeChild(x),g.removeChild(_),g.parentNode&&g.parentNode.replaceChild(_,g)}dispose(){super.dispose(),p().dispose(this.upper.el),delete this.upper,delete this.container}}class dn extends ue{constructor(){super(...arguments),t(this,"targets",[]),t(this,"_hoveredTargets",[]),t(this,"_objectsToRender",void 0),t(this,"_currentTransform",null),t(this,"_groupSelector",null),t(this,"contextTopDirty",!1)}static getDefaults(){return s(s({},super.getDefaults()),dn.ownDefaults)}get upperCanvasEl(){var d;return null===(d=this.elements.upper)||void 0===d?void 0:d.el}get contextTop(){var d;return null===(d=this.elements.upper)||void 0===d?void 0:d.ctx}get wrapperEl(){return this.elements.container}initElements(d){this.elements=new un(d,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(d){this._objectsToRender=void 0,super._onObjectAdded(d)}_onObjectRemoved(d){this._objectsToRender=void 0,d===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[d]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[d]}),d.fire("deselected",{target:d})),d===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(d)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const d=this._activeObject;return!this.preserveObjectStacking&&d?this._objects.filter((g=>!g.group&&g!==d)).concat(d):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(d){d.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(d),this.contextTopDirty=!0),d.restore()}renderTop(){const d=this.contextTop;this.clearContext(d),this.renderTopLayer(d),this.fire("after:render",{ctx:d})}setTargetFindTolerance(d){d=Math.round(d),this.targetFindTolerance=d;const g=this.getRetinaScaling(),_=Math.ceil((2*d+1)*g);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=_,this.pixelFindContext.scale(g,g)}isTargetTransparent(d,g,_){const x=this.targetFindTolerance,b=this.pixelFindContext;this.clearContext(b),b.save(),b.translate(-g+x,-_+x),b.transform(...this.viewportTransform);const S=d.selectionBackgroundColor;d.selectionBackgroundColor="",d.render(b),d.selectionBackgroundColor=S,b.restore();const w=Math.round(x*this.getRetinaScaling());return _i(b,w,w,w)}_isSelectionKeyPressed(d){const g=this.selectionKey;return!!g&&(Array.isArray(g)?!!g.find((g=>!!g&&!0===d[g])):d[g])}_shouldClearSelection(d,g){const _=this.getActiveObjects(),x=this._activeObject;return!!(!g||g&&x&&_.length>1&&-1===_.indexOf(g)&&x!==g&&!this._isSelectionKeyPressed(d)||g&&!g.evented||g&&!g.selectable&&x&&x!==g)}_shouldCenterTransform(d,g,_){if(!d)return;let x;return g===H||g===U||g===q||g===V?x=this.centeredScaling||d.centeredScaling:g===W&&(x=this.centeredRotation||d.centeredRotation),x?!_:_}_getOriginFromCorner(d,g){const _={x:d.originX,y:d.originY};return g?(["ml","tl","bl"].includes(g)?_.x=j:["mr","tr","br"].includes(g)&&(_.x=P),["tl","mt","tr"].includes(g)?_.y=A:["bl","mb","br"].includes(g)&&(_.y=E),_):_}_setupCurrentTransform(d,g,_){var x;const b=g.group?Se(this.getScenePoint(d),void 0,g.group.calcTransformMatrix()):this.getScenePoint(d),{key:S="",control:w}=g.getActiveControl()||{},T=_&&w?null===(x=w.getActionHandler(d,g,w))||void 0===x?void 0:x.bind(w):Ie,O=((d,g,_,x)=>{if(!g||!d)return"drag";const b=x.controls[g];return b.getActionName(_,b,x)})(_,S,d,g),D=d[this.centeredKey],k=this._shouldCenterTransform(g,O,D)?{x:M,y:M}:this._getOriginFromCorner(g,S),P={target:g,action:O,actionHandler:T,actionPerformed:!1,corner:S,scaleX:g.scaleX,scaleY:g.scaleY,skewX:g.skewX,skewY:g.skewY,offsetX:b.x-g.left,offsetY:b.y-g.top,originX:k.x,originY:k.y,ex:b.x,ey:b.y,lastX:b.x,lastY:b.y,theta:yt(g.angle),width:g.width,height:g.height,shiftKey:d.shiftKey,altKey:D,original:s(s({},Ce(g)),{},{originX:k.x,originY:k.y})};this._currentTransform=P,this.fire("before:transform",{e:d,transform:P})}setCursor(d){this.upperCanvasEl.style.cursor=d}_drawSelection(d){const{x:g,y:_,deltaX:x,deltaY:b}=this._groupSelector,S=new ot(g,_).transform(this.viewportTransform),w=new ot(g+x,_+b).transform(this.viewportTransform),T=this.selectionLineWidth/2;let O=Math.min(S.x,w.x),D=Math.min(S.y,w.y),k=Math.max(S.x,w.x),M=Math.max(S.y,w.y);this.selectionColor&&(d.fillStyle=this.selectionColor,d.fillRect(O,D,k-O,M-D)),this.selectionLineWidth&&this.selectionBorderColor&&(d.lineWidth=this.selectionLineWidth,d.strokeStyle=this.selectionBorderColor,O+=T,D+=T,k-=T,M-=T,yi.prototype._setLineDash.call(this,d,this.selectionDashArray),d.strokeRect(O,D,k-O,M-D))}findTarget(d){if(this.skipTargetFind)return;const g=this.getViewportPoint(d),_=this._activeObject,x=this.getActiveObjects();if(this.targets=[],_&&x.length>=1){if(_.findControl(g,fe(d)))return _;if(x.length>1&&this.searchPossibleTargets([_],g))return _;if(_===this.searchPossibleTargets([_],g)){if(this.preserveObjectStacking){const x=this.targets;this.targets=[];const b=this.searchPossibleTargets(this._objects,g);return d[this.altSelectionKey]&&b&&b!==_?(this.targets=x,_):b}return _}}return this.searchPossibleTargets(this._objects,g)}_pointIsInObjectSelectionArea(d,g){let _=d.getCoords();const x=this.getZoom(),b=d.padding/x;if(b){const[d,g,x,S]=_,w=Math.atan2(g.y-d.y,g.x-d.x),T=rt(w)*b,O=nt(w)*b,D=T+O,k=T-O;_=[new ot(d.x-k,d.y-D),new ot(g.x+D,g.y-k),new ot(x.x+k,x.y+D),new ot(S.x-D,S.y+k)]}return Fs.isPointInPolygon(g,_)}_checkTarget(d,g){if(d&&d.visible&&d.evented&&this._pointIsInObjectSelectionArea(d,Se(g,void 0,this.viewportTransform))){if(!this.perPixelTargetFind&&!d.perPixelTargetFind||d.isEditing)return!0;if(!this.isTargetTransparent(d,g.x,g.y))return!0}return!1}_searchPossibleTargets(d,g){let _=d.length;for(;_--;){const x=d[_];if(this._checkTarget(x,g)){if(ht(x)&&x.subTargetCheck){const d=this._searchPossibleTargets(x._objects,g);d&&this.targets.push(d)}return x}}}searchPossibleTargets(d,g){const _=this._searchPossibleTargets(d,g);if(_&&ht(_)&&_.interactive&&this.targets[0]){const d=this.targets;for(let g=d.length-1;g>0;g--){const _=d[g];if(!ht(_)||!_.interactive)return _}return d[0]}return _}getViewportPoint(d){return this._pointer?this._pointer:this.getPointer(d,!0)}getScenePoint(d){return this._absolutePointer?this._absolutePointer:this.getPointer(d)}getPointer(d){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const _=this.upperCanvasEl,x=_.getBoundingClientRect();let b=ge(d),S=x.width||0,w=x.height||0;S&&w||(E in x&&A in x&&(w=Math.abs(x.top-x.bottom)),j in x&&P in x&&(S=Math.abs(x.right-x.left))),this.calcOffset(),b.x=b.x-this._offset.left,b.y=b.y-this._offset.top,g||(b=Se(b,void 0,this.viewportTransform));const T=this.getRetinaScaling();1!==T&&(b.x/=T,b.y/=T);const O=0===S||0===w?new ot(1,1):new ot(_.width/S,_.height/w);return b.multiply(O)}_setDimensionsImpl(d,g){this._resetTransformEventData(),super._setDimensionsImpl(d,g),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=pt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const d=this._activeObject;return se(d)?d.getObjects():d?[d]:[]}_fireSelectionEvents(d,g){let _=!1,x=!1;const b=this.getActiveObjects(),S=[],w=[];d.forEach((d=>{b.includes(d)||(_=!0,d.fire("deselected",{e:g,target:d}),w.push(d))})),b.forEach((x=>{d.includes(x)||(_=!0,x.fire("selected",{e:g,target:x}),S.push(x))})),d.length>0&&b.length>0?(x=!0,_&&this.fire("selection:updated",{e:g,selected:S,deselected:w})):b.length>0?(x=!0,this.fire("selection:created",{e:g,selected:S})):d.length>0&&(x=!0,this.fire("selection:cleared",{e:g,deselected:w})),x&&(this._objectsToRender=void 0)}setActiveObject(d,g){const _=this.getActiveObjects(),x=this._setActiveObject(d,g);return this._fireSelectionEvents(_,g),x}_setActiveObject(d,g){const _=this._activeObject;return _!==d&&!(!this._discardActiveObject(g,d)&&this._activeObject)&&!d.onSelect({e:g})&&(this._activeObject=d,se(d)&&_!==d&&d.set("canvas",this),d.setCoords(),!0)}_discardActiveObject(d,g){const _=this._activeObject;return!!_&&!_.onDeselect({e:d,object:g})&&(this._currentTransform&&this._currentTransform.target===_&&this.endCurrentTransform(d),se(_)&&_===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(d){const g=this.getActiveObjects(),_=this.getActiveObject();g.length&&this.fire("before:selection:cleared",{e:d,deselected:[_]});const x=this._discardActiveObject(d);return this._fireSelectionEvents(g,d),x}endCurrentTransform(d){const g=this._currentTransform;this._finalizeCurrentTransform(d),g&&g.target&&(g.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(d){const g=this._currentTransform,_=g.target,x={e:d,target:_,transform:g,action:g.action};_._scaling&&(_._scaling=!1),_.setCoords(),g.actionPerformed&&(this.fire("object:modified",x),_.fire($,x))}setViewportTransform(d){super.setViewportTransform(d);const g=this._activeObject;g&&g.setCoords()}destroy(){const d=this._activeObject;se(d)&&(d.removeAll(),d.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(d){const g=this._activeObject;g&&g._renderControls(d)}_toObject(d,g,_){const x=this._realizeGroupTransformOnObject(d),b=super._toObject(d,g,_);return d.set(x),b}_realizeGroupTransformOnObject(d){const{group:g}=d;if(g&&se(g)&&this._activeObject===g){const _=Bt(d,["angle","flipX","flipY",P,U,q,K,Q,E]);return ye(d,g.calcOwnMatrix()),_}return{}}_setSVGObject(d,g,_){const x=this._realizeGroupTransformOnObject(g);super._setSVGObject(d,g,_),g.set(x)}}t(dn,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class gn{constructor(d){t(this,"targets",[]),t(this,"__disposer",void 0);const s=()=>{const{hiddenTextarea:g}=d.getActiveObject()||{};g&&g.focus()},g=d.upperCanvasEl;g.addEventListener("click",s),this.__disposer=()=>g.removeEventListener("click",s)}exitTextEditing(){this.target=void 0,this.targets.forEach((d=>{d.isEditing&&d.exitEditing()}))}add(d){this.targets.push(d)}remove(d){this.unregister(d),it(this.targets,d)}register(d){this.target=d}unregister(d){d===this.target&&(this.target=void 0)}onMouseMove(d){var g;(null===(g=this.target)||void 0===g?void 0:g.isEditing)&&this.target.updateSelectionOnMouseMove(d)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const _n=["target","oldTarget","fireCanvas","e"],Cn={passive:!1},mn=(d,g)=>{const _=d.getViewportPoint(g),x=d.getScenePoint(g);return{viewportPoint:_,scenePoint:x,pointer:_,absolutePointer:x}},vn=function(d){for(var g=arguments.length,_=new Array(g>1?g-1:0),x=1;x<g;x++)_[x-1]=arguments[x];return d.addEventListener(..._)},yn=function(d){for(var g=arguments.length,_=new Array(g>1?g-1:0),x=1;x<g;x++)_[x-1]=arguments[x];return d.removeEventListener(..._)},bn={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class xn extends dn{constructor(d){super(d,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),t(this,"_isClick",void 0),t(this,"textEditingManager",new gn(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((d=>{this[d]=this[d].bind(this)})),this.addOrRemove(vn,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(d,g){const _=this.upperCanvasEl,x=this._getEventPrefix();d(ne(_),"resize",this._onResize),d(_,x+"down",this._onMouseDown),d(_,"".concat(x,"move"),this._onMouseMove,Cn),d(_,"".concat(x,"out"),this._onMouseOut),d(_,"".concat(x,"enter"),this._onMouseEnter),d(_,"wheel",this._onMouseWheel),d(_,"contextmenu",this._onContextMenu),d(_,"dblclick",this._onDoubleClick),d(_,"dragstart",this._onDragStart),d(_,"dragend",this._onDragEnd),d(_,"dragover",this._onDragOver),d(_,"dragenter",this._onDragEnter),d(_,"dragleave",this._onDragLeave),d(_,"drop",this._onDrop),this.enablePointerEvents||d(_,"touchstart",this._onTouchStart,Cn)}removeListeners(){this.addOrRemove(yn,"remove");const d=this._getEventPrefix(),g=re(this.upperCanvasEl);yn(g,"".concat(d,"up"),this._onMouseUp),yn(g,"touchend",this._onTouchEnd,Cn),yn(g,"".concat(d,"move"),this._onMouseMove,Cn),yn(g,"touchmove",this._onMouseMove,Cn)}_onMouseWheel(d){this.__onMouseWheel(d)}_onMouseOut(d){const g=this._hoveredTarget,_=s({e:d},mn(this,d));this.fire("mouse:out",s(s({},_),{},{target:g})),this._hoveredTarget=void 0,g&&g.fire("mouseout",s({},_)),this._hoveredTargets.forEach((d=>{this.fire("mouse:out",s(s({},_),{},{target:d})),d&&d.fire("mouseout",s({},_))})),this._hoveredTargets=[]}_onMouseEnter(d){this._currentTransform||this.findTarget(d)||(this.fire("mouse:over",s({e:d},mn(this,d))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(d){this._isClick=!1;const g=this.getActiveObject();if(g&&g.onDragStart(d)){this._dragSource=g;const _={e:d,target:g};return this.fire("dragstart",_),g.fire("dragstart",_),void vn(this.upperCanvasEl,"drag",this._onDragProgress)}pe(d)}_renderDragEffects(d,g,_){let x=!1;const b=this._dropTarget;b&&b!==g&&b!==_&&(b.clearContextTop(),x=!0),null==g||g.clearContextTop(),_!==g&&(null==_||_.clearContextTop());const S=this.contextTop;S.save(),S.transform(...this.viewportTransform),g&&(S.save(),g.transform(S),g.renderDragSourceEffect(d),S.restore(),x=!0),_&&(S.save(),_.transform(S),_.renderDropTargetEffect(d),S.restore(),x=!0),S.restore(),x&&(this.contextTopDirty=!0)}_onDragEnd(d){const g=!!d.dataTransfer&&d.dataTransfer.dropEffect!==F,_=g?this._activeObject:void 0,x={e:d,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:g,dropTarget:_};yn(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",x),this._dragSource&&this._dragSource.fire("dragend",x),delete this._dragSource,this._onMouseUp(d)}_onDragProgress(d){const g={e:d,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",g),this._dragSource&&this._dragSource.fire("drag",g)}findDragTargets(d){this.targets=[];return{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(d)),targets:[...this.targets]}}_onDragOver(d){const g="dragover",{target:_,targets:x}=this.findDragTargets(d),b=this._dragSource,S={e:d,target:_,subTargets:x,dragSource:b,canDrop:!1,dropTarget:void 0};let w;this.fire(g,S),this._fireEnterLeaveEvents(_,S),_&&(_.canDrop(d)&&(w=_),_.fire(g,S));for(let _=0;_<x.length;_++){const b=x[_];b.canDrop(d)&&(w=b),b.fire(g,S)}this._renderDragEffects(d,b,w),this._dropTarget=w}_onDragEnter(d){const{target:g,targets:_}=this.findDragTargets(d),x={e:d,target:g,subTargets:_,dragSource:this._dragSource};this.fire("dragenter",x),this._fireEnterLeaveEvents(g,x)}_onDragLeave(d){const g={e:d,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",g),this._fireEnterLeaveEvents(void 0,g),this._renderDragEffects(d,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(d){const{target:g,targets:_}=this.findDragTargets(d),x=this._basicEventHandler("drop:before",s({e:d,target:g,subTargets:_,dragSource:this._dragSource},mn(this,d)));x.didDrop=!1,x.dropTarget=void 0,this._basicEventHandler("drop",x),this.fire("drop:after",x)}_onContextMenu(d){const g=this.findTarget(d),_=this.targets||[],x=this._basicEventHandler("contextmenu:before",{e:d,target:g,subTargets:_});return this.stopContextMenu&&pe(d),this._basicEventHandler("contextmenu",x),!1}_onDoubleClick(d){this._cacheTransformEventData(d),this._handleEvent(d,"dblclick"),this._resetTransformEventData()}getPointerId(d){const g=d.changedTouches;return g?g[0]&&g[0].identifier:this.enablePointerEvents?d.pointerId:-1}_isMainEvent(d){return!0===d.isPrimary||!1!==d.isPrimary&&("touchend"===d.type&&0===d.touches.length||!d.changedTouches||d.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(d){d.preventDefault(),void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(d)),this.__onMouseDown(d),this._resetTransformEventData();const g=this.upperCanvasEl,_=this._getEventPrefix(),x=re(g);vn(x,"touchend",this._onTouchEnd,Cn),vn(x,"touchmove",this._onMouseMove,Cn),yn(g,"".concat(_,"down"),this._onMouseDown)}_onMouseDown(d){this.__onMouseDown(d),this._resetTransformEventData();const g=this.upperCanvasEl,_=this._getEventPrefix();yn(g,"".concat(_,"move"),this._onMouseMove,Cn);const x=re(g);vn(x,"".concat(_,"up"),this._onMouseUp),vn(x,"".concat(_,"move"),this._onMouseMove,Cn)}_onTouchEnd(d){if(d.touches.length>0)return;this.__onMouseUp(d),this._resetTransformEventData(),delete this.mainTouchId;const g=this._getEventPrefix(),_=re(this.upperCanvasEl);yn(_,"touchend",this._onTouchEnd,Cn),yn(_,"touchmove",this._onMouseMove,Cn),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{vn(this.upperCanvasEl,"".concat(g,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(d){this.__onMouseUp(d),this._resetTransformEventData();const g=this.upperCanvasEl,_=this._getEventPrefix();if(this._isMainEvent(d)){const d=re(this.upperCanvasEl);yn(d,"".concat(_,"up"),this._onMouseUp),yn(d,"".concat(_,"move"),this._onMouseMove,Cn),vn(g,"".concat(_,"move"),this._onMouseMove,Cn)}}_onMouseMove(d){const g=this.getActiveObject();!this.allowTouchScrolling&&(!g||!g.shouldStartDragging(d))&&d.preventDefault&&d.preventDefault(),this.__onMouseMove(d)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(d){const g=this.getActiveObject();return!!g!=!!d||g&&d&&g!==d}__onMouseUp(d){var g;this._cacheTransformEventData(d),this._handleEvent(d,"up:before");const _=this._currentTransform,x=this._isClick,b=this._target,{button:S}=d;if(S)return(this.fireMiddleClick&&1===S||this.fireRightClick&&2===S)&&this._handleEvent(d,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(d);if(!this._isMainEvent(d))return;let w,T,O=!1;if(_&&(this._finalizeCurrentTransform(d),O=_.actionPerformed),!x){const g=b===this._activeObject;this.handleSelection(d),O||(O=this._shouldRender(b)||!g&&b===this._activeObject)}if(b){const g=b.findControl(this.getViewportPoint(d),fe(d)),{key:x,control:S}=g||{};if(T=x,b.selectable&&b!==this._activeObject&&"up"===b.activeOn)this.setActiveObject(b,d),O=!0;else if(S){const g=S.getMouseUpHandler(d,b,S);g&&(w=this.getScenePoint(d),g.call(S,d,_,w.x,w.y))}b.isMoving=!1}if(_&&(_.target!==b||_.corner!==T)){const g=_.target&&_.target.controls[_.corner],x=g&&g.getMouseUpHandler(d,_.target,g);w=w||this.getScenePoint(d),x&&x.call(g,d,_,w.x,w.y)}this._setCursorFromEvent(d,b),this._handleEvent(d,"up"),this._groupSelector=null,this._currentTransform=null,b&&(b.__corner=void 0),O?this.requestRenderAll():x||null!==(g=this._activeObject)&&void 0!==g&&g.isEditing||this.renderTop()}_basicEventHandler(d,g){const{target:_,subTargets:x=[]}=g;this.fire(d,g),_&&_.fire(d,g);for(let b=0;b<x.length;b++)x[b]!==_&&x[b].fire(d,g);return g}_handleEvent(d,g){const _=this._target,x=this.targets||[],b=s(s({e:d,target:_,subTargets:x},mn(this,d)),{},{transform:this._currentTransform},"up:before"===g||"up"===g?{isClick:this._isClick,currentTarget:this.findTarget(d),currentSubTargets:this.targets}:{});this.fire("mouse:".concat(g),b),_&&_.fire("mouse".concat(g),b);for(let d=0;d<x.length;d++)x[d]!==_&&x[d].fire("mouse".concat(g),b)}_onMouseDownInDrawingMode(d){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(d),this.requestRenderAll());const g=this.getScenePoint(d);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(g,{e:d,pointer:g}),this._handleEvent(d,"down")}_onMouseMoveInDrawingMode(d){if(this._isCurrentlyDrawing){const g=this.getScenePoint(d);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(g,{e:d,pointer:g})}this.setCursor(this.freeDrawingCursor),this._handleEvent(d,"move")}_onMouseUpInDrawingMode(d){const g=this.getScenePoint(d);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:d,pointer:g}):this._isCurrentlyDrawing=!1,this._handleEvent(d,"up")}__onMouseDown(d){this._isClick=!0,this._cacheTransformEventData(d),this._handleEvent(d,"down:before");let g=this._target;const{button:_}=d;if(_)return(this.fireMiddleClick&&1===_||this.fireRightClick&&2===_)&&this._handleEvent(d,"down"),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(d);if(!this._isMainEvent(d))return;if(this._currentTransform)return;let x=this._shouldRender(g),b=!1;if(this.handleMultiSelection(d,g)?(g=this._activeObject,b=!0,x=!0):this._shouldClearSelection(d,g)&&this.discardActiveObject(d),this.selection&&(!g||!g.selectable&&!g.isEditing&&g!==this._activeObject)){const g=this.getScenePoint(d);this._groupSelector={x:g.x,y:g.y,deltaY:0,deltaX:0}}if(g){const _=g===this._activeObject;g.selectable&&"down"===g.activeOn&&this.setActiveObject(g,d);const x=g.findControl(this.getViewportPoint(d),fe(d));if(g===this._activeObject&&(x||!b)){this._setupCurrentTransform(d,g,_);const b=x?x.control:void 0,S=this.getScenePoint(d),w=b&&b.getMouseDownHandler(d,g,b);w&&w.call(b,d,this._currentTransform,S.x,S.y)}}x&&(this._objectsToRender=void 0),this._handleEvent(d,"down"),x&&this.requestRenderAll()}_resetTransformEventData(){this._target=void 0,this._pointer=void 0,this._absolutePointer=void 0}_cacheTransformEventData(d){this._resetTransformEventData(),this._pointer=this.getViewportPoint(d),this._absolutePointer=Se(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(d)}__onMouseMove(d){if(this._isClick=!1,this._cacheTransformEventData(d),this._handleEvent(d,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(d);if(!this._isMainEvent(d))return;const g=this._groupSelector;if(g){const _=this.getScenePoint(d);g.deltaX=_.x-g.x,g.deltaY=_.y-g.y,this.renderTop()}else if(this._currentTransform)this._transformObject(d);else{const g=this.findTarget(d);this._setCursorFromEvent(d,g),this._fireOverOutEvents(d,g)}this.textEditingManager.onMouseMove(d),this._handleEvent(d,"move"),this._resetTransformEventData()}_fireOverOutEvents(d,g){const _=this._hoveredTarget,x=this._hoveredTargets,b=this.targets,S=Math.max(x.length,b.length);this.fireSyntheticInOutEvents("mouse",{e:d,target:g,oldTarget:_,fireCanvas:!0});for(let g=0;g<S;g++)this.fireSyntheticInOutEvents("mouse",{e:d,target:b[g],oldTarget:x[g]});this._hoveredTarget=g,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(d,g){const _=this._draggedoverTarget,x=this._hoveredTargets,b=this.targets,S=Math.max(x.length,b.length);this.fireSyntheticInOutEvents("drag",s(s({},g),{},{target:d,oldTarget:_,fireCanvas:!0}));for(let d=0;d<S;d++)this.fireSyntheticInOutEvents("drag",s(s({},g),{},{target:b[d],oldTarget:x[d]}));this._draggedoverTarget=d}fireSyntheticInOutEvents(d,g){let{target:_,oldTarget:x,fireCanvas:b,e:S}=g,w=i(g,_n);const{targetIn:T,targetOut:O,canvasIn:D,canvasOut:k}=bn[d],M=x!==_;if(x&&M){const d=s(s({},w),{},{e:S,target:x,nextTarget:_},mn(this,S));b&&this.fire(k,d),x.fire(O,d)}if(_&&M){const d=s(s({},w),{},{e:S,target:_,previousTarget:x},mn(this,S));b&&this.fire(D,d),_.fire(T,d)}}__onMouseWheel(d){this._cacheTransformEventData(d),this._handleEvent(d,"wheel"),this._resetTransformEventData()}_transformObject(d){const g=this.getScenePoint(d),_=this._currentTransform,x=_.target,b=x.group?Se(g,void 0,x.group.calcTransformMatrix()):g;_.shiftKey=d.shiftKey,_.altKey=!!this.centeredKey&&d[this.centeredKey],this._performTransformAction(d,_,b),_.actionPerformed&&this.requestRenderAll()}_performTransformAction(d,g,_){const{action:x,actionHandler:b,target:S}=g,w=!!b&&b(d,g,_.x,_.y);w&&S.setCoords(),"drag"===x&&w&&(g.target.isMoving=!0,this.setCursor(g.target.moveCursor||this.moveCursor)),g.actionPerformed=g.actionPerformed||w}_setCursorFromEvent(d,g){if(!g)return void this.setCursor(this.defaultCursor);let _=g.hoverCursor||this.hoverCursor;const x=se(this._activeObject)?this._activeObject:null,b=(!x||g.group!==x)&&g.findControl(this.getViewportPoint(d));if(b){const _=b.control;this.setCursor(_.cursorStyleHandler(d,_,g))}else g.subTargetCheck&&this.targets.concat().reverse().map((d=>{_=d.hoverCursor||_})),this.setCursor(_)}handleMultiSelection(d,g){const _=this._activeObject,x=se(_);if(_&&this._isSelectionKeyPressed(d)&&this.selection&&g&&g.selectable&&(_!==g||x)&&(x||!g.isDescendantOf(_)&&!_.isDescendantOf(g))&&!g.onSelect({e:d})&&!_.getActiveControl()){if(x){const x=_.getObjects();if(g===_){const _=this.getViewportPoint(d);if(!(g=this.searchPossibleTargets(x,_)||this.searchPossibleTargets(this._objects,_))||!g.selectable)return!1}g.group===_?(_.remove(g),this._hoveredTarget=g,this._hoveredTargets=[...this.targets],1===_.size()&&this._setActiveObject(_.item(0),d)):(_.multiSelectAdd(g),this._hoveredTarget=_,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(x,d)}else{_.exitEditing&&_.exitEditing();const x=new(at.getClass("ActiveSelection"))([],{canvas:this});x.multiSelectAdd(_,g),this._hoveredTarget=x,this._setActiveObject(x,d),this._fireSelectionEvents([_],d)}return!0}return!1}handleSelection(d){if(!this.selection||!this._groupSelector)return!1;const{x:g,y:_,deltaX:x,deltaY:b}=this._groupSelector,S=new ot(g,_),w=S.add(new ot(x,b)),T=S.min(w),O=S.max(w).subtract(T),D=this.collectObjects({left:T.x,top:T.y,width:O.x,height:O.y},{includeIntersecting:!this.selectionFullyContained}),k=S.eq(w)?D[0]?[D[0]]:[]:D.length>1?D.filter((g=>!g.onSelect({e:d}))).reverse():D;if(1===k.length)this.setActiveObject(k[0],d);else if(k.length>1){const g=at.getClass("ActiveSelection");this.setActiveObject(new g(k,{canvas:this}),d)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const Sn={x1:0,y1:0,x2:0,y2:0},Dn=s(s({},Sn),{},{r1:0,r2:0}),wn=(d,g)=>isNaN(d)&&"number"==typeof g?g:d,kn=/^(\d+\.\d+)%|(\d+)%$/;function Tn(d){return d&&kn.test(d)}function On(d,g){const _="number"==typeof d?d:"string"==typeof d?parseFloat(d)/(Tn(d)?100:1):NaN;return ds(0,wn(_,g),1)}const Rn=/\s*;\s*/,Xn=/\s*:\s*/;function Mn(d,g){let _,x;const b=d.getAttribute("style");if(b){const d=b.split(Rn);""===d[d.length-1]&&d.pop();for(let g=d.length;g--;){const[b,S]=d[g].split(Xn).map((d=>d.trim()));"stop-color"===b?_=S:"stop-opacity"===b&&(x=S)}}const S=new Nt(_||d.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:On(d.getAttribute("offset"),0),color:S.toRgb(),opacity:wn(parseFloat(x||d.getAttribute("stop-opacity")||""),1)*S.getAlpha()*g}}function Pn(d,g){const _=[],x=d.getElementsByTagName("stop"),b=On(g,1);for(let d=x.length;d--;)_.push(Mn(x[d],b));return _}function En(d){return"linearGradient"===d.nodeName||"LINEARGRADIENT"===d.nodeName?"linear":"radial"}function An(d){return"userSpaceOnUse"===d.getAttribute("gradientUnits")?"pixels":"percentage"}function jn(d,g){return d.getAttribute(g)}function Fn(d,g){return function(d,g){let _,{width:x,height:b,gradientUnits:S}=g;return Object.keys(d).reduce(((g,w)=>{const T=d[w];return"Infinity"===T?_=1:"-Infinity"===T?_=0:(_="string"==typeof T?parseFloat(T):T,"string"==typeof T&&Tn(T)&&(_*=.01,"pixels"===S&&("x1"!==w&&"x2"!==w&&"r2"!==w||(_*=x),"y1"!==w&&"y2"!==w||(_*=b)))),g[w]=_,g}),{})}("linear"===En(d)?function(d){return{x1:jn(d,"x1")||0,y1:jn(d,"y1")||0,x2:jn(d,"x2")||"100%",y2:jn(d,"y2")||0}}(d):function(d){return{x1:jn(d,"fx")||jn(d,"cx")||"50%",y1:jn(d,"fy")||jn(d,"cy")||"50%",r1:0,x2:jn(d,"cx")||"50%",y2:jn(d,"cy")||"50%",r2:jn(d,"r")||"50%"}}(d),s(s({},g),{},{gradientUnits:An(d)}))}class Ln{constructor(d){const{type:g="linear",gradientUnits:_="pixels",coords:x={},colorStops:b=[],offsetX:S=0,offsetY:w=0,gradientTransform:T,id:O}=d||{};Object.assign(this,{type:g,gradientUnits:_,coords:s(s({},"radial"===g?Dn:Sn),x),colorStops:b,offsetX:S,offsetY:w,gradientTransform:T,id:O?"".concat(O,"_").concat(ft()):ft()})}addColorStop(d){for(const g in d){const _=new Nt(d[g]);this.colorStops.push({offset:parseFloat(g),color:_.toRgb(),opacity:_.getAlpha()})}return this}toObject(d){return s(s({},Bt(this,d)),{},{type:this.type,coords:s({},this.coords),colorStops:this.colorStops.map((d=>s({},d))),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(d){let{additionalTransform:g}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const _=[],x=this.gradientTransform?this.gradientTransform.concat():O.concat(),b="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",S=this.colorStops.map((d=>s({},d))).sort(((d,g)=>d.offset-g.offset));let w=-this.offsetX,T=-this.offsetY;var D;"objectBoundingBox"===b?(w/=d.width,T/=d.height):(w+=d.width/2,T+=d.height/2),(D=d)&&"function"==typeof D._renderPathCommands&&"percentage"!==this.gradientUnits&&(w-=d.pathOffset.x,T-=d.pathOffset.y),x[4]-=w,x[5]-=T;const k=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(b,'"'),'gradientTransform="'.concat(g?g+" ":"").concat(Jt(x),'"'),""].join(" ");if("linear"===this.type){const{x1:d,y1:g,x2:x,y2:b}=this.coords;_.push("<linearGradient ",k,' x1="',d,'" y1="',g,'" x2="',x,'" y2="',b,'">\n')}else if("radial"===this.type){const{x1:d,y1:g,x2:x,y2:b,r1:w,r2:T}=this.coords,O=w>T;_.push("<radialGradient ",k,' cx="',O?d:x,'" cy="',O?g:b,'" r="',O?w:T,'" fx="',O?x:d,'" fy="',O?b:g,'">\n'),O&&(S.reverse(),S.forEach((d=>{d.offset=1-d.offset})));const D=Math.min(w,T);if(D>0){const d=D/Math.max(w,T);S.forEach((g=>{g.offset+=d*(1-g.offset)}))}}return S.forEach((d=>{let{color:g,offset:x,opacity:b}=d;_.push("<stop ",'offset="',100*x+"%",'" style="stop-color:',g,void 0!==b?";stop-opacity: "+b:";",'"/>\n')})),_.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),_.join("")}toLive(d){const{x1:g,y1:_,x2:x,y2:b,r1:S,r2:w}=this.coords,T="linear"===this.type?d.createLinearGradient(g,_,x,b):d.createRadialGradient(g,_,S,x,b,w);return this.colorStops.forEach((d=>{let{color:g,opacity:_,offset:x}=d;T.addColorStop(x,void 0!==_?new Nt(g).setAlpha(_).toRgba():g)})),T}static async fromObject(d){const{colorStops:g,gradientTransform:_}=d;return new this(s(s({},d),{},{colorStops:g?g.map((d=>s({},d))):void 0,gradientTransform:_?[..._]:void 0}))}static fromElement(d,g,_){const x=An(d),b=g._findCenterFromElement();return new this(s({id:d.getAttribute("id")||void 0,type:En(d),coords:Fn(d,{width:_.viewBoxWidth||_.width,height:_.viewBoxHeight||_.height}),colorStops:Pn(d,_.opacity),gradientUnits:x,gradientTransform:nr(d.getAttribute("gradientTransform")||"")},"pixels"===x?{offsetX:g.width/2-b.x,offsetY:g.height/2-b.y}:{offsetX:0,offsetY:0}))}}t(Ln,"type","Gradient"),at.setClass(Ln,"gradient"),at.setClass(Ln,"linear"),at.setClass(Ln,"radial");const Wn=["type","source","patternTransform"];class In{get type(){return"pattern"}set type(d){a("warn","Setting type has no effect",d)}constructor(d){t(this,"repeat","repeat"),t(this,"offsetX",0),t(this,"offsetY",0),t(this,"crossOrigin",""),this.id=ft(),Object.assign(this,d)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(d){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?d.createPattern(this.source,this.repeat):null}toObject(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{repeat:_,crossOrigin:x}=this;return s(s({},Bt(this,g)),{},{type:"pattern",source:this.sourceToString(),repeat:_,crossOrigin:x,offsetX:Ut(this.offsetX,d.NUM_FRACTION_DIGITS),offsetY:Ut(this.offsetY,d.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(d){let{width:g,height:_}=d;const{source:x,repeat:b,id:S}=this,w=wn(this.offsetX/g,0),T=wn(this.offsetY/_,0),O="repeat-y"===b||"no-repeat"===b?1+Math.abs(w||0):wn(x.width/g,0),D="repeat-x"===b||"no-repeat"===b?1+Math.abs(T||0):wn(x.height/_,0);return['<pattern id="SVGID_'.concat(S,'" x="').concat(w,'" y="').concat(T,'" width="').concat(O,'" height="').concat(D,'">'),'<image x="0" y="0" width="'.concat(x.width,'" height="').concat(x.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n")}static async fromObject(d,g){let{type:_,source:x,patternTransform:b}=d,S=i(d,Wn);const w=await Lt(x,s(s({},g),{},{crossOrigin:S.crossOrigin}));return new this(s(s({},S),{},{patternTransform:b&&b.slice(0),source:w}))}}t(In,"type","Pattern"),at.setClass(In),at.setClass(In,"pattern");class Bn{constructor(d){t(this,"color","rgb(0, 0, 0)"),t(this,"width",1),t(this,"shadow",null),t(this,"strokeLineCap","round"),t(this,"strokeLineJoin","round"),t(this,"strokeMiterLimit",10),t(this,"strokeDashArray",null),t(this,"limitedToCanvasSize",!1),this.canvas=d}_setBrushStyles(d){d.strokeStyle=this.color,d.lineWidth=this.width,d.lineCap=this.strokeLineCap,d.miterLimit=this.strokeMiterLimit,d.lineJoin=this.strokeLineJoin,d.setLineDash(this.strokeDashArray||[])}_saveAndTransform(d){const g=this.canvas.viewportTransform;d.save(),d.transform(g[0],g[1],g[2],g[3],g[4],g[5])}needsFullRender(){return new Nt(this.color).getAlpha()<1||!!this.shadow}_setShadow(){if(!this.shadow||!this.canvas)return;const d=this.canvas,g=this.shadow,_=d.contextTop,x=d.getZoom()*d.getRetinaScaling();_.shadowColor=g.color,_.shadowBlur=g.blur*x,_.shadowOffsetX=g.offsetX*x,_.shadowOffsetY=g.offsetY*x}_resetShadow(){const d=this.canvas.contextTop;d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}_isOutSideCanvas(d){return d.x<0||d.x>this.canvas.getWidth()||d.y<0||d.y>this.canvas.getHeight()}}const zn=["path","left","top"],Hn=["d"];class Yn extends yi{constructor(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:_,left:x,top:b}=g,S=i(g,zn);super(),Object.assign(this,Yn.ownDefaults),this.setOptions(S),this._setPath(d||[],!0),"number"==typeof x&&this.set(P,x),"number"==typeof b&&this.set(E,b)}_setPath(d,g){this.path=Xr(Array.isArray(d)?d:sn(d)),this.setBoundingBox(g)}_findCenterFromElement(){const d=this._calcBoundsFromPath();return new ot(d.left+d.width/2,d.top+d.height/2)}_renderPathCommands(d){const g=-this.pathOffset.x,_=-this.pathOffset.y;d.beginPath();for(const x of this.path)switch(x[0]){case"L":d.lineTo(x[1]+g,x[2]+_);break;case"M":d.moveTo(x[1]+g,x[2]+_);break;case"C":d.bezierCurveTo(x[1]+g,x[2]+_,x[3]+g,x[4]+_,x[5]+g,x[6]+_);break;case"Q":d.quadraticCurveTo(x[1]+g,x[2]+_,x[3]+g,x[4]+_);break;case"Z":d.closePath()}}_render(d){this._renderPathCommands(d),this._renderPaintInOrder(d)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s(s({},super.toObject(d)),{},{path:this.path.map((d=>d.slice()))})}toDatalessObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const g=this.toObject(d);return this.sourcePath&&(delete g.path,g.sourcePath=this.sourcePath),g}_toSVG(){const g=nn(this.path,d.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(g,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){const g=d.NUM_FRACTION_DIGITS;return" translate(".concat(Ut(-this.pathOffset.x,g),", ").concat(Ut(-this.pathOffset.y,g),")")}toClipPathSVG(d){const g=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:g})}toSVG(d){const g=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:g})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(d){const{width:g,height:_,pathOffset:x}=this._calcDimensions();this.set({width:g,height:_,pathOffset:x}),d&&this.setPositionByOrigin(x,M,M)}_calcBoundsFromPath(){const d=[];let g=0,_=0,x=0,b=0;for(const S of this.path)switch(S[0]){case"L":x=S[1],b=S[2],d.push({x:g,y:_},{x:x,y:b});break;case"M":x=S[1],b=S[2],g=x,_=b;break;case"C":d.push(...Ir(x,b,S[1],S[2],S[3],S[4],S[5],S[6])),x=S[5],b=S[6];break;case"Q":d.push(...Ir(x,b,S[1],S[2],S[1],S[2],S[3],S[4])),x=S[3],b=S[4];break;case"Z":x=g,b=_}return me(d)}_calcDimensions(){const d=this._calcBoundsFromPath();return s(s({},d),{},{pathOffset:new ot(d.left+d.width/2,d.top+d.height/2)})}static fromObject(d){return this._fromObject(d,{extraParam:"path"})}static async fromElement(d,g,_){const x=ur(d,this.ATTRIBUTE_NAMES,_),{d:b}=x;return new this(b,s(s(s({},i(x,Hn)),g),{},{left:void 0,top:void 0}))}}t(Yn,"type","Path"),t(Yn,"cacheProperties",[...Cs,"path","fillRule"]),t(Yn,"ATTRIBUTE_NAMES",[...Xi,"d"]),at.setClass(Yn),at.setSVGClass(Yn);class Vn extends Bn{constructor(d){super(d),t(this,"decimate",.4),t(this,"drawStraightLine",!1),t(this,"straightLineKey","shiftKey"),this._points=[],this._hasStraightLine=!1}needsFullRender(){return super.needsFullRender()||this._hasStraightLine}static drawSegment(d,g,_){const x=g.midPointFrom(_);return d.quadraticCurveTo(g.x,g.y,x.x,x.y),x}onMouseDown(d,g){let{e:_}=g;this.canvas._isMainEvent(_)&&(this.drawStraightLine=!!this.straightLineKey&&_[this.straightLineKey],this._prepareForDrawing(d),this._addPoint(d),this._render())}onMouseMove(d,g){let{e:_}=g;if(this.canvas._isMainEvent(_)&&(this.drawStraightLine=!!this.straightLineKey&&_[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(d))&&this._addPoint(d)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{const d=this._points,g=d.length,_=this.canvas.contextTop;this._saveAndTransform(_),this.oldEnd&&(_.beginPath(),_.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=Vn.drawSegment(_,d[g-2],d[g-1]),_.stroke(),_.restore()}}onMouseUp(d){let{e:g}=d;return!this.canvas._isMainEvent(g)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)}_prepareForDrawing(d){this._reset(),this._addPoint(d),this.canvas.contextTop.moveTo(d.x,d.y)}_addPoint(d){return!(this._points.length>1&&d.eq(this._points[this._points.length-1]))&&(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(d),!0)}_reset(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1}_render(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvas.contextTop,g=this._points[0],_=this._points[1];if(this._saveAndTransform(d),d.beginPath(),2===this._points.length&&g.x===_.x&&g.y===_.y){const d=this.width/1e3;g.x-=d,_.x+=d}d.moveTo(g.x,g.y);for(let x=1;x<this._points.length;x++)Vn.drawSegment(d,g,_),g=this._points[x],_=this._points[x+1];d.lineTo(g.x,g.y),d.stroke(),d.restore()}convertPointsToSVGPath(d){const g=this.width/1e3;return rn(d,g)}createPath(d){const g=new Yn(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,g.shadow=new us(this.shadow)),g}decimatePoints(d,g){if(d.length<=2)return d;let _,x=d[0];const b=this.canvas.getZoom(),S=Math.pow(g/b,2),w=d.length-1,T=[x];for(let g=1;g<w-1;g++)_=Math.pow(x.x-d[g].x,2)+Math.pow(x.y-d[g].y,2),_>=S&&(x=d[g],T.push(x));return T.push(d[w]),T}_finalizeAndAddPath(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));const d=this.convertPointsToSVGPath(this._points);if(function(d){return"M 0 0 Q 0 0 0 0 L 0 0"===nn(d)}(d))return void this.canvas.requestRenderAll();const g=this.createPath(d);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:g}),this.canvas.add(g),this.canvas.requestRenderAll(),g.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:g})}}const Kn=["left","top","radius"],Qn=["radius","startAngle","endAngle","counterClockwise"];class Gn extends yi{static getDefaults(){return s(s({},super.getDefaults()),Gn.ownDefaults)}constructor(d){super(),Object.assign(this,Gn.ownDefaults),this.setOptions(d)}_set(d,g){return super._set(d,g),"radius"===d&&this.setRadius(g),this}_render(d){d.beginPath(),d.arc(0,0,this.radius,yt(this.startAngle),yt(this.endAngle),this.counterClockwise),this._renderPaintInOrder(d)}getRadiusX(){return this.get("radius")*this.get(U)}getRadiusY(){return this.get("radius")*this.get(q)}setRadius(d){this.radius=d,this.set({width:2*d,height:2*d})}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Qn,...d])}_toSVG(){const d=(this.endAngle-this.startAngle)%360;if(0===d)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{const{radius:g}=this,_=yt(this.startAngle),x=yt(this.endAngle),b=rt(_)*g,S=nt(_)*g,w=rt(x)*g,T=nt(x)*g,O=d>180?1:0,D=this.counterClockwise?0:1;return['<path d="M '.concat(b," ").concat(S," A ").concat(g," ").concat(g," 0 ").concat(O," ").concat(D," ").concat(w," ").concat(T,'" '),"COMMON_PARTS"," />\n"]}}static async fromElement(d,g,_){const x=ur(d,this.ATTRIBUTE_NAMES,_),{left:b=0,top:S=0,radius:w=0}=x;return new this(s(s({},i(x,Kn)),{},{radius:w,left:b-w,top:S-w}))}static fromObject(d){return super._fromObject(d)}}t(Gn,"type","Circle"),t(Gn,"cacheProperties",[...Cs,...Qn]),t(Gn,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),t(Gn,"ATTRIBUTE_NAMES",["cx","cy","r",...Xi]),at.setClass(Gn),at.setSVGClass(Gn);class Nn extends Bn{constructor(d){super(d),t(this,"width",10),this.points=[]}drawDot(d){const g=this.addPoint(d),_=this.canvas.contextTop;this._saveAndTransform(_),this.dot(_,g),_.restore()}dot(d,g){d.fillStyle=g.fill,d.beginPath(),d.arc(g.x,g.y,g.radius,0,2*Math.PI,!1),d.closePath(),d.fill()}onMouseDown(d){this.points=[],this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(d)}_render(){const d=this.canvas.contextTop,g=this.points;this._saveAndTransform(d);for(let _=0;_<g.length;_++)this.dot(d,g[_]);d.restore()}onMouseMove(d){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(d)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(d),this._render()):this.drawDot(d))}onMouseUp(){const d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;const g=[];for(let d=0;d<this.points.length;d++){const _=this.points[d],x=new Gn({radius:_.radius,left:_.x,top:_.y,originX:M,originY:M,fill:_.fill});this.shadow&&(x.shadow=new us(this.shadow)),g.push(x)}const _=new Dr(g,{canvas:this.canvas});this.canvas.fire("before:path:created",{path:_}),this.canvas.add(_),this.canvas.fire("path:created",{path:_}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=d,this.canvas.requestRenderAll()}addPoint(d){let{x:g,y:_}=d;const x={x:g,y:_,radius:an(Math.max(0,this.width-20),this.width+20)/2,fill:new Nt(this.color).setAlpha(an(0,100)/100).toRgba()};return this.points.push(x),x}}class Un extends Bn{constructor(d){super(d),t(this,"width",10),t(this,"density",20),t(this,"dotWidth",1),t(this,"dotWidthVariance",1),t(this,"randomOpacity",!1),t(this,"optimizeOverlapping",!0),this.sprayChunks=[],this.sprayChunk=[]}onMouseDown(d){this.sprayChunks=[],this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(d),this.renderChunck(this.sprayChunk)}onMouseMove(d){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(d)||(this.addSprayChunk(d),this.renderChunck(this.sprayChunk))}onMouseUp(){const d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;const g=[];for(let d=0;d<this.sprayChunks.length;d++){const _=this.sprayChunks[d];for(let d=0;d<_.length;d++){const x=_[d],b=new fr({width:x.width,height:x.width,left:x.x+1,top:x.y+1,originX:M,originY:M,fill:this.color});g.push(b)}}const _=new Dr(this.optimizeOverlapping?function(d){const g={},_=[];for(let x,b=0;b<d.length;b++)x="".concat(d[b].left).concat(d[b].top),g[x]||(g[x]=!0,_.push(d[b]));return _}(g):g,{objectCaching:!0,subTargetCheck:!1,interactive:!1});this.shadow&&_.set("shadow",new us(this.shadow)),this.canvas.fire("before:path:created",{path:_}),this.canvas.add(_),this.canvas.fire("path:created",{path:_}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=d,this.canvas.requestRenderAll()}renderChunck(d){const g=this.canvas.contextTop;g.fillStyle=this.color,this._saveAndTransform(g);for(let _=0;_<d.length;_++){const x=d[_];g.globalAlpha=x.opacity,g.fillRect(x.x,x.y,x.width,x.width)}g.restore()}_render(){const d=this.canvas.contextTop;d.fillStyle=this.color,this._saveAndTransform(d);for(let d=0;d<this.sprayChunks.length;d++)this.renderChunck(this.sprayChunks[d]);d.restore()}addSprayChunk(d){this.sprayChunk=[];const g=this.width/2;for(let _=0;_<this.density;_++)this.sprayChunk.push({x:an(d.x-g,d.x+g),y:an(d.y-g,d.y+g),width:this.dotWidthVariance?an(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,opacity:this.randomOpacity?an(0,100)/100:1});this.sprayChunks.push(this.sprayChunk)}}class qn extends Vn{constructor(d){super(d)}getPatternSrc(){const d=pt(),g=d.getContext("2d");return d.width=d.height=25,g&&(g.fillStyle=this.color,g.beginPath(),g.arc(10,10,10,0,2*Math.PI,!1),g.closePath(),g.fill()),d}getPattern(d){return d.createPattern(this.source||this.getPatternSrc(),"repeat")}_setBrushStyles(d){super._setBrushStyles(d);const g=this.getPattern(d);g&&(d.strokeStyle=g)}createPath(d){const g=super.createPath(d),_=g._getLeftTopCoords().scalarAdd(g.strokeWidth/2);return g.stroke=new In({source:this.source||this.getPatternSrc(),offsetX:-_.x,offsetY:-_.y}),g}}const Jn=["x1","y1","x2","y2"],to=["x1","y1","x2","y2"],io=["x1","x2","y1","y2"];class Zn extends yi{constructor(){let[d,g,_,x]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,Zn.ownDefaults),this.setOptions(b),this.x1=d,this.x2=_,this.y1=g,this.y2=x,this._setWidthHeight();const{left:S,top:w}=b;"number"==typeof S&&this.set(P,S),"number"==typeof w&&this.set(E,w)}_setWidthHeight(){const{x1:d,y1:g,x2:_,y2:x}=this;this.width=Math.abs(_-d),this.height=Math.abs(x-g);const{left:b,top:S,width:w,height:T}=me([{x:d,y:g},{x:_,y:x}]),O=new ot(b+w/2,S+T/2);this.setPositionByOrigin(O,M,M)}_set(d,g){return super._set(d,g),io.includes(d)&&this._setWidthHeight(),this}_render(d){d.beginPath();const g=this.calcLinePoints();d.moveTo(g.x1,g.y1),d.lineTo(g.x2,g.y2),d.lineWidth=this.strokeWidth;const _=d.strokeStyle;var x;Zt(this.stroke)?d.strokeStyle=this.stroke.toLive(d):d.strokeStyle=null!==(x=this.stroke)&&void 0!==x?x:d.fillStyle;this.stroke&&this._renderStroke(d),d.strokeStyle=_}_findCenterFromElement(){return new ot((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s(s({},super.toObject(d)),this.calcLinePoints())}_getNonTransformedDimensions(){const d=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(d.y-=this.strokeWidth),0===this.height&&(d.x-=this.strokeWidth)),d}calcLinePoints(){const{x1:d,x2:g,y1:_,y2:x,width:b,height:S}=this,w=d<=g?-1:1,T=_<=x?-1:1;return{x1:w*b/2,x2:w*-b/2,y1:T*S/2,y2:T*-S/2}}_toSVG(){const{x1:d,x2:g,y1:_,y2:x}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(d,'" y1="').concat(_,'" x2="').concat(g,'" y2="').concat(x,'" />\n')]}static async fromElement(d,g,_){const x=ur(d,this.ATTRIBUTE_NAMES,_),{x1:b=0,y1:S=0,x2:w=0,y2:T=0}=x;return new this([b,S,w,T],i(x,Jn))}static fromObject(d){let{x1:g,y1:_,x2:x,y2:b}=d,S=i(d,to);return this._fromObject(s(s({},S),{},{points:[g,_,x,b]}),{extraParam:"points"})}}t(Zn,"type","Line"),t(Zn,"cacheProperties",[...Cs,...io]),t(Zn,"ATTRIBUTE_NAMES",Xi.concat(io)),at.setClass(Zn),at.setSVGClass(Zn);class $n extends yi{static getDefaults(){return s(s({},super.getDefaults()),$n.ownDefaults)}constructor(d){super(),Object.assign(this,$n.ownDefaults),this.setOptions(d)}_render(d){const g=this.width/2,_=this.height/2;d.beginPath(),d.moveTo(-g,_),d.lineTo(0,-_),d.lineTo(g,_),d.closePath(),this._renderPaintInOrder(d)}_toSVG(){const d=this.width/2,g=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-d," ").concat(g,",0 ").concat(-g,",").concat(d," ").concat(g),'" />']}}t($n,"type","Triangle"),t($n,"ownDefaults",{width:100,height:100}),at.setClass($n),at.setSVGClass($n);const ro=["rx","ry"];class eo extends yi{static getDefaults(){return s(s({},super.getDefaults()),eo.ownDefaults)}constructor(d){super(),Object.assign(this,eo.ownDefaults),this.setOptions(d)}_set(d,g){switch(super._set(d,g),d){case"rx":this.rx=g,this.set("width",2*g);break;case"ry":this.ry=g,this.set("height",2*g)}return this}getRx(){return this.get("rx")*this.get(U)}getRy(){return this.get("ry")*this.get(q)}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...ro,...d])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')]}_render(d){d.beginPath(),d.save(),d.transform(1,0,0,this.ry/this.rx,0,0),d.arc(0,0,this.rx,0,w,!1),d.restore(),this._renderPaintInOrder(d)}static async fromElement(d,g,_){const x=ur(d,this.ATTRIBUTE_NAMES,_);return x.left=(x.left||0)-x.rx,x.top=(x.top||0)-x.ry,new this(x)}}function so(d){if(!d)return[];const g=d.replace(/,/g," ").trim().split(/\s+/),_=[];for(let d=0;d<g.length;d+=2)_.push({x:parseFloat(g[d]),y:parseFloat(g[d+1])});return _}t(eo,"type","Ellipse"),t(eo,"cacheProperties",[...Cs,...ro]),t(eo,"ownDefaults",{rx:0,ry:0}),t(eo,"ATTRIBUTE_NAMES",[...Xi,"cx","cy","rx","ry"]),at.setClass(eo),at.setSVGClass(eo);const ao=["left","top"],ho={exactBoundingBox:!1};class no extends yi{static getDefaults(){return s(s({},super.getDefaults()),no.ownDefaults)}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),t(this,"strokeDiff",void 0),Object.assign(this,no.ownDefaults),this.setOptions(g),this.points=d;const{left:_,top:x}=g;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof _&&this.set(P,_),"number"==typeof x&&this.set(E,x)}isOpen(){return!0}_projectStrokeOnPoints(d){return Si(this.points,d,this.isOpen())}_calcDimensions(d){d=s({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},d||{});const g=this.exactBoundingBox?this._projectStrokeOnPoints(d).map((d=>d.projectedPoint)):this.points;if(0===g.length)return{left:0,top:0,width:0,height:0,pathOffset:new ot,strokeOffset:new ot,strokeDiff:new ot};const _=me(g),x=jt(s(s({},d),{},{scaleX:1,scaleY:1})),b=me(this.points.map((d=>Ct(d,x,!0)))),S=new ot(this.scaleX,this.scaleY);let w=_.left+_.width/2,T=_.top+_.height/2;return this.exactBoundingBox&&(w-=T*Math.tan(yt(this.skewX)),T-=w*Math.tan(yt(this.skewY))),s(s({},_),{},{pathOffset:new ot(w,T),strokeOffset:new ot(b.left,b.top).subtract(new ot(_.left,_.top)).multiply(S),strokeDiff:new ot(_.width,_.height).subtract(new ot(b.width,b.height)).multiply(S)})}_findCenterFromElement(){const d=me(this.points);return new ot(d.left+d.width/2,d.top+d.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(d){const{left:g,top:_,width:x,height:b,pathOffset:S,strokeOffset:w,strokeDiff:T}=this._calcDimensions();this.set({width:x,height:b,pathOffset:S,strokeOffset:w,strokeDiff:T}),d&&this.setPositionByOrigin(new ot(g+x/2,_+b/2),M,M)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new ot(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){let S;if(Object.keys(d).some((d=>this.strokeUniform||this.constructor.layoutProperties.includes(d)))){var g,_;const{width:x,height:b}=this._calcDimensions(d);S=new ot(null!==(g=d.width)&&void 0!==g?g:x,null!==(_=d.height)&&void 0!==_?_:b)}else{var x,b;S=new ot(null!==(x=d.width)&&void 0!==x?x:this.width,null!==(b=d.height)&&void 0!==b?b:this.height)}return S.multiply(new ot(d.scaleX||this.scaleX,d.scaleY||this.scaleY))}return super._getTransformedDimensions(d)}_set(d,g){const _=this.initialized&&this[d]!==g,x=super._set(d,g);return this.exactBoundingBox&&_&&((d===U||d===q)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(d))&&this.setDimensions(),x}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s(s({},super.toObject(d)),{},{points:this.points.map((d=>{let{x:g,y:_}=d;return{x:g,y:_}}))})}_toSVG(){const g=[],_=this.pathOffset.x,x=this.pathOffset.y,b=d.NUM_FRACTION_DIGITS;for(let d=0,S=this.points.length;d<S;d++)g.push(Ut(this.points[d].x-_,b),",",Ut(this.points[d].y-x,b)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(g.join(""),'" />\n')]}_render(d){const g=this.points.length,_=this.pathOffset.x,x=this.pathOffset.y;if(g&&!isNaN(this.points[g-1].y)){d.beginPath(),d.moveTo(this.points[0].x-_,this.points[0].y-x);for(let b=0;b<g;b++){const g=this.points[b];d.lineTo(g.x-_,g.y-x)}!this.isOpen()&&d.closePath(),this._renderPaintInOrder(d)}}complexity(){return this.points.length}static async fromElement(d,g,_){return new this(so(d.getAttribute("points")),s(s({},i(ur(d,this.ATTRIBUTE_NAMES,_),ao)),g))}static fromObject(d){return this._fromObject(d,{extraParam:"points"})}}t(no,"ownDefaults",ho),t(no,"type","Polyline"),t(no,"layoutProperties",[K,Q,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),t(no,"cacheProperties",[...Cs,"points"]),t(no,"ATTRIBUTE_NAMES",[...Xi]),at.setClass(no),at.setSVGClass(no);class oo extends no{isOpen(){return!1}}t(oo,"ownDefaults",ho),t(oo,"type","Polygon"),at.setClass(oo),at.setSVGClass(oo);const co=["fontSize","fontWeight","fontFamily","fontStyle"],lo=["underline","overline","linethrough"],uo=[...co,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],go=[...uo,...lo,"textBackgroundColor","direction"],fo=[...co,...lo,Z,"strokeWidth",J,"deltaY","textBackgroundColor"],po={_reNewline:L,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:P,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:P,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},mo="justify",vo="justify-left",_o="justify-right",xo="justify-center";class yo extends yi{isEmptyStyles(d){if(!this.styles)return!0;if(void 0!==d&&!this.styles[d])return!0;const g=void 0===d?this.styles:{line:this.styles[d]};for(const d in g)for(const _ in g[d])for(const x in g[d][_])return!1;return!0}styleHas(d,g){if(!this.styles)return!1;if(void 0!==g&&!this.styles[g])return!1;const _=void 0===g?this.styles:{0:this.styles[g]};for(const g in _)for(const x in _[g])if(void 0!==_[g][x][d])return!0;return!1}cleanStyle(d){if(!this.styles)return!1;const g=this.styles;let _,x,b=0,S=!0,w=0;for(const w in g){_=0;for(const T in g[w]){const O=g[w][T]||{};b++,void 0!==O[d]?(x?O[d]!==x&&(S=!1):x=O[d],O[d]===this[d]&&delete O[d]):S=!1,0!==Object.keys(O).length?_++:delete g[w][T]}0===_&&delete g[w]}for(let d=0;d<this._textLines.length;d++)w+=this._textLines[d].length;S&&b===w&&(this[d]=x,this.removeStyle(d))}removeStyle(d){if(!this.styles)return;const g=this.styles;let _,x,b;for(x in g){for(b in _=g[x],_)delete _[b][d],0===Object.keys(_[b]).length&&delete _[b];0===Object.keys(_).length&&delete g[x]}}_extendStyles(d,g){const{lineIndex:_,charIndex:x}=this.get2DCursorLocation(d);this._getLineStyle(_)||this._setLineStyle(_);const b=Xt(s(s({},this._getStyleDeclaration(_,x)),g),(d=>void 0!==d));this._setStyleDeclaration(_,x,b)}getSelectionStyles(d,g,_){const x=[];for(let b=d;b<(g||d);b++)x.push(this.getStyleAtPosition(b,_));return x}getStyleAtPosition(d,g){const{lineIndex:_,charIndex:x}=this.get2DCursorLocation(d);return g?this.getCompleteStyleDeclaration(_,x):this._getStyleDeclaration(_,x)}setSelectionStyles(d,g,_){for(let x=g;x<(_||g);x++)this._extendStyles(x,d);this._forceClearCache=!0}_getStyleDeclaration(d,g){var _;const x=this.styles&&this.styles[d];return x&&null!==(_=x[g])&&void 0!==_?_:{}}getCompleteStyleDeclaration(d,g){return s(s({},Bt(this,this.constructor._styleProperties)),this._getStyleDeclaration(d,g))}_setStyleDeclaration(d,g,_){this.styles[d][g]=_}_deleteStyleDeclaration(d,g){delete this.styles[d][g]}_getLineStyle(d){return!!this.styles[d]}_setLineStyle(d){this.styles[d]={}}_deleteLineStyle(d){delete this.styles[d]}}t(yo,"_styleProperties",fo);const bo=/  +/g,wo=/"/g;function Co(g,_,x,b,S){return"\t\t".concat(function(g,_){let{left:x,top:b,width:S,height:w}=_,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.NUM_FRACTION_DIGITS;const O=Qt(J,g,!1),[D,k,M,P]=[x,b,S,w].map((d=>Ut(d,T)));return"<rect ".concat(O,' x="').concat(D,'" y="').concat(k,'" width="').concat(M,'" height="').concat(P,'"></rect>')}(g,{left:_,top:x,width:b,height:S}),"\n")}const Oo=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Eo;class So extends yo{static getDefaults(){return s(s({},super.getDefaults()),So.ownDefaults)}constructor(d,g){super(),t(this,"__charBounds",[]),Object.assign(this,So.ownDefaults),this.setOptions(g),this.styles||(this.styles={}),this.text=d,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const d=this.path;d&&(d.segmentsInfo=Jr(d.path))}_splitText(){const d=this._splitTextIntoLines(this.text);return this.textLines=d.lines,this._textLines=d.graphemeLines,this._unwrappedTextLines=d._unwrappedLines,this._text=d.graphemeText,d}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(mo)&&this.enlargeSpaces()}enlargeSpaces(){let d,g,_,x,b,S,w;for(let T=0,O=this._textLines.length;T<O;T++)if((this.textAlign===mo||T!==O-1&&!this.isEndOfWrapping(T))&&(x=0,b=this._textLines[T],g=this.getLineWidth(T),g<this.width&&(w=this.textLines[T].match(this._reSpacesAndTabs)))){_=w.length,d=(this.width-g)/_;for(let g=0;g<=b.length;g++)S=this.__charBounds[T][g],this._reSpaceAndTab.test(b[g])?(S.width+=d,S.kernedWidth+=d,S.left+=x,x+=d):S.left+=x}}isEndOfWrapping(d){return d===this._textLines.length-1}missingNewlineOffset(d){return 1}get2DCursorLocation(d,g){const _=g?this._unwrappedTextLines:this._textLines;let x;for(x=0;x<_.length;x++){if(d<=_[x].length)return{lineIndex:x,charIndex:d};d-=_[x].length+this.missingNewlineOffset(x,g)}return{lineIndex:x-1,charIndex:_[x-1].length<d?_[x-1].length:d}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const d=super._getCacheCanvasDimensions(),g=this.fontSize;return d.width+=g*d.zoomX,d.height+=g*d.zoomY,d}_render(d){const g=this.path;g&&!g.isNotVisible()&&g._render(d),this._setTextStyles(d),this._renderTextLinesBackground(d),this._renderTextDecoration(d,"underline"),this._renderText(d),this._renderTextDecoration(d,"overline"),this._renderTextDecoration(d,"linethrough")}_renderText(d){this.paintFirst===Z?(this._renderTextStroke(d),this._renderTextFill(d)):(this._renderTextFill(d),this._renderTextStroke(d))}_setTextStyles(d,g,_){if(d.textBaseline="alphabetic",this.path)switch(this.pathAlign){case M:d.textBaseline="middle";break;case"ascender":d.textBaseline=E;break;case"descender":d.textBaseline=A}d.font=this._getFontDeclaration(g,_)}calcTextWidth(){let d=this.getLineWidth(0);for(let g=1,_=this._textLines.length;g<_;g++){const _=this.getLineWidth(g);_>d&&(d=_)}return d}_renderTextLine(d,g,_,x,b,S){this._renderChars(d,g,_,x,b,S)}_renderTextLinesBackground(d){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const g=d.fillStyle,_=this._getLeftOffset();let x=this._getTopOffset();for(let g=0,b=this._textLines.length;g<b;g++){const b=this.getHeightOfLine(g);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",g)){x+=b;continue}const S=this._textLines[g].length,w=this._getLineLeftOffset(g);let T,O,D=0,k=0,M=this.getValueOfPropertyAt(g,0,"textBackgroundColor");for(let P=0;P<S;P++){const S=this.__charBounds[g][P];O=this.getValueOfPropertyAt(g,P,"textBackgroundColor"),this.path?(d.save(),d.translate(S.renderLeft,S.renderTop),d.rotate(S.angle),d.fillStyle=O,O&&d.fillRect(-S.width/2,-b/this.lineHeight*(1-this._fontSizeFraction),S.width,b/this.lineHeight),d.restore()):O!==M?(T=_+w+k,"rtl"===this.direction&&(T=this.width-T-D),d.fillStyle=M,M&&d.fillRect(T,x,D,b/this.lineHeight),k=S.left,D=S.width,M=O):D+=S.kernedWidth}O&&!this.path&&(T=_+w+k,"rtl"===this.direction&&(T=this.width-T-D),d.fillStyle=O,d.fillRect(T,x,D,b/this.lineHeight)),x+=b}d.fillStyle=g,this._removeShadow(d)}_measureChar(d,g,_,b){const S=x.getFontCache(g),w=this._getFontDeclaration(g),T=_+d,O=_&&w===this._getFontDeclaration(b),D=g.fontSize/this.CACHE_FONT_SIZE;let k,M,P,E;if(_&&void 0!==S[_]&&(P=S[_]),void 0!==S[d]&&(E=k=S[d]),O&&void 0!==S[T]&&(M=S[T],E=M-P),void 0===k||void 0===P||void 0===M){const x=function(){if(!Eo){const d=pt();d.width=d.height=0,Eo=d.getContext("2d")}return Eo}();this._setTextStyles(x,g,!0),void 0===k&&(E=k=x.measureText(d).width,S[d]=k),void 0===P&&O&&_&&(P=x.measureText(_).width,S[_]=P),O&&void 0===M&&(M=x.measureText(T).width,S[T]=M,E=M-P)}return{width:k*D,kernedWidth:E*D}}getHeightOfChar(d,g){return this.getValueOfPropertyAt(d,g,"fontSize")}measureLine(d){const g=this._measureLine(d);return 0!==this.charSpacing&&(g.width-=this._getWidthOfCharSpacing()),g.width<0&&(g.width=0),g}_measureLine(d){let g,_,x=0;const b=this.pathSide===j,S=this.path,w=this._textLines[d],T=w.length,O=new Array(T);this.__charBounds[d]=O;for(let b=0;b<T;b++){const S=w[b];_=this._getGraphemeBox(S,d,b,g),O[b]=_,x+=_.kernedWidth,g=S}if(O[T]={left:_?_.left+_.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},S&&S.segmentsInfo){let d=0;const g=S.segmentsInfo[S.segmentsInfo.length-1].length;switch(this.textAlign){case P:d=b?g-x:0;break;case M:d=(g-x)/2;break;case j:d=b?0:g-x}d+=this.pathStartOffset*(b?-1:1);for(let x=b?T-1:0;b?x>=0:x<T;b?x--:x++)_=O[x],d>g?d%=g:d<0&&(d+=g),this._setGraphemeOnPath(d,_),d+=_.kernedWidth}return{width:x,numOfSpaces:0}}_setGraphemeOnPath(d,g){const _=d+g.kernedWidth/2,x=this.path,b=Qr(x.path,_,x.segmentsInfo);g.renderLeft=b.x-x.pathOffset.x,g.renderTop=b.y-x.pathOffset.y,g.angle=b.angle+(this.pathSide===j?Math.PI:0)}_getGraphemeBox(d,g,_,x,b){const S=this.getCompleteStyleDeclaration(g,_),w=x?this.getCompleteStyleDeclaration(g,_-1):{},T=this._measureChar(d,S,x,w);let O,D=T.kernedWidth,k=T.width;0!==this.charSpacing&&(O=this._getWidthOfCharSpacing(),k+=O,D+=O);const M={width:k,left:0,height:S.fontSize,kernedWidth:D,deltaY:S.deltaY};if(_>0&&!b){const d=this.__charBounds[g][_-1];M.left=d.left+d.width+T.kernedWidth-T.width}return M}getHeightOfLine(d){if(this.__lineHeights[d])return this.__lineHeights[d];let g=this.getHeightOfChar(d,0);for(let _=1,x=this._textLines[d].length;_<x;_++)g=Math.max(this.getHeightOfChar(d,_),g);return this.__lineHeights[d]=g*this.lineHeight*this._fontSizeMult}calcTextHeight(){let d,g=0;for(let _=0,x=this._textLines.length;_<x;_++)d=this.getHeightOfLine(_),g+=_===x-1?d/this.lineHeight:d;return g}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(d,g){d.save();let _=0;const x=this._getLeftOffset(),b=this._getTopOffset();for(let S=0,w=this._textLines.length;S<w;S++){const w=this.getHeightOfLine(S),T=w/this.lineHeight,O=this._getLineLeftOffset(S);this._renderTextLine(g,d,this._textLines[S],x+O,b+_+T,S),_+=w}d.restore()}_renderTextFill(d){(this.fill||this.styleHas(J))&&this._renderTextCommon(d,"fillText")}_renderTextStroke(d){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(d),d.save(),this._setLineDash(d,this.strokeDashArray),d.beginPath(),this._renderTextCommon(d,"strokeText"),d.closePath(),d.restore())}_renderChars(d,g,_,x,b,S){const w=this.getHeightOfLine(S),T=this.textAlign.includes(mo),O=this.path,D=!T&&0===this.charSpacing&&this.isEmptyStyles(S)&&!O,k="ltr"===this.direction,M="ltr"===this.direction?1:-1,E=g.direction;let A,F,L,B,R,X="",W=0;if(g.save(),E!==this.direction&&(g.canvas.setAttribute("dir",k?"ltr":"rtl"),g.direction=k?"ltr":"rtl",g.textAlign=k?P:j),b-=w*this._fontSizeFraction/this.lineHeight,D)return this._renderChar(d,g,S,0,_.join(""),x,b),void g.restore();for(let w=0,D=_.length-1;w<=D;w++)B=w===D||this.charSpacing||O,X+=_[w],L=this.__charBounds[S][w],0===W?(x+=M*(L.kernedWidth-L.width),W+=L.width):W+=L.kernedWidth,T&&!B&&this._reSpaceAndTab.test(_[w])&&(B=!0),B||(A=A||this.getCompleteStyleDeclaration(S,w),F=this.getCompleteStyleDeclaration(S,w+1),B=Pi(A,F,!1)),B&&(O?(g.save(),g.translate(L.renderLeft,L.renderTop),g.rotate(L.angle),this._renderChar(d,g,S,w,X,-W/2,0),g.restore()):(R=x,this._renderChar(d,g,S,w,X,R,b)),X="",A=F,x+=M*W,W=0);g.restore()}_applyPatternGradientTransformText(d){const g=pt(),_=this.width+this.strokeWidth,x=this.height+this.strokeWidth,b=g.getContext("2d");return g.width=_,g.height=x,b.beginPath(),b.moveTo(0,0),b.lineTo(_,0),b.lineTo(_,x),b.lineTo(0,x),b.closePath(),b.translate(_/2,x/2),b.fillStyle=d.toLive(b),this._applyPatternGradientTransform(b,d),b.fill(),b.createPattern(g,"no-repeat")}handleFiller(d,g,_){let x,b;return Zt(_)?"percentage"===_.gradientUnits||_.gradientTransform||_.patternTransform?(x=-this.width/2,b=-this.height/2,d.translate(x,b),d[g]=this._applyPatternGradientTransformText(_),{offsetX:x,offsetY:b}):(d[g]=_.toLive(d),this._applyPatternGradientTransform(d,_)):(d[g]=_,{offsetX:0,offsetY:0})}_setStrokeStyles(d,g){let{stroke:_,strokeWidth:x}=g;return d.lineWidth=x,d.lineCap=this.strokeLineCap,d.lineDashOffset=this.strokeDashOffset,d.lineJoin=this.strokeLineJoin,d.miterLimit=this.strokeMiterLimit,this.handleFiller(d,"strokeStyle",_)}_setFillStyles(d,g){let{fill:_}=g;return this.handleFiller(d,"fillStyle",_)}_renderChar(d,g,_,x,b,S,w){const T=this._getStyleDeclaration(_,x),O=this.getCompleteStyleDeclaration(_,x),D="fillText"===d&&O.fill,k="strokeText"===d&&O.stroke&&O.strokeWidth;if(k||D){if(g.save(),g.font=this._getFontDeclaration(O),T.textBackgroundColor&&this._removeShadow(g),T.deltaY&&(w+=T.deltaY),D){const d=this._setFillStyles(g,O);g.fillText(b,S-d.offsetX,w-d.offsetY)}if(k){const d=this._setStrokeStyles(g,O);g.strokeText(b,S-d.offsetX,w-d.offsetY)}g.restore()}}setSuperscript(d,g){this._setScript(d,g,this.superscript)}setSubscript(d,g){this._setScript(d,g,this.subscript)}_setScript(d,g,_){const x=this.get2DCursorLocation(d,!0),b=this.getValueOfPropertyAt(x.lineIndex,x.charIndex,"fontSize"),S=this.getValueOfPropertyAt(x.lineIndex,x.charIndex,"deltaY"),w={fontSize:b*_.size,deltaY:S+b*_.baseline};this.setSelectionStyles(w,d,g)}_getLineLeftOffset(d){const g=this.getLineWidth(d),_=this.width-g,x=this.textAlign,b=this.direction,S=this.isEndOfWrapping(d);let w=0;return x===mo||x===xo&&!S||x===_o&&!S||x===vo&&!S?0:(x===M&&(w=_/2),x===j&&(w=_),x===xo&&(w=_/2),x===_o&&(w=_),"rtl"===b&&(x===j||x===mo||x===_o?w=0:x===P||x===vo?w=-_:x!==M&&x!==xo||(w=-_/2)),w)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(d){if(void 0!==this.__lineWidths[d])return this.__lineWidths[d];const{width:g}=this.measureLine(d);return this.__lineWidths[d]=g,g}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(d,g,_){var x;return null!==(x=this._getStyleDeclaration(d,g)[_])&&void 0!==x?x:this[_]}_renderTextDecoration(d,g){if(!this[g]&&!this.styleHas(g))return;let _=this._getTopOffset();const x=this._getLeftOffset(),b=this.path,S=this._getWidthOfCharSpacing(),w=this.offsets[g];for(let T=0,O=this._textLines.length;T<O;T++){const O=this.getHeightOfLine(T);if(!this[g]&&!this.styleHas(g,T)){_+=O;continue}const D=this._textLines[T],k=O/this.lineHeight,M=this._getLineLeftOffset(T);let P,E,A=0,j=0,F=this.getValueOfPropertyAt(T,0,g),L=this.getValueOfPropertyAt(T,0,J);const B=_+k*(1-this._fontSizeFraction);let R=this.getHeightOfChar(T,0),X=this.getValueOfPropertyAt(T,0,"deltaY");for(let _=0,S=D.length;_<S;_++){const S=this.__charBounds[T][_];P=this.getValueOfPropertyAt(T,_,g),E=this.getValueOfPropertyAt(T,_,J);const O=this.getHeightOfChar(T,_),D=this.getValueOfPropertyAt(T,_,"deltaY");if(b&&P&&E)d.save(),d.fillStyle=L,d.translate(S.renderLeft,S.renderTop),d.rotate(S.angle),d.fillRect(-S.kernedWidth/2,w*O+D,S.kernedWidth,this.fontSize/15),d.restore();else if((P!==F||E!==L||O!==R||D!==X)&&j>0){let g=x+M+A;"rtl"===this.direction&&(g=this.width-g-j),F&&L&&(d.fillStyle=L,d.fillRect(g,B+w*R+X,j,this.fontSize/15)),A=S.left,j=S.width,F=P,L=E,R=O,X=D}else j+=S.kernedWidth}let W=x+M+A;"rtl"===this.direction&&(W=this.width-W-j),d.fillStyle=E,P&&E&&d.fillRect(W,B+w*R+X,j-S,this.fontSize/15),_+=O}this._removeShadow(d)}_getFontDeclaration(){let{fontFamily:d=this.fontFamily,fontStyle:g=this.fontStyle,fontWeight:_=this.fontWeight,fontSize:x=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;const S=d.includes("'")||d.includes('"')||d.includes(",")||So.genericFonts.includes(d.toLowerCase())?d:'"'.concat(d,'"');return[g,_,"".concat(b?this.CACHE_FONT_SIZE:x,"px"),S].join(" ")}render(d){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(d)))}graphemeSplit(d){return ki(d)}_splitTextIntoLines(d){const g=d.split(this._reNewline),_=new Array(g.length),x=["\n"];let b=[];for(let d=0;d<g.length;d++)_[d]=this.graphemeSplit(g[d]),b=b.concat(_[d],x);return b.pop(),{_unwrappedLines:_,lines:g,graphemeText:b,graphemeLines:_}}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s(s({},super.toObject([...go,...d])),{},{styles:Ei(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(d,g){const{textLayoutProperties:_}=this.constructor;super.set(d,g);let x=!1,b=!1;if("object"==typeof d)for(const g in d)"path"===g&&this.setPathInfo(),x=x||_.includes(g),b=b||"path"===g;else x=_.includes(d),b="path"===d;return b&&this.setPathInfo(),x&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(d,g,_){const x=ur(d,So.ATTRIBUTE_NAMES,_),b=s(s({},g),x),{textAnchor:S=P,textDecoration:w="",dx:T=0,dy:O=0,top:k=0,left:E=0,fontSize:A=D,strokeWidth:F=1}=b,L=i(b,Oo),B=new this((d.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),s({left:E+T,top:k+O,underline:w.includes("underline"),overline:w.includes("overline"),linethrough:w.includes("line-through"),strokeWidth:0,fontSize:A},L)),R=B.getScaledHeight()/B.height,X=((B.height+B.strokeWidth)*B.lineHeight-B.height)*R,W=B.getScaledHeight()+X;let Y=0;return S===M&&(Y=B.getScaledWidth()/2),S===j&&(Y=B.getScaledWidth()),B.set({left:B.left-Y,top:B.top-(W-B.fontSize*(.07+B._fontSizeFraction))/B.lineHeight,strokeWidth:F}),B}static fromObject(d){return this._fromObject(s(s({},d),{},{styles:Ai(d.styles||{},d.text)}),{extraParam:"text"})}}t(So,"textLayoutProperties",uo),t(So,"cacheProperties",[...Cs,...go]),t(So,"ownDefaults",po),t(So,"type","Text"),t(So,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),t(So,"ATTRIBUTE_NAMES",Xi.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),vi(So,[class extends Be{_toSVG(){const d=this._getSVGLeftTopOffsets(),g=this._getSVGTextAndBg(d.textTop,d.textLeft);return this._wrapSVGTextAndBg(g)}toSVG(d){return this._createBaseSVGMarkup(this._toSVG(),{reviver:d,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(d){let{textBgRects:g,textSpans:_}=d;const x=this.getSvgTextDecoration(this);return[g.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(wo,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",x?'text-decoration="'.concat(x,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",_.join(""),"</text>\n"]}_getSVGTextAndBg(d,g){const _=[],x=[];let b,S=d;this.backgroundColor&&x.push(...Co(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let d=0,w=this._textLines.length;d<w;d++)b=this._getLineLeftOffset(d),"rtl"===this.direction&&(b+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",d))&&this._setSVGTextLineBg(x,d,g+b,S),this._setSVGTextLineText(_,d,g+b,S),S+=this.getHeightOfLine(d);return{textSpans:_,textBgRects:x}}_createTextCharSpan(g,_,x,b){const S=this.getSvgSpanStyles(_,g!==g.trim()||!!g.match(bo)),w=S?'style="'.concat(S,'"'):"",T=_.deltaY,O=T?' dy="'.concat(Ut(T,d.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(Ut(x,d.NUM_FRACTION_DIGITS),'" y="').concat(Ut(b,d.NUM_FRACTION_DIGITS),'" ').concat(O).concat(w,">").concat(Oi(g),"</tspan>")}_setSVGTextLineText(d,g,_,x){const b=this.getHeightOfLine(g),S=this.textAlign.includes(mo),w=this._textLines[g];let T,O,D,k,M,P="",E=0;x+=b*(1-this._fontSizeFraction)/this.lineHeight;for(let b=0,A=w.length-1;b<=A;b++)M=b===A||this.charSpacing,P+=w[b],D=this.__charBounds[g][b],0===E?(_+=D.kernedWidth-D.width,E+=D.width):E+=D.kernedWidth,S&&!M&&this._reSpaceAndTab.test(w[b])&&(M=!0),M||(T=T||this.getCompleteStyleDeclaration(g,b),O=this.getCompleteStyleDeclaration(g,b+1),M=Pi(T,O,!0)),M&&(k=this._getStyleDeclaration(g,b),d.push(this._createTextCharSpan(P,k,_,x)),P="",T=O,"rtl"===this.direction?_-=E:_+=E,E=0)}_setSVGTextLineBg(d,g,_,x){const b=this._textLines[g],S=this.getHeightOfLine(g)/this.lineHeight;let w,T=0,O=0,D=this.getValueOfPropertyAt(g,0,"textBackgroundColor");for(let k=0;k<b.length;k++){const{left:b,width:M,kernedWidth:P}=this.__charBounds[g][k];w=this.getValueOfPropertyAt(g,k,"textBackgroundColor"),w!==D?(D&&d.push(...Co(D,_+O,x,T,S)),O=b,T=M,D=w):T+=P}w&&d.push(...Co(D,_+O,x,T,S))}_getSVGLineTopOffset(d){let g,_=0;for(g=0;g<d;g++)_+=this.getHeightOfLine(g);const x=this.getHeightOfLine(g);return{lineTop:_,offset:(this._fontSizeMult-this._fontSizeFraction)*x/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(d){return"".concat(super.getSvgStyles(d)," white-space: pre;")}getSvgSpanStyles(d,g){const{fontFamily:_,strokeWidth:x,stroke:b,fill:S,fontSize:w,fontStyle:T,fontWeight:O,deltaY:D}=d,k=this.getSvgTextDecoration(d);return[b?Qt(Z,b):"",x?"stroke-width: ".concat(x,"; "):"",_?"font-family: ".concat(_.includes("'")||_.includes('"')?_:"'".concat(_,"'"),"; "):"",w?"font-size: ".concat(w,"px; "):"",T?"font-style: ".concat(T,"; "):"",O?"font-weight: ".concat(O,"; "):"",k?"text-decoration: ".concat(k,"; "):k,S?Qt(J,S):"",D?"baseline-shift: ".concat(-D,"; "):"",g?"white-space: pre; ":""].join("")}getSvgTextDecoration(d){return["overline","underline","line-through"].filter((g=>d[g.replace("-","")])).join(" ")}}]),at.setClass(So),at.setSVGClass(So);class To{constructor(d){t(this,"target",void 0),t(this,"__mouseDownInPlace",!1),t(this,"__dragStartFired",!1),t(this,"__isDraggingOver",!1),t(this,"__dragStartSelection",void 0),t(this,"__dragImageDisposer",void 0),t(this,"_dispose",void 0),this.target=d;const g=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{g.forEach((d=>d())),this._dispose=void 0}}isPointerOverSelection(d){const g=this.target,_=g.getSelectionStartFromPointer(d);return g.isEditing&&_>=g.selectionStart&&_<=g.selectionEnd&&g.selectionStart<g.selectionEnd}start(d){return this.__mouseDownInPlace=this.isPointerOverSelection(d)}isActive(){return this.__mouseDownInPlace}end(d){const g=this.isActive();return g&&!this.__dragStartFired&&(this.target.setCursorByClick(d),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,g}getDragStartSelection(){return this.__dragStartSelection}setDragImage(d,g){var _;let{selectionStart:x,selectionEnd:b}=g;const S=this.target,w=S.canvas,T=new ot(S.flipX?-1:1,S.flipY?-1:1),O=S._getCursorBoundaries(x),D=new ot(O.left+O.leftOffset,O.top+O.topOffset).multiply(T).transform(S.calcTransformMatrix()),k=w.getScenePoint(d).subtract(D),M=S.getCanvasRetinaScaling(),P=S.getBoundingRect(),E=D.subtract(new ot(P.left,P.top)),A=w.viewportTransform,j=E.add(k).transform(A,!0),L=S.backgroundColor,B=Ti(S.styles);S.backgroundColor="";const R={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};S.setSelectionStyles(R,0,x),S.setSelectionStyles(R,b,S.text.length),S.dirty=!0;const X=S.toCanvasElement({enableRetinaScaling:w.enableRetinaScaling,viewportTransform:!0});S.backgroundColor=L,S.styles=B,S.dirty=!0,on(X,{position:"fixed",left:"".concat(-X.width,"px"),border:F,width:"".concat(X.width/M,"px"),height:"".concat(X.height/M,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{X.remove()},re(d.target||this.target.hiddenTextarea).body.appendChild(X),null===(_=d.dataTransfer)||void 0===_||_.setDragImage(X,j.x,j.y)}onDragStart(d){this.__dragStartFired=!0;const g=this.target,_=this.isActive();if(_&&d.dataTransfer){const _=this.__dragStartSelection={selectionStart:g.selectionStart,selectionEnd:g.selectionEnd},x=g._text.slice(_.selectionStart,_.selectionEnd).join(""),b=s({text:g.text,value:x},_);d.dataTransfer.setData("text/plain",x),d.dataTransfer.setData("application/fabric",JSON.stringify({value:x,styles:g.getSelectionStyles(_.selectionStart,_.selectionEnd,!0)})),d.dataTransfer.effectAllowed="copyMove",this.setDragImage(d,b)}return g.abortCursorAnimation(),_}canDrop(d){if(this.target.editable&&!this.target.getActiveControl()&&!d.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const g=this.target.getSelectionStartFromPointer(d),_=this.__dragStartSelection;return g<_.selectionStart||g>_.selectionEnd}return!0}return!1}targetCanDrop(d){return this.target.canDrop(d)}dragEnterHandler(d){let{e:g}=d;const _=this.targetCanDrop(g);!this.__isDraggingOver&&_&&(this.__isDraggingOver=!0)}dragOverHandler(d){const{e:g}=d,_=this.targetCanDrop(g);!this.__isDraggingOver&&_?this.__isDraggingOver=!0:this.__isDraggingOver&&!_&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(g.preventDefault(),d.canDrop=!0,d.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(d){var g;const{e:_}=d,x=_.defaultPrevented;this.__isDraggingOver=!1,_.preventDefault();let b=null===(g=_.dataTransfer)||void 0===g?void 0:g.getData("text/plain");if(b&&!x){const g=this.target,x=g.canvas;let S=g.getSelectionStartFromPointer(_);const{styles:w}=_.dataTransfer.types.includes("application/fabric")?JSON.parse(_.dataTransfer.getData("application/fabric")):{},T=b[Math.max(0,b.length-1)],O=0;if(this.__dragStartSelection){const d=this.__dragStartSelection.selectionStart,_=this.__dragStartSelection.selectionEnd;S>d&&S<=_?S=d:S>_&&(S-=_-d),g.removeChars(d,_),delete this.__dragStartSelection}g._reNewline.test(T)&&(g._reNewline.test(g._text[S])||S===g._text.length)&&(b=b.trimEnd()),d.didDrop=!0,d.dropTarget=g,g.insertChars(b,w,S),x.setActiveObject(g),g.enterEditing(_),g.selectionStart=Math.min(S+O,g._text.length),g.selectionEnd=Math.min(g.selectionStart+b.length,g._text.length),g.hiddenTextarea.value=g.text,g._updateTextarea(),g.hiddenTextarea.focus(),g.fire(N,{index:S+O,action:"drop"}),x.fire("text:changed",{target:g}),x.contextTopDirty=!0,x.requestRenderAll()}}dragEndHandler(d){let{e:g}=d;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var _;const d=this.target,x=this.target.canvas,{selectionStart:b,selectionEnd:S}=this.__dragStartSelection,w=(null===(_=g.dataTransfer)||void 0===_?void 0:_.dropEffect)||F;w===F?(d.selectionStart=b,d.selectionEnd=S,d._updateTextarea(),d.hiddenTextarea.focus()):(d.clearContextTop(),"move"===w&&(d.removeChars(b,S),d.selectionStart=d.selectionEnd=b,d.hiddenTextarea&&(d.hiddenTextarea.value=d.text),d._updateTextarea(),d.fire(N,{index:b,action:"dragend"}),x.fire("text:changed",{target:d}),x.requestRenderAll()),d.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Ao=/[ \n\.,;!\?\-]/;class ko extends So{constructor(){super(...arguments),t(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(d){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(d)}_animateCursor(d){let{toValue:g,duration:_,delay:x,onComplete:b}=d;return As({startValue:this._currentCursorOpacity,endValue:g,duration:_,delay:x,onComplete:b,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:d=>{this._currentCursorOpacity=d,this.renderCursorOrSelection()}})}_tick(d){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(d||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var d;null===(d=this._currentTickCompleteState)||void 0===d||d.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(d){this.abortCursorAnimation(),this._tick(d?0:this.cursorDelay)}abortCursorAnimation(){let d=!1;[this._currentTickState,this._currentTickCompleteState].forEach((g=>{g&&!g.isDone()&&(d=!0,g.abort())})),this._currentCursorOpacity=1,d&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((d=>!d||d.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(d){let g=0,_=d-1;if(this._reSpace.test(this._text[_]))for(;this._reSpace.test(this._text[_]);)g++,_--;for(;/\S/.test(this._text[_])&&_>-1;)g++,_--;return d-g}findWordBoundaryRight(d){let g=0,_=d;if(this._reSpace.test(this._text[_]))for(;this._reSpace.test(this._text[_]);)g++,_++;for(;/\S/.test(this._text[_])&&_<this._text.length;)g++,_++;return d+g}findLineBoundaryLeft(d){let g=0,_=d-1;for(;!/\n/.test(this._text[_])&&_>-1;)g++,_--;return d-g}findLineBoundaryRight(d){let g=0,_=d;for(;!/\n/.test(this._text[_])&&_<this._text.length;)g++,_++;return d+g}searchWordBoundary(d,g){const _=this._text;let x=d>0&&this._reSpace.test(_[d])&&(-1===g||!L.test(_[d-1]))?d-1:d,b=_[x];for(;x>0&&x<_.length&&!Ao.test(b);)x+=g,b=_[x];return-1===g&&Ao.test(b)&&x++,x}selectWord(d){d=d||this.selectionStart;const g=this.searchWordBoundary(d,-1),_=Math.max(g,this.searchWordBoundary(d,1));this.selectionStart=g,this.selectionEnd=_,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(d){d=d||this.selectionStart;const g=this.findLineBoundaryLeft(d),_=this.findLineBoundaryRight(d);return this.selectionStart=g,this.selectionEnd=_,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(d){!this.isEditing&&this.editable&&(this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered",d?{e:d}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:d}),this.canvas.requestRenderAll()))}updateSelectionOnMouseMove(d){if(this.getActiveControl())return;const g=this.hiddenTextarea;re(g).activeElement!==g&&g.focus();const _=this.getSelectionStartFromPointer(d),x=this.selectionStart,b=this.selectionEnd;(_===this.__selectionStartOnMouseDown&&x!==b||x!==_&&b!==_)&&(_>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=_):(this.selectionStart=_,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===x&&this.selectionEnd===b||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(d,g,_){const x=_.slice(0,d),b=this.graphemeSplit(x).length;if(d===g)return{selectionStart:b,selectionEnd:b};const S=_.slice(d,g);return{selectionStart:b,selectionEnd:b+this.graphemeSplit(S).length}}fromGraphemeToStringSelection(d,g,_){const x=_.slice(0,d).join("").length;return d===g?{selectionStart:x,selectionEnd:x}:{selectionStart:x,selectionEnd:x+_.slice(d,g).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const d=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=d.selectionStart,this.hiddenTextarea.selectionEnd=d.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const d=this.hiddenTextarea;this.text=d.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const g=this.fromStringToGraphemeSelection(d.selectionStart,d.selectionEnd,d.value);this.selectionEnd=this.selectionStart=g.selectionEnd,this.inCompositionMode||(this.selectionStart=g.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const d=this._calcTextareaPosition();this.hiddenTextarea.style.left=d.left,this.hiddenTextarea.style.top=d.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const d=this.inCompositionMode?this.compositionStart:this.selectionStart,g=this._getCursorBoundaries(d),_=this.get2DCursorLocation(d),x=_.lineIndex,b=_.charIndex,S=this.getValueOfPropertyAt(x,b,"fontSize")*this.lineHeight,w=g.leftOffset,T=this.getCanvasRetinaScaling(),O=this.canvas.upperCanvasEl,D=O.width/T,k=O.height/T,M=D-S,P=k-S,E=new ot(g.left+w,g.top+g.topOffset+S).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new ot(O.clientWidth/D,O.clientHeight/k));return E.x<0&&(E.x=0),E.x>M&&(E.x=M),E.y<0&&(E.y=0),E.y>P&&(E.y=P),E.x+=this.canvas._offset.left,E.y+=this.canvas._offset.top,{left:"".concat(E.x,"px"),top:"".concat(E.y,"px"),fontSize:"".concat(S,"px"),charHeight:S}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const d=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,d&&(d.blur&&d.blur(),d.parentNode&&d.parentNode.removeChild(d)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditing(){const d=this._textBeforeEdit!==this.text;return this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),d&&this.fire($),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),d&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const d in this.styles)this._textLines[d]||delete this.styles[d]}removeStyleFromTo(d,g){const{lineIndex:_,charIndex:x}=this.get2DCursorLocation(d,!0),{lineIndex:b,charIndex:S}=this.get2DCursorLocation(g,!0);if(_!==b){if(this.styles[_])for(let d=x;d<this._unwrappedTextLines[_].length;d++)delete this.styles[_][d];if(this.styles[b])for(let d=S;d<this._unwrappedTextLines[b].length;d++){const g=this.styles[b][d];g&&(this.styles[_]||(this.styles[_]={}),this.styles[_][x+d-S]=g)}for(let d=_+1;d<=b;d++)delete this.styles[d];this.shiftLineStyles(b,_-b)}else if(this.styles[_]){const d=this.styles[_],g=S-x;for(let g=x;g<S;g++)delete d[g];for(const x in this.styles[_]){const _=parseInt(x,10);_>=S&&(d[_-g]=d[x],delete d[x])}}}shiftLineStyles(d,g){const _=Object.assign({},this.styles);for(const x in this.styles){const b=parseInt(x,10);b>d&&(this.styles[b+g]=_[b],_[b-g]||delete this.styles[b])}}insertNewlineStyleObject(d,g,_,x){const b={},S=this._unwrappedTextLines[d].length,w=S===g;let T=!1;_||(_=1),this.shiftLineStyles(d,_);const O=this.styles[d]?this.styles[d][0===g?g:g-1]:void 0;for(const _ in this.styles[d]){const x=parseInt(_,10);x>=g&&(T=!0,b[x-g]=this.styles[d][_],w&&0===g||delete this.styles[d][_])}let D=!1;for(T&&!w&&(this.styles[d+_]=b,D=!0),(D||S>g)&&_--;_>0;)x&&x[_-1]?this.styles[d+_]={0:s({},x[_-1])}:O?this.styles[d+_]={0:s({},O)}:delete this.styles[d+_],_--;this._forceClearCache=!0}insertCharStyleObject(d,g,_,x){this.styles||(this.styles={});const b=this.styles[d],S=b?s({},b):{};_||(_=1);for(const d in S){const x=parseInt(d,10);x>=g&&(b[x+_]=S[x],S[x-_]||delete b[x])}if(this._forceClearCache=!0,x){for(;_--;)Object.keys(x[_]).length&&(this.styles[d]||(this.styles[d]={}),this.styles[d][g+_]=s({},x[_]));return}if(!b)return;const w=b[g?g-1:1];for(;w&&_--;)this.styles[d][g+_]=s({},w)}insertNewStyleBlock(d,g,_){const x=this.get2DCursorLocation(g,!0),b=[0];let S,w=0;for(let g=0;g<d.length;g++)"\n"===d[g]?(w++,b[w]=0):b[w]++;for(b[0]>0&&(this.insertCharStyleObject(x.lineIndex,x.charIndex,b[0],_),_=_&&_.slice(b[0]+1)),w&&this.insertNewlineStyleObject(x.lineIndex,x.charIndex+b[0],w),S=1;S<w;S++)b[S]>0?this.insertCharStyleObject(x.lineIndex+S,0,b[S],_):_&&this.styles[x.lineIndex+S]&&_[0]&&(this.styles[x.lineIndex+S][0]=_[0]),_=_&&_.slice(b[S]+1);b[S]>0&&this.insertCharStyleObject(x.lineIndex+S,0,b[S],_)}removeChars(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d+1;this.removeStyleFromTo(d,g),this._text.splice(d,g-d),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(d,g,_){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_;x>_&&this.removeStyleFromTo(_,x);const b=this.graphemeSplit(d);this.insertNewStyleBlock(b,_,g),this._text=[...this._text.slice(0,_),...b,...this._text.slice(x)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(d,g,_){_<=d?(g===d?this._selectionDirection=P:this._selectionDirection===j&&(this._selectionDirection=P,this.selectionEnd=d),this.selectionStart=_):_>d&&_<g?this._selectionDirection===j?this.selectionEnd=_:this.selectionStart=_:(g===d?this._selectionDirection=j:this._selectionDirection===P&&(this._selectionDirection=j,this.selectionStart=g),this.selectionEnd=_)}}class Do extends ko{initHiddenTextarea(){const d=this.canvas&&re(this.canvas.getElement())||m(),g=d.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((d=>{let[_,x]=d;return g.setAttribute(_,x)}));const{top:_,left:x,fontSize:b}=this._calcTextareaPosition();g.style.cssText="position: absolute; top: ".concat(_,"; left: ").concat(x,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(b,";"),(this.hiddenTextareaContainer||d.body).appendChild(g),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((d=>{let[_,x]=d;return g.addEventListener(_,this[x].bind(this))})),this.hiddenTextarea=g}blur(){this.abortCursorAnimation()}onKeyDown(d){if(!this.isEditing)return;const g="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(d.keyCode in g)this[g[d.keyCode]](d);else{if(!(d.keyCode in this.ctrlKeysMapDown)||!d.ctrlKey&&!d.metaKey)return;this[this.ctrlKeysMapDown[d.keyCode]](d)}d.stopImmediatePropagation(),d.preventDefault(),d.keyCode>=33&&d.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(d){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:d.keyCode in this.ctrlKeysMapUp&&(d.ctrlKey||d.metaKey)&&(this[this.ctrlKeysMapUp[d.keyCode]](d),d.stopImmediatePropagation(),d.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(g){const _=this.fromPaste;if(this.fromPaste=!1,g&&g.stopPropagation(),!this.isEditing)return;const s=()=>{this.updateFromTextArea(),this.fire(N),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void s();const x=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,b=this._text.length,S=x.length,w=this.selectionStart,T=this.selectionEnd,O=w!==T;let D,k,M,P,E=S-b;const A=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),j=w>A.selectionStart;O?(k=this._text.slice(w,T),E+=T-w):S<b&&(k=j?this._text.slice(T+E,T):this._text.slice(w,w-E));const F=x.slice(A.selectionEnd-E,A.selectionEnd);if(k&&k.length&&(F.length&&(D=this.getSelectionStyles(w,w+1,!1),D=F.map((()=>D[0]))),O?(M=w,P=T):j?(M=T-k.length,P=T):(M=T,P=T+k.length),this.removeStyleFromTo(M,P)),F.length){const{copyPasteData:g}=p();_&&F.join("")===g.copiedText&&!d.disableStyleCopyPaste&&(D=g.copiedTextStyle),this.insertNewStyleBlock(F,w,D)}s()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(d){let{target:g}=d;const{selectionStart:_,selectionEnd:x}=g;this.compositionStart=_,this.compositionEnd=x,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:g}=p();g.copiedText=this.getSelectedText(),d.disableStyleCopyPaste?g.copiedTextStyle=void 0:g.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(d,g){let _,x=this._getLineLeftOffset(d);return g>0&&(_=this.__charBounds[d][g-1],x+=_.left+_.width),x}getDownCursorOffset(d,g){const _=this._getSelectionForOffset(d,g),x=this.get2DCursorLocation(_),b=x.lineIndex;if(b===this._textLines.length-1||d.metaKey||34===d.keyCode)return this._text.length-_;const S=x.charIndex,w=this._getWidthBeforeCursor(b,S),T=this._getIndexOnLine(b+1,w);return this._textLines[b].slice(S).length+T+1+this.missingNewlineOffset(b)}_getSelectionForOffset(d,g){return d.shiftKey&&this.selectionStart!==this.selectionEnd&&g?this.selectionEnd:this.selectionStart}getUpCursorOffset(d,g){const _=this._getSelectionForOffset(d,g),x=this.get2DCursorLocation(_),b=x.lineIndex;if(0===b||d.metaKey||33===d.keyCode)return-_;const S=x.charIndex,w=this._getWidthBeforeCursor(b,S),T=this._getIndexOnLine(b-1,w),O=this._textLines[b].slice(0,S),D=this.missingNewlineOffset(b-1);return-this._textLines[b-1].length+T-O.length+(1-D)}_getIndexOnLine(d,g){const _=this._textLines[d];let x,b,S=this._getLineLeftOffset(d),w=0;for(let T=0,O=_.length;T<O;T++)if(x=this.__charBounds[d][T].width,S+=x,S>g){b=!0;const d=S-x,_=S,O=Math.abs(d-g);w=Math.abs(_-g)<O?T:T-1;break}return b||(w=_.length-1),w}moveCursorDown(d){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",d)}moveCursorUp(d){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",d)}_moveCursorUpOrDown(d,g){const _=this["get".concat(d,"CursorOffset")](g,this._selectionDirection===j);if(g.shiftKey?this.moveCursorWithShift(_):this.moveCursorWithoutShift(_),0!==_){const d=this.text.length;this.selectionStart=ds(0,this.selectionStart,d),this.selectionEnd=ds(0,this.selectionEnd,d),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(d){const g=this._selectionDirection===P?this.selectionStart+d:this.selectionEnd+d;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,g),0!==d}moveCursorWithoutShift(d){return d<0?(this.selectionStart+=d,this.selectionEnd=this.selectionStart):(this.selectionEnd+=d,this.selectionStart=this.selectionEnd),0!==d}moveCursorLeft(d){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",d)}_move(d,g,_){let x;if(d.altKey)x=this["findWordBoundary".concat(_)](this[g]);else{if(!d.metaKey&&35!==d.keyCode&&36!==d.keyCode)return this[g]+="Left"===_?-1:1,!0;x=this["findLineBoundary".concat(_)](this[g])}return void 0!==x&&this[g]!==x&&(this[g]=x,!0)}_moveLeft(d,g){return this._move(d,g,"Left")}_moveRight(d,g){return this._move(d,g,"Right")}moveCursorLeftWithoutShift(d){let g=!0;return this._selectionDirection=P,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(g=this._moveLeft(d,"selectionStart")),this.selectionEnd=this.selectionStart,g}moveCursorLeftWithShift(d){return this._selectionDirection===j&&this.selectionStart!==this.selectionEnd?this._moveLeft(d,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=P,this._moveLeft(d,"selectionStart")):void 0}moveCursorRight(d){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",d)}_moveCursorLeftOrRight(d,g){const _="moveCursor".concat(d).concat(g.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[_](g)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(d){return this._selectionDirection===P&&this.selectionStart!==this.selectionEnd?this._moveRight(d,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=j,this._moveRight(d,"selectionEnd")):void 0}moveCursorRightWithoutShift(d){let g=!0;return this._selectionDirection=j,this.selectionStart===this.selectionEnd?(g=this._moveRight(d,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,g}}const Mo=d=>!!d.button;class Po extends Do{constructor(){super(...arguments),t(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new To(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(d){return this.draggableTextDelegate.onDragStart(d)}canDrop(d){return this.draggableTextDelegate.canDrop(d)}onMouseDown(d){if(!this.canvas)return;this.__newClickTime=+new Date;const g=d.pointer;this.isTripleClick(g)&&(this.fire("tripleclick",d),pe(d.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=g,this.__lastSelected=this.selected&&!this.getActiveControl()}isTripleClick(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y}doubleClickHandler(d){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(d.e))}tripleClickHandler(d){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(d.e))}_mouseDownHandler(d){let{e:g}=d;this.canvas&&this.editable&&!Mo(g)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(g)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(g)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())))}_mouseDownHandlerBefore(d){let{e:g}=d;this.canvas&&this.editable&&!Mo(g)&&(this.selected=this===this.canvas._activeObject)}mouseUpHandler(d){let{e:g,transform:_}=d;const x=this.draggableTextDelegate.end(g);if(this.canvas){this.canvas.textEditingManager.unregister(this);const d=this.canvas._activeObject;if(d&&d!==this)return}!this.editable||this.group&&!this.group.interactive||_&&_.actionPerformed||Mo(g)||x||(this.__lastSelected&&!this.getActiveControl()?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(g),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(d){const g=this.getSelectionStartFromPointer(d),_=this.selectionStart,x=this.selectionEnd;d.shiftKey?this.setSelectionStartEndWithShift(_,x,g):(this.selectionStart=g,this.selectionEnd=g),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(d){const g=this.canvas.getScenePoint(d).transform(bt(this.calcTransformMatrix())).add(new ot(-this._getLeftOffset(),-this._getTopOffset()));let _=0,x=0,b=0;for(let d=0;d<this._textLines.length&&_<=g.y;d++)_+=this.getHeightOfLine(d),b=d,d>0&&(x+=this._textLines[d-1].length+this.missingNewlineOffset(d-1));let S=Math.abs(this._getLineLeftOffset(b));const w=this._textLines[b].length,T=this.__charBounds[b];for(let d=0;d<w;d++){const _=S+T[d].kernedWidth;if(g.x<=_){Math.abs(g.x-_)<=Math.abs(g.x-S)&&x++;break}S=_,x++}return Math.min(this.flipX?w-x:x,this._text.length)}}const jo="moveCursorUp",Fo="moveCursorDown",Lo="moveCursorLeft",Ro="moveCursorRight",Go="exitEditing",Ko=s({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Go,27:Go,33:jo,34:Fo,35:Ro,36:Lo,37:Lo,38:jo,39:Ro,40:Fo},keysMapRtl:{9:Go,27:Go,33:jo,34:Fo,35:Lo,36:Ro,37:Ro,38:jo,39:Lo,40:Fo},ctrlKeysMapDown:{65:"selectAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class Io extends Po{static getDefaults(){return s(s({},super.getDefaults()),Io.ownDefaults)}get type(){const d=super.type;return"itext"===d?"i-text":d}constructor(d,g){super(d,s(s({},Io.ownDefaults),g)),this.initBehavior()}_set(d,g){return this.isEditing&&this._savedProps&&d in this._savedProps?(this._savedProps[d]=g,this):("canvas"===d&&(this.canvas instanceof xn&&this.canvas.textEditingManager.remove(this),g instanceof xn&&g.textEditingManager.add(this)),super._set(d,g))}setSelectionStart(d){d=Math.max(d,0),this._updateAndFire("selectionStart",d)}setSelectionEnd(d){d=Math.min(d,this.text.length),this._updateAndFire("selectionEnd",d)}_updateAndFire(d,g){this[d]!==g&&(this._fireSelectionChanged(),this[d]=g),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,_=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(d,g,_)}setSelectionStyles(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(d,g,_)}get2DCursorLocation(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,g=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(d,g)}render(d){super.render(d),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(d){const g=this.isEditing;this.isEditing=!1;const _=super.toCanvasElement(d);return this.isEditing=g,_}renderCursorOrSelection(){if(!this.isEditing)return;const d=this.clearContextTop(!0);if(!d)return;const g=this._getCursorBoundaries();this.selectionStart===this.selectionEnd?this.renderCursor(d,g):this.renderSelection(d,g),this.canvas.contextTopDirty=!0,d.restore()}_getCursorBoundaries(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,g=arguments.length>1?arguments[1]:void 0;const _=this._getLeftOffset(),x=this._getTopOffset(),b=this._getCursorBoundariesOffsets(d,g);return{left:_,top:x,leftOffset:b.left,topOffset:b.top}}_getCursorBoundariesOffsets(d,g){return g?this.__getCursorBoundariesOffsets(d):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(d)}__getCursorBoundariesOffsets(d){let g=0,_=0;const{charIndex:x,lineIndex:b}=this.get2DCursorLocation(d);for(let d=0;d<b;d++)g+=this.getHeightOfLine(d);const S=this._getLineLeftOffset(b),w=this.__charBounds[b][x];w&&(_=w.left),0!==this.charSpacing&&x===this._textLines[b].length&&(_-=this._getWidthOfCharSpacing());const T={top:g,left:S+(_>0?_:0)};return"rtl"===this.direction&&(this.textAlign===j||this.textAlign===mo||this.textAlign===_o?T.left*=-1:this.textAlign===P||this.textAlign===vo?T.left=S-(_>0?_:0):this.textAlign!==M&&this.textAlign!==xo||(T.left=S-(_>0?_:0))),T}renderCursorAt(d){const g=this._getCursorBoundaries(d,!0);this._renderCursor(this.canvas.contextTop,g,d)}renderCursor(d,g){this._renderCursor(d,g,this.selectionStart)}_renderCursor(d,g,_){const x=this.get2DCursorLocation(_),b=x.lineIndex,S=x.charIndex>0?x.charIndex-1:0,w=this.getValueOfPropertyAt(b,S,"fontSize"),T=this.getObjectScaling().x*this.canvas.getZoom(),O=this.cursorWidth/T,D=this.getValueOfPropertyAt(b,S,"deltaY"),k=g.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(b)/this.lineHeight-w*(1-this._fontSizeFraction);this.inCompositionMode&&this.renderSelection(d,g),d.fillStyle=this.cursorColor||this.getValueOfPropertyAt(b,S,J),d.globalAlpha=this._currentCursorOpacity,d.fillRect(g.left+g.leftOffset-O/2,k+g.top+D,O,w)}renderSelection(d,g){const _={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(d,_,g)}renderDragSourceEffect(){const d=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,d,this._getCursorBoundaries(d.selectionStart,!0))}renderDropTargetEffect(d){const g=this.getSelectionStartFromPointer(d);this.renderCursorAt(g)}_renderSelection(d,g,_){const x=g.selectionStart,b=g.selectionEnd,S=this.textAlign.includes(mo),w=this.get2DCursorLocation(x),T=this.get2DCursorLocation(b),O=w.lineIndex,D=T.lineIndex,k=w.charIndex<0?0:w.charIndex,E=T.charIndex<0?0:T.charIndex;for(let g=O;g<=D;g++){const x=this._getLineLeftOffset(g)||0;let b=this.getHeightOfLine(g),w=0,T=0,A=0;if(g===O&&(T=this.__charBounds[O][k].left),g>=O&&g<D)A=S&&!this.isEndOfWrapping(g)?this.width:this.getLineWidth(g)||5;else if(g===D)if(0===E)A=this.__charBounds[D][E].left;else{const d=this._getWidthOfCharSpacing();A=this.__charBounds[D][E-1].left+this.__charBounds[D][E-1].width-d}w=b,(this.lineHeight<1||g===D&&this.lineHeight>1)&&(b/=this.lineHeight);let F=_.left+x+T,L=b,B=0;const R=A-T;this.inCompositionMode?(d.fillStyle=this.compositionColor||"black",L=1,B=b):d.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===j||this.textAlign===mo||this.textAlign===_o?F=this.width-F-R:this.textAlign===P||this.textAlign===vo?F=_.left+x-A:this.textAlign!==M&&this.textAlign!==xo||(F=_.left+x-A)),d.fillRect(F,_.top+_.topOffset+B,R,L),_.topOffset+=w}}getCurrentCharFontSize(){const d=this._getCurrentCharIndex();return this.getValueOfPropertyAt(d.l,d.c,"fontSize")}getCurrentCharColor(){const d=this._getCurrentCharIndex();return this.getValueOfPropertyAt(d.l,d.c,J)}_getCurrentCharIndex(){const d=this.get2DCursorLocation(this.selectionStart,!0),g=d.charIndex>0?d.charIndex-1:0;return{l:d.lineIndex,c:g}}dispose(){this._exitEditing(),this.draggableTextDelegate.dispose(),super.dispose()}}t(Io,"ownDefaults",Ko),t(Io,"type","IText"),at.setClass(Io),at.setClass(Io,"i-text");class Bo extends Io{static getDefaults(){return s(s({},super.getDefaults()),Bo.ownDefaults)}constructor(d,g){super(d,s(s({},Bo.ownDefaults),g))}static createControls(){return{controls:pi()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(mo)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(d){let g=0,_=0,x=0;const b={};for(let S=0;S<d.graphemeLines.length;S++)"\n"===d.graphemeText[x]&&S>0?(_=0,x++,g++):!this.splitByGrapheme&&this._reSpaceAndTab.test(d.graphemeText[x])&&S>0&&(_++,x++),b[S]={line:g,offset:_},x+=d.graphemeLines[S].length,_+=d.graphemeLines[S].length;return b}styleHas(d,g){if(this._styleMap&&!this.isWrapping){const d=this._styleMap[g];d&&(g=d.line)}return super.styleHas(d,g)}isEmptyStyles(d){if(!this.styles)return!0;let g,_=0,x=d+1,b=!1;const S=this._styleMap[d],w=this._styleMap[d+1];S&&(d=S.line,_=S.offset),w&&(x=w.line,b=x===d,g=w.offset);const T=void 0===d?this.styles:{line:this.styles[d]};for(const d in T)for(const x in T[d]){const S=parseInt(x,10);if(S>=_&&(!b||S<g))for(const g in T[d][x])return!1}return!0}_getStyleDeclaration(d,g){if(this._styleMap&&!this.isWrapping){const _=this._styleMap[d];if(!_)return{};d=_.line,g=_.offset+g}return super._getStyleDeclaration(d,g)}_setStyleDeclaration(d,g,_){const x=this._styleMap[d];super._setStyleDeclaration(x.line,x.offset+g,_)}_deleteStyleDeclaration(d,g){const _=this._styleMap[d];super._deleteStyleDeclaration(_.line,_.offset+g)}_getLineStyle(d){const g=this._styleMap[d];return!!this.styles[g.line]}_setLineStyle(d){const g=this._styleMap[d];super._setLineStyle(g.line)}_wrapText(d,g){this.isWrapping=!0;const _=this.getGraphemeDataForRender(d),x=[];for(let d=0;d<_.wordsData.length;d++)x.push(...this._wrapLine(d,g,_));return this.isWrapping=!1,x}getGraphemeDataForRender(d){const g=this.splitByGrapheme,_=g?"":" ";let x=0;return{wordsData:d.map(((d,b)=>{let S=0;const w=g?this.graphemeSplit(d):this.wordSplit(d);return 0===w.length?[{word:[],width:0}]:w.map((d=>{const w=g?[d]:this.graphemeSplit(d),T=this._measureWord(w,b,S);return x=Math.max(T,x),S+=w.length+_.length,{word:w,width:T}}))})),largestWordWidth:x}}_measureWord(d,g){let _,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=0;for(let S=0,w=d.length;S<w;S++)b+=this._getGraphemeBox(d[S],g,S+x,_,true).kernedWidth,_=d[S];return b}wordSplit(d){return d.split(this._wordJoiners)}_wrapLine(d,g,_){let{largestWordWidth:x,wordsData:b}=_,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const w=this._getWidthOfCharSpacing(),T=this.splitByGrapheme,O=[],D=T?"":" ";let k=0,M=[],P=0,E=0,A=!0;g-=S;const j=Math.max(g,x,this.dynamicMinWidth),F=b[d];let L;for(P=0,L=0;L<F.length;L++){const{word:g,width:_}=F[L];P+=g.length,k+=E+_-w,k>j&&!A?(O.push(M),M=[],k=_,A=!0):k+=w,A||T||M.push(D),M=M.concat(g),E=T?0:this._measureWord([D],d,P),P++,A=!1}return L&&O.push(M),x+S>this.dynamicMinWidth&&(this.dynamicMinWidth=x-w+S),O}isEndOfWrapping(d){return!this._styleMap[d+1]||this._styleMap[d+1].line!==this._styleMap[d].line}missingNewlineOffset(d,g){return this.splitByGrapheme&&!g?this.isEndOfWrapping(d)?1:0:1}_splitTextIntoLines(d){const g=super._splitTextIntoLines(d),_=this._wrapText(g.lines,this.width),x=new Array(_.length);for(let d=0;d<_.length;d++)x[d]=_[d].join("");return g.lines=x,g.graphemeLines=_,g}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const d=new Map;for(const g in this._styleMap){const _=parseInt(g,10);if(this._textLines[_]){const _=this._styleMap[g].line;d.set("".concat(_),!0)}}for(const g in this.styles)d.has(g)||delete this.styles[g]}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...d])}}t(Bo,"type","Textbox"),t(Bo,"textLayoutProperties",[...Io.textLayoutProperties,"width"]),t(Bo,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),at.setClass(Bo);class Xo extends xr{shouldPerformLayout(d){return!!d.target.clipPath&&super.shouldPerformLayout(d)}shouldLayoutClipPath(){return!1}calcLayoutResult(d,g){const{target:_}=d,{clipPath:x,group:b}=_;if(!x||!this.shouldPerformLayout(d))return;const{width:S,height:w}=me(_r(_,x)),T=new ot(S,w);if(x.absolutePositioned)return{center:Se(x.getRelativeCenterPoint(),void 0,b?b.calcTransformMatrix():void 0),size:T};{const b=x.getRelativeCenterPoint().transform(_.calcOwnMatrix(),!0);if(this.shouldPerformLayout(d)){const{center:_=new ot,correction:x=new ot}=this.calcBoundingBox(g,d)||{};return{center:_.add(b),correction:x.subtract(b),size:T}}return{center:_.getRelativeCenterPoint().add(b),size:T}}}}t(Xo,"type","clip-path"),at.setClass(Xo);class Wo extends xr{getInitialSize(d,g){let{target:_}=d,{size:x}=g;return new ot(_.width||x.x,_.height||x.y)}}t(Wo,"type","fixed"),at.setClass(Wo);class Yo extends Tr{subscribeTargets(d){const g=d.target;d.targets.reduce(((d,g)=>(g.parent&&d.add(g.parent),d)),new Set).forEach((d=>{d.layoutManager.subscribeTargets({target:d,targets:[g]})}))}unsubscribeTargets(d){const g=d.target,_=g.getObjects();d.targets.reduce(((d,g)=>(g.parent&&d.add(g.parent),d)),new Set).forEach((d=>{!_.some((g=>g.parent===d))&&d.layoutManager.unsubscribeTargets({target:d,targets:[g]})}))}}class Vo extends Dr{static getDefaults(){return s(s({},super.getDefaults()),Vo.ownDefaults)}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,Vo.ownDefaults),this.setOptions(g);const{left:_,top:x,layoutManager:b}=g;this.groupInit(d,{left:_,top:x,layoutManager:null!=b?b:new Yo})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var d=arguments.length,g=new Array(d),_=0;_<d;_++)g[_]=arguments[_];"selection-order"===this.multiSelectionStacking?this.add(...g):g.forEach((d=>{const g=this._objects.findIndex((g=>g.isInFrontOf(d))),_=-1===g?this.size():g;this.insertAt(_,d)}))}canEnterGroup(d){return this.getObjects().some((g=>g.isDescendantOf(d)||d.isDescendantOf(g)))?(a("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(d)}enterGroup(d,g){d.parent&&d.parent===d.group?d.parent._exitGroup(d):d.group&&d.parent!==d.group&&d.group.remove(d),this._enterGroup(d,g)}exitGroup(d,g){this._exitGroup(d,g),d.parent&&d.parent._enterGroup(d,!0)}_onAfterObjectsChange(d,g){super._onAfterObjectsChange(d,g);const _=new Set;g.forEach((d=>{const{parent:g}=d;g&&_.add(g)})),d===br?_.forEach((d=>{d._onAfterObjectsChange(yr,g)})):_.forEach((d=>{d._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(d,g,_){d.save(),d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const x=s(s({hasControls:!1},_),{},{forActiveSelection:!0});for(let g=0;g<this._objects.length;g++)this._objects[g]._renderControls(d,x);super._renderControls(d,g),d.restore()}}t(Vo,"type","ActiveSelection"),t(Vo,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),at.setClass(Vo),at.setClass(Vo,"activeSelection");class Ho{constructor(){t(this,"resources",{})}applyFilters(d,g,_,x,b){const S=b.getContext("2d");if(!S)return;S.drawImage(g,0,0,_,x);const w={sourceWidth:_,sourceHeight:x,imageData:S.getImageData(0,0,_,x),originalEl:g,originalImageData:S.getImageData(0,0,_,x),canvasEl:b,ctx:S,filterBackend:this};d.forEach((d=>{d.applyTo(w)}));const{imageData:T}=w;return T.width===_&&T.height===x||(b.width=T.width,b.height=T.height),S.putImageData(T,0,0),w}}class zo{constructor(){let{tileSize:g=d.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),t(this,"resources",{}),this.tileSize=g,this.setupGLContext(g,g),this.captureGPUInfo()}setupGLContext(d,g){this.dispose(),this.createWebGLCanvas(d,g)}createWebGLCanvas(d,g){const _=pt();_.width=d,_.height=g;const x=_.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});x&&(x.clearColor(0,0,0,0),this.canvas=_,this.gl=x)}applyFilters(d,g,_,x,b,S){const w=this.gl,T=b.getContext("2d");if(!w||!T)return;let O;S&&(O=this.getCachedTexture(S,g));const D={originalWidth:g.width||g.originalWidth||0,originalHeight:g.height||g.originalHeight||0,sourceWidth:_,sourceHeight:x,destinationWidth:_,destinationHeight:x,context:w,sourceTexture:this.createTexture(w,_,x,O?void 0:g),targetTexture:this.createTexture(w,_,x),originalTexture:O||this.createTexture(w,_,x,O?void 0:g),passes:d.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:b},k=w.createFramebuffer();return w.bindFramebuffer(w.FRAMEBUFFER,k),d.forEach((d=>{d&&d.applyTo(D)})),function(d){const g=d.targetCanvas,_=g.width,x=g.height,b=d.destinationWidth,S=d.destinationHeight;_===b&&x===S||(g.width=b,g.height=S)}(D),this.copyGLTo2D(w,D),w.bindTexture(w.TEXTURE_2D,null),w.deleteTexture(D.sourceTexture),w.deleteTexture(D.targetTexture),w.deleteFramebuffer(k),T.setTransform(1,0,0,1,0,0),D}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(d,g,_,x,b){const{NEAREST:S,TEXTURE_2D:w,RGBA:T,UNSIGNED_BYTE:O,CLAMP_TO_EDGE:D,TEXTURE_MAG_FILTER:k,TEXTURE_MIN_FILTER:M,TEXTURE_WRAP_S:P,TEXTURE_WRAP_T:E}=d,A=d.createTexture();return d.bindTexture(w,A),d.texParameteri(w,k,b||S),d.texParameteri(w,M,b||S),d.texParameteri(w,P,D),d.texParameteri(w,E,D),x?d.texImage2D(w,0,T,T,O,x):d.texImage2D(w,0,T,g,_,0,T,O,null),A}getCachedTexture(d,g,_){const{textureCache:x}=this;if(x[d])return x[d];{const b=this.createTexture(this.gl,g.width,g.height,g,_);return b&&(x[d]=b),b}}evictCachesForKey(d){this.textureCache[d]&&(this.gl.deleteTexture(this.textureCache[d]),delete this.textureCache[d])}copyGLTo2D(d,g){const _=d.canvas,x=g.targetCanvas,b=x.getContext("2d");if(!b)return;b.translate(0,x.height),b.scale(1,-1);const S=_.height-x.height;b.drawImage(_,0,S,x.width,x.height,0,0,x.width,x.height)}copyGLTo2DPutImageData(d,g){const _=g.targetCanvas.getContext("2d"),x=g.destinationWidth,b=g.destinationHeight,S=x*b*4;if(!_)return;const w=new Uint8Array(this.imageBuffer,0,S),T=new Uint8ClampedArray(this.imageBuffer,0,S);d.readPixels(0,0,x,b,d.RGBA,d.UNSIGNED_BYTE,w);const O=new ImageData(T,x,b);_.putImageData(O,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const d=this.gl,g={renderer:"",vendor:""};if(!d)return g;const _=d.getExtension("WEBGL_debug_renderer_info");if(_){const x=d.getParameter(_.UNMASKED_RENDERER_WEBGL),b=d.getParameter(_.UNMASKED_VENDOR_WEBGL);x&&(g.renderer=x.toLowerCase()),b&&(g.vendor=b.toLowerCase())}return this.gpuInfo=g,g}}let Jo;function No(){const{WebGLProbe:g}=p();return g.queryWebGL(pt()),d.enableGLFiltering&&g.isSupported(d.textureSize)?new zo({tileSize:d.textureSize}):new Ho}function Uo(){return!Jo&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(Jo=No()),Jo}function qo(d){Jo=d}const ta=["filters","resizeFilter","src","crossOrigin","type"],sa=["cropX","cropY"];class Qo extends yi{static getDefaults(){return s(s({},super.getDefaults()),Qo.ownDefaults)}constructor(d,g){super(),t(this,"_lastScaleX",1),t(this,"_lastScaleY",1),t(this,"_filterScalingX",1),t(this,"_filterScalingY",1),this.filters=[],Object.assign(this,Qo.ownDefaults),this.setOptions(g),this.cacheKey="texture".concat(ft()),this.setElement("string"==typeof d?(this.canvas&&re(this.canvas.getElement())||m()).getElementById(d):d,g)}getElement(){return this._element}setElement(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=d,this._originalElement=d,this._setWidthHeight(g),d.classList.add(Qo.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(d){const g=Uo(!1);g instanceof zo&&g.evictCachesForKey(d)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((d=>{const g=this[d];g&&p().dispose(g),this[d]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const d=this.getElement();return d?{width:d.naturalWidth||d.width,height:d.naturalHeight||d.height}:{width:0,height:0}}_stroke(d){if(!this.stroke||0===this.strokeWidth)return;const g=this.width/2,_=this.height/2;d.beginPath(),d.moveTo(-g,-_),d.lineTo(g,-_),d.lineTo(g,_),d.lineTo(-g,_),d.lineTo(-g,-_),d.closePath()}toObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const g=[];return this.filters.forEach((d=>{d&&g.push(d.toObject())})),s(s({},super.toObject([...sa,...d])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:g},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const d=[],g=this._element,_=-this.width/2,x=-this.height/2;let b=[],S=[],w="",T="";if(!g)return[];if(this.hasCrop()){const d=ft();b.push('<clipPath id="imageCrop_'+d+'">\n','\t<rect x="'+_+'" y="'+x+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),w=' clip-path="url(#imageCrop_'+d+')" '}if(this.imageSmoothing||(T=' image-rendering="optimizeSpeed"'),d.push("\t<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(_-this.cropX,'" y="').concat(x-this.cropY,'" width="').concat(g.width||g.naturalWidth,'" height="').concat(g.height||g.naturalHeight,'"').concat(T).concat(w,"></image>\n")),this.stroke||this.strokeDashArray){const d=this.fill;this.fill=null,S=['\t<rect x="'.concat(_,'" y="').concat(x,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=d}return b=this.paintFirst!==J?b.concat(S,d):b.concat(d,S),b}getSrc(d){const g=d?this._element:this._originalElement;return g?g.toDataURL?g.toDataURL():this.srcFromAttribute?g.getAttribute("src")||"":g.src:this.src||""}getSvgSrc(d){return this.getSrc(d)}setSrc(d){let{crossOrigin:g,signal:_}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Lt(d,{crossOrigin:g,signal:_}).then((d=>{void 0!==g&&this.set({crossOrigin:g}),this.setElement(d)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const d=this.resizeFilter,g=this.minimumScaleTrigger,_=this.getTotalObjectScaling(),x=_.x,b=_.y,S=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!d||x>g&&b>g)return this._element=S,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=x,void(this._lastScaleY=b);const w=pt(),T=S.width,O=S.height;w.width=T,w.height=O,this._element=w,this._lastScaleX=d.scaleX=x,this._lastScaleY=d.scaleY=b,Uo().applyFilters([d],S,T,O,this._element),this._filterScalingX=w.width/this._originalElement.width,this._filterScalingY=w.height/this._originalElement.height}applyFilters(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(d=d.filter((d=>d&&!d.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===d.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const g=this._originalElement,_=g.naturalWidth||g.width,x=g.naturalHeight||g.height;if(this._element===this._originalElement){const d=pt();d.width=_,d.height=x,this._element=d,this._filteredEl=d}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,_,x),this._lastScaleX=1,this._lastScaleY=1);Uo().applyFilters(d,this._originalElement,_,x,this._element),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(d){d.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(d),this._renderPaintInOrder(d)}drawCacheOnCanvas(d){d.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(d)}shouldCache(){return this.needsItsOwnCache()}_renderFill(d){const g=this._element;if(!g)return;const _=this._filterScalingX,x=this._filterScalingY,b=this.width,S=this.height,w=Math.max(this.cropX,0),T=Math.max(this.cropY,0),O=g.naturalWidth||g.width,D=g.naturalHeight||g.height,k=w*_,M=T*x,P=Math.min(b*_,O-k),E=Math.min(S*x,D-M),A=-b/2,j=-S/2,F=Math.min(b,O/_-w),L=Math.min(S,D/x-T);g&&d.drawImage(g,k,M,P,E,A,j,F,L)}_needsResize(){const d=this.getTotalObjectScaling();return d.x!==this._lastScaleX||d.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:d,height:g}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const _=this.getOriginalSize();this.width=d||_.width,this.height=g||_.height}parsePreserveAspectRatioAttribute(){const d=Kt(this.preserveAspectRatio||""),g=this.width,_=this.height,x={width:g,height:_};let b,S=this._element.width,w=this._element.height,T=1,O=1,D=0,k=0,M=0,P=0;return!d||d.alignX===F&&d.alignY===F?(T=g/S,O=_/w):("meet"===d.meetOrSlice&&(T=O=Mr(this._element,x),b=(g-S*T)/2,"Min"===d.alignX&&(D=-b),"Max"===d.alignX&&(D=b),b=(_-w*O)/2,"Min"===d.alignY&&(k=-b),"Max"===d.alignY&&(k=b)),"slice"===d.meetOrSlice&&(T=O=Pr(this._element,x),b=S-g/T,"Mid"===d.alignX&&(M=b/2),"Max"===d.alignX&&(M=b),b=w-_/O,"Mid"===d.alignY&&(P=b/2),"Max"===d.alignY&&(P=b),S=g/T,w=_/O)),{width:S,height:w,scaleX:T,scaleY:O,offsetLeft:D,offsetTop:k,cropX:M,cropY:P}}static fromObject(d,g){let{filters:_,resizeFilter:x,src:b,crossOrigin:S,type:w}=d,T=i(d,ta);return Promise.all([Lt(b,s(s({},g),{},{crossOrigin:S})),_&&Rt(_,g),x&&Rt([x],g),It(T,g)]).then((d=>{let[g,_=[],[x]=[],S={}]=d;return new this(g,s(s({},T),{},{src:b,filters:_,resizeFilter:x},S))}))}static fromURL(d){let{crossOrigin:g=null,signal:_}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;return Lt(d,{crossOrigin:g,signal:_}).then((d=>new this(d,x)))}static async fromElement(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;const x=ur(d,this.ATTRIBUTE_NAMES,_);return this.fromURL(x["xlink:href"],g,x).catch((d=>(a("log","Unable to parse Image",d),null)))}}function Zo(d){if(!Qe.test(d.nodeName))return{};const g=d.getAttribute("viewBox");let _,x,b=1,S=1,w=0,T=0;const O=d.getAttribute("width"),D=d.getAttribute("height"),k=d.getAttribute("x")||0,M=d.getAttribute("y")||0,P=!(g&&Ze.test(g)),E=!O||!D||"100%"===O||"100%"===D;let A="",j=0,L=0;if(P&&(k||M)&&d.parentNode&&"#document"!==d.parentNode.nodeName&&(A=" translate("+qt(k||"0")+" "+qt(M||"0")+") ",_=(d.getAttribute("transform")||"")+A,d.setAttribute("transform",_),d.removeAttribute("x"),d.removeAttribute("y")),P&&E)return{width:0,height:0};const B={width:0,height:0};if(P)return B.width=qt(O),B.height=qt(D),B;const R=g.match(Ze);w=-parseFloat(R[1]),T=-parseFloat(R[2]);const X=parseFloat(R[3]),W=parseFloat(R[4]);B.minX=w,B.minY=T,B.viewBoxWidth=X,B.viewBoxHeight=W,E?(B.width=X,B.height=W):(B.width=qt(O),B.height=qt(D),b=B.width/X,S=B.height/W);const Y=Kt(d.getAttribute("preserveAspectRatio")||"");if(Y.alignX!==F&&("meet"===Y.meetOrSlice&&(S=b=b>S?S:b),"slice"===Y.meetOrSlice&&(S=b=b>S?b:S),j=B.width-X*b,L=B.height-W*b,"Mid"===Y.alignX&&(j/=2),"Mid"===Y.alignY&&(L/=2),"Min"===Y.alignX&&(j=0),"Min"===Y.alignY&&(L=0)),1===b&&1===S&&0===w&&0===T&&0===k&&0===M)return B;if((k||M)&&"#document"!==d.parentNode.nodeName&&(A=" translate("+qt(k||"0")+" "+qt(M||"0")+") "),_=A+" matrix("+b+" 0 0 "+S+" "+(w*b+j)+" "+(T*S+L)+") ","svg"===d.nodeName){for(x=d.ownerDocument.createElementNS(Ge,"g");d.firstChild;)x.appendChild(d.firstChild);d.appendChild(x)}else x=d,x.removeAttribute("x"),x.removeAttribute("y"),_=x.getAttribute("transform")+_;return x.setAttribute("transform",_),B}t(Qo,"type","Image"),t(Qo,"cacheProperties",[...Cs,...sa]),t(Qo,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),t(Qo,"CSS_CANVAS","canvas-img"),t(Qo,"ATTRIBUTE_NAMES",[...Xi,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]),at.setClass(Qo),at.setSVGClass(Qo);const $o=d=>d.tagName.replace("svg:",""),ia=Xe(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function ea(d,g){let _,x,b,S,w=[];for(b=0,S=g.length;b<S;b++)_=g[b],x=d.getElementsByTagNameNS("http://www.w3.org/2000/svg",_),w=w.concat(Array.from(x));return w}const na=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],fa="xlink:href";function ra(d,g){var _;const x=(null===(_=g.getAttribute(fa))||void 0===_?void 0:_.slice(1))||"",b=d.getElementById(x);if(b&&b.getAttribute(fa)&&ra(d,b),b&&(na.forEach((d=>{const _=b.getAttribute(d);!g.hasAttribute(d)&&_&&g.setAttribute(d,_)})),!g.children.length)){const d=b.cloneNode(!0);for(;d.firstChild;)g.appendChild(d.firstChild)}g.removeAttribute(fa)}const Ta=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function oa(d){const g=d.getElementsByTagName("style");let _,x;const b={};for(_=0,x=g.length;_<x;_++){const d=(g[_].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");""!==d.trim()&&d.split("}").filter(((d,g,_)=>_.length>1&&d.trim())).forEach((d=>{if((d.match(/{/g)||[]).length>1&&d.trim().startsWith("@"))return;const g=d.split("{"),S={},w=g[1].trim().split(";").filter((function(d){return d.trim()}));for(_=0,x=w.length;_<x;_++){const d=w[_].split(":"),g=d[0].trim(),x=d[1].trim();S[g]=x}(d=g[0].trim()).split(",").forEach((d=>{""!==(d=d.replace(/^svg/i,"").trim())&&(b[d]=s(s({},b[d]||{}),S))}))}))}return b}const aa=d=>at.getSVGClass($o(d).toLowerCase());class ha{constructor(d,g,_,x,b){this.elements=d,this.options=g,this.reviver=_,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=x,this.clipPaths=b,this.gradientDefs=function(d){const g=ea(d,Ta),_={};let x=g.length;for(;x--;){const b=g[x];b.getAttribute("xlink:href")&&ra(d,b);const S=b.getAttribute("id");S&&(_[S]=b)}return _}(x),this.cssRules=oa(x)}parse(){return Promise.all(this.elements.map((d=>this.createObject(d))))}async createObject(d){const g=aa(d);if(g){const _=await g.fromElement(d,this.options,this.cssRules);return this.resolveGradient(_,d,J),this.resolveGradient(_,d,Z),_ instanceof Qo&&_._originalElement?cn(_,_.parsePreserveAspectRatioAttribute()):cn(_),await this.resolveClipPath(_,d),this.reviver&&this.reviver(d,_),_}return null}extractPropertyDefinition(d,g,_){const x=d[g],b=this.regexUrl;if(!b.test(x))return;b.lastIndex=0;const S=b.exec(x)[1];return b.lastIndex=0,_[S]}resolveGradient(d,g,_){const x=this.extractPropertyDefinition(d,_,this.gradientDefs);if(x){const b=g.getAttribute(_+"-opacity"),S=Ln.fromElement(x,d,s(s({},this.options),{},{opacity:b}));d.set(_,S)}}async resolveClipPath(d,g){const _=this.extractPropertyDefinition(d,"clipPath",this.clipPaths);if(_){const x=bt(d.calcTransformMatrix()),b=_[0].parentElement;let S=g;for(;S.parentElement&&S.getAttribute("clip-path")!==d.clipPath;)S=S.parentElement;S.parentElement.appendChild(b);const w=nr("".concat(S.getAttribute("transform")||""," ").concat(b.getAttribute("originalTransform")||""));b.setAttribute("transform","matrix(".concat(w.join(","),")"));const T=await Promise.all(_.map((d=>aa(d).fromElement(d,this.options,this.cssRules).then((d=>(cn(d),d.fillRule=d.clipRule,delete d.clipRule,d)))))),O=1===T.length?T[0]:new Dr(T),D=wt(x,O.calcTransformMatrix());O.clipPath&&await this.resolveClipPath(O,S);const{scaleX:k,scaleY:P,angle:E,skewX:A,translateX:j,translateY:F}=Ot(D);O.set({flipX:!1,flipY:!1}),O.set({scaleX:k,scaleY:P,angle:E,skewX:A,skewY:0}),O.setPositionByOrigin(new ot(j,F),M,M),d.clipPath=O}else delete d.clipPath}}const ca=d=>Ke.test($o(d)),la=()=>({objects:[],elements:[],options:{},allElements:[]});async function ua(d,g){let{crossOrigin:_,signal:x}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(x&&x.aborted)return a("log",new c("parseSVGDocument")),la();const b=d.documentElement;!function(d){const g=ea(d,["use","svg:use"]),_=["x","y","xlink:href","href","transform"];for(const x of g){const g=x.attributes,b={};for(const d of g)d.value&&(b[d.name]=d.value);const S=(b["xlink:href"]||b.href||"").slice(1);if(""===S)return;const w=d.getElementById(S);if(null===w)return;let T=w.cloneNode(!0);const O=T.attributes,D={};for(const d of O)d.value&&(D[d.name]=d.value);const{x:k=0,y:M=0,transform:P=""}=b,E="".concat(P," ").concat(D.transform||""," translate(").concat(k,", ").concat(M,")");if(Zo(T),/^svg$/i.test(T.nodeName)){const d=T.ownerDocument.createElementNS(Ge,"g");Object.entries(D).forEach((g=>{let[_,x]=g;return d.setAttributeNS(Ge,_,x)})),d.append(...T.childNodes),T=d}for(const d of g){if(!d)continue;const{name:g,value:x}=d;if(!_.includes(g))if("style"===g){const d={};hr(x,d),Object.entries(D).forEach((g=>{let[_,x]=g;d[_]=x})),hr(D.style||"",d);const _=Object.entries(d).map((d=>d.join(":"))).join(";");T.setAttribute(g,_)}else!D[g]&&T.setAttribute(g,x)}T.setAttribute("transform",E),T.setAttribute("instantiated_by_use","1"),T.removeAttribute("id"),x.parentNode.replaceChild(T,x)}}(d);const S=Array.from(b.getElementsByTagName("*")),w=s(s({},Zo(b)),{},{crossOrigin:_,signal:x}),T=S.filter((d=>(Zo(d),ca(d)&&!function(d){let g=d;for(;g&&(g=g.parentElement);)if(g&&g.nodeName&&ia.test($o(g))&&!g.getAttribute("instantiated_by_use"))return!0;return!1}(d))));if(!T||T&&!T.length)return s(s({},la()),{},{options:w,allElements:S});const O={};S.filter((d=>"clipPath"===$o(d))).forEach((d=>{d.setAttribute("originalTransform",d.getAttribute("transform")||"");const g=d.getAttribute("id");O[g]=Array.from(d.getElementsByTagName("*")).filter((d=>ca(d)))}));const D=new ha(T,w,g,d,O);return{objects:await D.parse(),elements:T,options:w,allElements:S}}function da(d,g,_){return ua((new(v().DOMParser)).parseFromString(d.trim(),"text/xml"),g,_)}function ga(d,g){let _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((g,x)=>{hn(d.replace(/^\n\s*/,"").trim(),{onComplete:d=>{const _=d.responseXML;_&&g(_),x()},signal:_.signal})})).then((d=>ua(d,g,_))).catch((()=>la()))}const Da=z,pa=d=>function(g,_,x){const{points:b,pathOffset:S}=x;return new ot(b[d]).subtract(S).transform(wt(x.getViewportTransform(),x.calcTransformMatrix()))},ma=(d,g,_,x)=>{const{target:b,pointIndex:S}=g,w=b,T=Se(new ot(_,x),void 0,w.calcOwnMatrix());return w.points[S]=T.add(w.pathOffset),w.setDimensions(),!0},va=(d,g)=>function(_,x,b,S){const w=x.target,T=new ot(w.points[(d>0?d:w.points.length)-1]),O=T.subtract(w.pathOffset).transform(w.calcOwnMatrix()),D=g(_,s(s({},x),{},{pointIndex:d}),b,S),k=T.subtract(w.pathOffset).transform(w.calcOwnMatrix()).subtract(O);return w.left-=k.x,w.top-=k.y,D},ya=d=>Xs(Da,va(d,ma));const _a=(d,g,_)=>{const{path:x,pathOffset:b}=d,S=x[g];return new ot(S[_]-b.x,S[_+1]-b.y).transform(wt(d.getViewportTransform(),d.calcTransformMatrix()))};function xa(d,g,_){const{commandIndex:x,pointIndex:b}=this;return _a(_,x,b)}function Ca(d,g,_,x){const{target:b}=g,{commandIndex:S,pointIndex:w}=this,T=((d,g,_,x,b)=>{const{path:S,pathOffset:w}=d,T=S[(x>0?x:S.length)-1],O=new ot(T[b],T[b+1]),D=O.subtract(w).transform(d.calcOwnMatrix()),k=Se(new ot(g,_),void 0,d.calcOwnMatrix());S[x][b]=k.x+w.x,S[x][b+1]=k.y+w.y,d.setDimensions();const M=O.subtract(d.pathOffset).transform(d.calcOwnMatrix()).subtract(D);return d.left-=M.x,d.top-=M.y,d.set("dirty",!0),!0})(b,_,x,S,w);return ke(this.actionName,s(s({},Fe(d,g,_,x)),{},{commandIndex:S,pointIndex:w})),T}class ba extends zs{constructor(d){super(d)}render(d,g,_,x,b){const S=s(s({},x),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(d,g,_,S,b)}}class wa extends ba{constructor(d){super(d)}render(d,g,_,x,b){const{path:S}=b,{commandIndex:w,pointIndex:T,connectToCommandIndex:O,connectToPointIndex:D}=this;d.save(),d.strokeStyle=this.controlStroke,this.connectionDashArray&&d.setLineDash(this.connectionDashArray);const[k]=S[w],M=_a(b,O,D);if("Q"===k){const x=_a(b,w,T+2);d.moveTo(x.x,x.y),d.lineTo(g,_)}else d.moveTo(g,_);d.lineTo(M.x,M.y),d.stroke(),d.restore(),super.render(d,g,_,x,b)}}const Sa=(d,g,_,x,b,S)=>new(_?wa:ba)(s(s({commandIndex:d,pointIndex:g,actionName:"modifyPath",positionHandler:xa,actionHandler:Ca,connectToCommandIndex:b,connectToPointIndex:S},x),_?x.controlPointStyle:x.pointStyle));var Ma=Object.freeze({__proto__:null,changeWidth:Ks,createObjectDefaultControls:gi,createPathControls:function(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const _={};let x="M";return d.path.forEach(((d,b)=>{const S=d[0];switch("Z"!==S&&(_["c_".concat(b,"_").concat(S)]=Sa(b,d.length-2,!1,g)),S){case"C":_["c_".concat(b,"_C_CP_1")]=Sa(b,1,!0,g,b-1,(d=>"C"===d?5:"Q"===d?3:1)(x)),_["c_".concat(b,"_C_CP_2")]=Sa(b,3,!0,g,b,5);break;case"Q":_["c_".concat(b,"_Q_CP_1")]=Sa(b,1,!0,g,b,3)}x=S})),_},createPolyActionHandler:ya,createPolyControls:function(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const _={};for(let x=0;x<("number"==typeof d?d:d.points.length);x++)_["p".concat(x)]=new zs(s({actionName:Da,positionHandler:pa(x),actionHandler:ya(x)},g));return _},createPolyPositionHandler:pa,createResizeControls:fi,createTextboxDefaultControls:pi,dragHandler:Ie,factoryPolyActionHandler:va,getLocalPoint:Re,polyActionHandler:ma,renderCircleControl:Vs,renderSquareControl:Hs,rotationStyleHandler:Gs,rotationWithSnapping:Zs,scaleCursorStyleHandler:Js,scaleOrSkewActionName:ci,scaleSkewCursorStyleHandler:li,scalingEqually:ti,scalingX:ei,scalingXOrSkewingY:ui,scalingY:si,scalingYOrSkewingX:di,skewCursorStyleHandler:ri,skewHandlerX:oi,skewHandlerY:ai,wrapWithFireEvent:Xs,wrapWithFixedAnchor:Ws});const Oa=d=>void 0!==d.webgl,ka=(d,g)=>{const _=pt(),x=pt().getContext("webgl"),b={imageBuffer:new ArrayBuffer(d*g*4)},S={destinationWidth:d,destinationHeight:g,targetCanvas:_};let w;_.width=d,_.height=g,w=v().performance.now(),zo.prototype.copyGLTo2D.call(b,x,S);const T=v().performance.now()-w;w=v().performance.now(),zo.prototype.copyGLTo2DPutImageData.call(b,x,S);return T>v().performance.now()-w},Pa="precision highp float",Ea="\n    ".concat(Pa,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),Aa=["type"],Fa=["type"],Ra=new RegExp(Pa,"g");class ja{get type(){return this.constructor.type}constructor(){let d=i(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Aa);Object.assign(this,this.constructor.defaults,d)}getFragmentSource(){return Ea}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"}createProgram(d){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:x="highp"}}=p();"highp"!==x&&(g=g.replace(Ra,Pa.replace("highp",x)));const b=d.createShader(d.VERTEX_SHADER),S=d.createShader(d.FRAGMENT_SHADER),w=d.createProgram();if(!b||!S||!w)throw new h("Vertex, fragment shader or program creation error");if(d.shaderSource(b,_),d.compileShader(b),!d.getShaderParameter(b,d.COMPILE_STATUS))throw new h("Vertex shader compile error for ".concat(this.type,": ").concat(d.getShaderInfoLog(b)));if(d.shaderSource(S,g),d.compileShader(S),!d.getShaderParameter(S,d.COMPILE_STATUS))throw new h("Fragment shader compile error for ".concat(this.type,": ").concat(d.getShaderInfoLog(S)));if(d.attachShader(w,b),d.attachShader(w,S),d.linkProgram(w),!d.getProgramParameter(w,d.LINK_STATUS))throw new h('Shader link error for "'.concat(this.type,'" ').concat(d.getProgramInfoLog(w)));const T=this.getUniformLocations(d,w)||{};return T.uStepW=d.getUniformLocation(w,"uStepW"),T.uStepH=d.getUniformLocation(w,"uStepH"),{program:w,attributeLocations:this.getAttributeLocations(d,w),uniformLocations:T}}getAttributeLocations(d,g){return{aPosition:d.getAttribLocation(g,"aPosition")}}getUniformLocations(d,g){const _=this.constructor.uniformLocations,x={};for(let b=0;b<_.length;b++)x[_[b]]=d.getUniformLocation(g,_[b]);return x}sendAttributeData(d,g,_){const x=g.aPosition,b=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,b),d.enableVertexAttribArray(x),d.vertexAttribPointer(x,2,d.FLOAT,!1,0,0),d.bufferData(d.ARRAY_BUFFER,_,d.STATIC_DRAW)}_setupFrameBuffer(d){const g=d.context;if(d.passes>1){const _=d.destinationWidth,x=d.destinationHeight;d.sourceWidth===_&&d.sourceHeight===x||(g.deleteTexture(d.targetTexture),d.targetTexture=d.filterBackend.createTexture(g,_,x)),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,d.targetTexture,0)}else g.bindFramebuffer(g.FRAMEBUFFER,null),g.finish()}_swapTextures(d){d.passes--,d.pass++;const g=d.targetTexture;d.targetTexture=d.sourceTexture,d.sourceTexture=g}isNeutralState(d){return!1}applyTo(d){Oa(d)?(this._setupFrameBuffer(d),this.applyToWebGL(d),this._swapTextures(d)):this.applyTo2d(d)}applyTo2d(d){}getCacheKey(){return this.type}retrieveShader(d){const g=this.getCacheKey();return d.programCache[g]||(d.programCache[g]=this.createProgram(d.context)),d.programCache[g]}applyToWebGL(d){const g=d.context,_=this.retrieveShader(d);0===d.pass&&d.originalTexture?g.bindTexture(g.TEXTURE_2D,d.originalTexture):g.bindTexture(g.TEXTURE_2D,d.sourceTexture),g.useProgram(_.program),this.sendAttributeData(g,_.attributeLocations,d.aPosition),g.uniform1f(_.uniformLocations.uStepW,1/d.sourceWidth),g.uniform1f(_.uniformLocations.uStepH,1/d.sourceHeight),this.sendUniformData(g,_.uniformLocations),g.viewport(0,0,d.destinationWidth,d.destinationHeight),g.drawArrays(g.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(d,g,_){d.activeTexture(_),d.bindTexture(d.TEXTURE_2D,g),d.activeTexture(d.TEXTURE0)}unbindAdditionalTexture(d,g){d.activeTexture(g),d.bindTexture(d.TEXTURE_2D,null),d.activeTexture(d.TEXTURE0)}sendUniformData(d,g){}createHelpLayer(d){if(!d.helpLayer){const g=pt();g.width=d.sourceWidth,g.height=d.sourceHeight,d.helpLayer=g}}toObject(){const d=Object.keys(this.constructor.defaults||{});return s({type:this.type},d.reduce(((d,g)=>(d[g]=this[g],d)),{}))}toJSON(){return this.toObject()}static async fromObject(d,g){return new this(i(d,Fa))}}t(ja,"type","BaseFilter"),t(ja,"uniformLocations",[]);const Ia={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class La extends ja{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(Ia[this.mode],"\n        }\n      }\n      ")}applyTo2d(d){let{imageData:{data:g}}=d;const _=new Nt(this.color).getSource(),x=_[0]*this.alpha,b=_[1]*this.alpha,S=_[2]*this.alpha,w=1-this.alpha;for(let d=0;d<g.length;d+=4){const _=g[d],T=g[d+1],O=g[d+2];switch(this.mode){case"multiply":g[d]=_*x/255,g[d+1]=T*b/255,g[d+2]=O*S/255;break;case"screen":g[d]=255-(255-_)*(255-x)/255,g[d+1]=255-(255-T)*(255-b)/255,g[d+2]=255-(255-O)*(255-S)/255;break;case"add":g[d]=_+x,g[d+1]=T+b,g[d+2]=O+S;break;case"difference":g[d]=Math.abs(_-x),g[d+1]=Math.abs(T-b),g[d+2]=Math.abs(O-S);break;case"subtract":g[d]=_-x,g[d+1]=T-b,g[d+2]=O-S;break;case"darken":g[d]=Math.min(_,x),g[d+1]=Math.min(T,b),g[d+2]=Math.min(O,S);break;case"lighten":g[d]=Math.max(_,x),g[d+1]=Math.max(T,b),g[d+2]=Math.max(O,S);break;case"overlay":g[d]=x<128?2*_*x/255:255-2*(255-_)*(255-x)/255,g[d+1]=b<128?2*T*b/255:255-2*(255-T)*(255-b)/255,g[d+2]=S<128?2*O*S/255:255-2*(255-O)*(255-S)/255;break;case"exclusion":g[d]=x+_-2*x*_/255,g[d+1]=b+T-2*b*T/255,g[d+2]=S+O-2*S*O/255;break;case"tint":g[d]=x+_*w,g[d+1]=b+T*w,g[d+2]=S+O*w}}}sendUniformData(d,g){const _=new Nt(this.color).getSource();_[0]=this.alpha*_[0]/255,_[1]=this.alpha*_[1]/255,_[2]=this.alpha*_[2]/255,_[3]=this.alpha,d.uniform4fv(g.uColor,_)}}t(La,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),t(La,"type","BlendColor"),t(La,"uniformLocations",["uColor"]),at.setClass(La);const za={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},Ga=["type","image"];class Ba extends ja{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return za[this.mode]}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}applyToWebGL(d){const g=d.context,_=this.createTexture(d.filterBackend,this.image);this.bindAdditionalTexture(g,_,g.TEXTURE1),super.applyToWebGL(d),this.unbindAdditionalTexture(g,g.TEXTURE1)}createTexture(d,g){return d.getCachedTexture(g.cacheKey,g.getElement())}calculateMatrix(){const d=this.image,{width:g,height:_}=d.getElement();return[1/d.scaleX,0,0,0,1/d.scaleY,0,-d.left/g,-d.top/_,1]}applyTo2d(d){let{imageData:{data:g,width:_,height:x},filterBackend:{resources:b}}=d;const S=this.image;b.blendImage||(b.blendImage=pt());const w=b.blendImage,T=w.getContext("2d");w.width!==_||w.height!==x?(w.width=_,w.height=x):T.clearRect(0,0,_,x),T.setTransform(S.scaleX,0,0,S.scaleY,S.left,S.top),T.drawImage(S.getElement(),0,0,_,x);const O=T.getImageData(0,0,_,x).data;for(let d=0;d<g.length;d+=4){const _=g[d],x=g[d+1],b=g[d+2],S=g[d+3],w=O[d],T=O[d+1],D=O[d+2],k=O[d+3];switch(this.mode){case"multiply":g[d]=_*w/255,g[d+1]=x*T/255,g[d+2]=b*D/255,g[d+3]=S*k/255;break;case"mask":g[d+3]=k}}}sendUniformData(d,g){const _=this.calculateMatrix();d.uniform1i(g.uImage,1),d.uniformMatrix3fv(g.uTransformMatrix,!1,_)}toObject(){return s(s({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(d,g){let{type:_,image:x}=d,b=i(d,Ga);return Qo.fromObject(x,g).then((d=>new this(s(s({},b),{},{image:d}))))}}t(Ba,"type","BlendImage"),t(Ba,"defaults",{mode:"multiply",alpha:1}),t(Ba,"uniformLocations",["uTransformMatrix","uImage"]),at.setClass(Ba);class Xa extends ja{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float total = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        float weight = 1.0 - abs(percent);\n        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\n        total += weight;\n      }\n      gl_FragColor = color / total;\n    }\n  "}applyTo(d){Oa(d)?(this.aspectRatio=d.sourceWidth/d.sourceHeight,d.passes++,this._setupFrameBuffer(d),this.horizontal=!0,this.applyToWebGL(d),this._swapTextures(d),this._setupFrameBuffer(d),this.horizontal=!1,this.applyToWebGL(d),this._swapTextures(d)):this.applyTo2d(d)}applyTo2d(d){d.imageData=this.simpleBlur(d)}simpleBlur(d){let{ctx:g,imageData:_,filterBackend:{resources:x}}=d;const{width:b,height:S}=_;x.blurLayer1||(x.blurLayer1=pt(),x.blurLayer2=pt());const w=x.blurLayer1,T=x.blurLayer2;w.width===b&&w.height===S||(T.width=w.width=b,T.height=w.height=S);const O=w.getContext("2d"),D=T.getContext("2d"),k=15,M=.06*this.blur*.5;let P,E,A,j;for(O.putImageData(_,0,0),D.clearRect(0,0,b,S),j=-15;j<=k;j++)P=(Math.random()-.5)/4,E=j/k,A=M*E*b+P,D.globalAlpha=1-Math.abs(E),D.drawImage(w,A,P),O.drawImage(T,0,0),D.globalAlpha=1,D.clearRect(0,0,T.width,T.height);for(j=-15;j<=k;j++)P=(Math.random()-.5)/4,E=j/k,A=M*E*S+P,D.globalAlpha=1-Math.abs(E),D.drawImage(w,P,A),O.drawImage(T,0,0),D.globalAlpha=1,D.clearRect(0,0,T.width,T.height);g.drawImage(w,0,0);const F=g.getImageData(0,0,w.width,w.height);return O.globalAlpha=1,O.clearRect(0,0,w.width,w.height),F}sendUniformData(d,g){const _=this.chooseRightDelta();d.uniform2fv(g.uDelta,_)}isNeutralState(){return 0===this.blur}chooseRightDelta(){let d=1;const g=[0,0];this.horizontal?this.aspectRatio>1&&(d=1/this.aspectRatio):this.aspectRatio<1&&(d=this.aspectRatio);const _=d*this.blur*.12;return this.horizontal?g[0]=_:g[1]=_,g}}t(Xa,"type","Blur"),t(Xa,"defaults",{blur:0}),t(Xa,"uniformLocations",["uDelta"]),at.setClass(Xa);class Wa extends ja{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(d){let{imageData:{data:g}}=d;const _=Math.round(255*this.brightness);for(let d=0;d<g.length;d+=4)g[d]=g[d]+_,g[d+1]=g[d+1]+_,g[d+2]=g[d+2]+_}isNeutralState(){return 0===this.brightness}sendUniformData(d,g){d.uniform1f(g.uBrightness,this.brightness)}}t(Wa,"type","Brightness"),t(Wa,"defaults",{brightness:0}),t(Wa,"uniformLocations",["uBrightness"]),at.setClass(Wa);class Ya extends ja{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(d){const g=d.imageData.data,_=this.matrix,x=this.colorsOnly;for(let d=0;d<g.length;d+=4){const b=g[d],S=g[d+1],w=g[d+2];if(x)g[d]=b*_[0]+S*_[1]+w*_[2]+255*_[4],g[d+1]=b*_[5]+S*_[6]+w*_[7]+255*_[9],g[d+2]=b*_[10]+S*_[11]+w*_[12]+255*_[14];else{const x=g[d+3];g[d]=b*_[0]+S*_[1]+w*_[2]+x*_[3]+255*_[4],g[d+1]=b*_[5]+S*_[6]+w*_[7]+x*_[8]+255*_[9],g[d+2]=b*_[10]+S*_[11]+w*_[12]+x*_[13]+255*_[14],g[d+3]=b*_[15]+S*_[16]+w*_[17]+x*_[18]+255*_[19]}}}sendUniformData(d,g){const _=this.matrix,x=[_[0],_[1],_[2],_[3],_[5],_[6],_[7],_[8],_[10],_[11],_[12],_[13],_[15],_[16],_[17],_[18]],b=[_[4],_[9],_[14],_[19]];d.uniformMatrix4fv(g.uColorMatrix,!1,x),d.uniform4fv(g.uConstants,b)}toObject(){return s(s({},super.toObject()),{},{matrix:[...this.matrix]})}}function Va(d,g){var _;const x=(t(_=class extends Ya{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",d),t(_,"defaults",{colorsOnly:!1,matrix:g}),_);return at.setClass(x,d),x}t(Ya,"type","ColorMatrix"),t(Ya,"defaults",{matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0}),t(Ya,"uniformLocations",["uColorMatrix","uConstants"]),at.setClass(Ya);const Na=Va("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),Ha=Va("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),Ua=Va("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),qa=Va("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),Ka=Va("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),Za=Va("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),th=Va("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class Ja extends ja{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(d),this.subFilters=d.subFilters||[]}applyTo(d){Oa(d)&&(d.passes+=this.subFilters.length-1),this.subFilters.forEach((g=>{g.applyTo(d)}))}toObject(){return{type:this.type,subFilters:this.subFilters.map((d=>d.toObject()))}}isNeutralState(){return!this.subFilters.some((d=>!d.isNeutralState()))}static fromObject(d,g){return Promise.all((d.subFilters||[]).map((d=>at.getClass(d.type).fromObject(d,g)))).then((d=>new this({subFilters:d})))}}t(Ja,"type","Composed"),at.setClass(Ja);class Qa extends ja{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}isNeutralState(){return 0===this.contrast}applyTo2d(d){let{imageData:{data:g}}=d;const _=Math.floor(255*this.contrast),x=259*(_+255)/(255*(259-_));for(let d=0;d<g.length;d+=4)g[d]=x*(g[d]-128)+128,g[d+1]=x*(g[d+1]-128)+128,g[d+2]=x*(g[d+2]-128)+128}sendUniformData(d,g){d.uniform1f(g.uContrast,this.contrast)}}t(Qa,"type","Contrast"),t(Qa,"defaults",{contrast:0}),t(Qa,"uniformLocations",["uContrast"]),at.setClass(Qa);const sh={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class $a extends ja{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return sh[this.getCacheKey()]}applyTo2d(d){const g=d.imageData,_=g.data,x=this.matrix,b=Math.round(Math.sqrt(x.length)),S=Math.floor(b/2),w=g.width,T=g.height,O=d.ctx.createImageData(w,T),D=O.data,k=this.opaque?1:0;let M,P,E,A,j,F,L,B,R,X,W,Y,V;for(W=0;W<T;W++)for(X=0;X<w;X++){for(j=4*(W*w+X),M=0,P=0,E=0,A=0,V=0;V<b;V++)for(Y=0;Y<b;Y++)L=W+V-S,F=X+Y-S,L<0||L>=T||F<0||F>=w||(B=4*(L*w+F),R=x[V*b+Y],M+=_[B]*R,P+=_[B+1]*R,E+=_[B+2]*R,k||(A+=_[B+3]*R));D[j]=M,D[j+1]=P,D[j+2]=E,D[j+3]=k?_[j+3]:A}d.imageData=O}sendUniformData(d,g){d.uniform1fv(g.uMatrix,this.matrix)}toObject(){return s(s({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}t($a,"type","Convolute"),t($a,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),t($a,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),at.setClass($a);const dh="Gamma";class eh extends ja{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(d),this.gamma=d.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(d){let{imageData:{data:g}}=d;const _=this.gamma,x=1/_[0],b=1/_[1],S=1/_[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const w=this.rgbValues;for(let d=0;d<256;d++)w.r[d]=255*Math.pow(d/255,x),w.g[d]=255*Math.pow(d/255,b),w.b[d]=255*Math.pow(d/255,S);for(let d=0;d<g.length;d+=4)g[d]=w.r[g[d]],g[d+1]=w.g[g[d+1]],g[d+2]=w.b[g[d+2]]}sendUniformData(d,g){d.uniform3fv(g.uGamma,this.gamma)}isNeutralState(){const{gamma:d}=this;return 1===d[0]&&1===d[1]&&1===d[2]}toObject(){return{type:dh,gamma:this.gamma.concat()}}}t(eh,"type",dh),t(eh,"defaults",{gamma:[1,1,1]}),t(eh,"uniformLocations",["uGamma"]),at.setClass(eh);const gh={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class ih extends ja{applyTo2d(d){let{imageData:{data:g}}=d;for(let d,_=0;_<g.length;_+=4){switch(this.mode){case"average":d=(g[_]+g[_+1]+g[_+2])/3;break;case"lightness":d=(Math.min(g[_],g[_+1],g[_+2])+Math.max(g[_],g[_+1],g[_+2]))/2;break;case"luminosity":d=.21*g[_]+.72*g[_+1]+.07*g[_+2]}g[_]=d,g[_+1]=d,g[_+2]=d}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return gh[this.mode]}sendUniformData(d,g){d.uniform1i(g.uMode,1)}isNeutralState(){return!1}}t(ih,"type","Grayscale"),t(ih,"defaults",{mode:"average"}),t(ih,"uniformLocations",["uMode"]),at.setClass(ih);class rh extends Ya{calculateMatrix(){const d=this.rotation*Math.PI,g=rt(d),_=nt(d),x=1/3,b=Math.sqrt(x)*_,S=1-g;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=g+S/3,this.matrix[1]=x*S-b,this.matrix[2]=x*S+b,this.matrix[5]=x*S+b,this.matrix[6]=g+x*S,this.matrix[7]=x*S-b,this.matrix[10]=x*S-b,this.matrix[11]=x*S+b,this.matrix[12]=g+x*S}isNeutralState(){return 0===this.rotation}applyTo(d){this.calculateMatrix(),super.applyTo(d)}toObject(){return{type:this.type,rotation:this.rotation}}}t(rh,"type","HueRotation"),t(rh,"defaults",{rotation:0}),at.setClass(rh);class nh extends ja{applyTo2d(d){let{imageData:{data:g}}=d;for(let d=0;d<g.length;d+=4)g[d]=255-g[d],g[d+1]=255-g[d+1],g[d+2]=255-g[d+2],this.alpha&&(g[d+3]=255-g[d+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}sendUniformData(d,g){d.uniform1i(g.uInvert,Number(this.invert)),d.uniform1i(g.uAlpha,Number(this.alpha))}}t(nh,"type","Invert"),t(nh,"defaults",{alpha:!1,invert:!0}),t(nh,"uniformLocations",["uInvert","uAlpha"]),at.setClass(nh);class oh extends ja{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(d){let{imageData:{data:g}}=d;const _=this.noise;for(let d=0;d<g.length;d+=4){const x=(.5-Math.random())*_;g[d]+=x,g[d+1]+=x,g[d+2]+=x}}sendUniformData(d,g){d.uniform1f(g.uNoise,this.noise/255),d.uniform1f(g.uSeed,Math.random())}isNeutralState(){return 0===this.noise}}t(oh,"type","Noise"),t(oh,"defaults",{noise:0}),t(oh,"uniformLocations",["uNoise","uSeed"]),at.setClass(oh);class ah extends ja{applyTo2d(d){let{imageData:{data:g,width:_,height:x}}=d;for(let d=0;d<x;d+=this.blocksize)for(let b=0;b<_;b+=this.blocksize){const S=4*d*_+4*b,w=g[S],T=g[S+1],O=g[S+2],D=g[S+3];for(let S=d;S<Math.min(d+this.blocksize,x);S++)for(let d=b;d<Math.min(b+this.blocksize,_);d++){const x=4*S*_+4*d;g[x]=w,g[x+1]=T,g[x+2]=O,g[x+3]=D}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}sendUniformData(d,g){d.uniform1f(g.uBlocksize,this.blocksize)}}t(ah,"type","Pixelate"),t(ah,"defaults",{blocksize:4}),t(ah,"uniformLocations",["uBlocksize"]),at.setClass(ah);class hh extends ja{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(d){let{imageData:{data:g}}=d;const _=255*this.distance,x=new Nt(this.color).getSource(),b=[x[0]-_,x[1]-_,x[2]-_],S=[x[0]+_,x[1]+_,x[2]+_];for(let d=0;d<g.length;d+=4){const _=g[d],x=g[d+1],w=g[d+2];_>b[0]&&x>b[1]&&w>b[2]&&_<S[0]&&x<S[1]&&w<S[2]&&(g[d+3]=0)}}sendUniformData(d,g){const _=new Nt(this.color).getSource(),x=this.distance,b=[0+_[0]/255-x,0+_[1]/255-x,0+_[2]/255-x,1],S=[_[0]/255+x,_[1]/255+x,_[2]/255+x,1];d.uniform4fv(g.uLow,b),d.uniform4fv(g.uHigh,S)}}t(hh,"type","RemoveColor"),t(hh,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),t(hh,"uniformLocations",["uLow","uHigh"]),at.setClass(hh);class ch extends ja{sendUniformData(d,g){d.uniform2fv(g.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),d.uniform1fv(g.uTaps,this.taps)}getFilterWindow(){const d=this.tempScale;return Math.ceil(this.lanczosLobes/d)}getCacheKey(){const d=this.getFilterWindow();return"".concat(this.type,"_").concat(d)}getFragmentSource(){const d=this.getFilterWindow();return this.generateShader(d)}getTaps(){const d=this.lanczosCreate(this.lanczosLobes),g=this.tempScale,_=this.getFilterWindow(),x=new Array(_);for(let b=1;b<=_;b++)x[b-1]=d(b*g);return x}generateShader(d){const g=new Array(d);for(let _=1;_<=d;_++)g[_-1]="".concat(_,".0 * uDelta");return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec2 uDelta;\n      varying vec2 vTexCoord;\n      uniform float uTaps[".concat(d,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(g.map(((d,g)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(d,") * uTaps[").concat(g,"] + texture2D(uTexture, vTexCoord - ").concat(d,") * uTaps[").concat(g,"];\n              sum += 2.0 * uTaps[").concat(g,"];\n            "))).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyToForWebgl(d){d.passes++,this.width=d.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=d.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),d.destinationWidth=this.dW,super.applyTo(d),d.sourceWidth=d.destinationWidth,this.height=d.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),d.destinationHeight=this.dH,super.applyTo(d),d.sourceHeight=d.destinationHeight}applyTo(d){Oa(d)?this.applyToForWebgl(d):this.applyTo2d(d)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(d){return g=>{if(g>=d||g<=-d)return 0;if(g<1.1920929e-7&&g>-1.1920929e-7)return 1;const _=(g*=Math.PI)/d;return Math.sin(g)/g*Math.sin(_)/_}}applyTo2d(d){const g=d.imageData,_=this.scaleX,x=this.scaleY;this.rcpScaleX=1/_,this.rcpScaleY=1/x;const b=g.width,S=g.height,w=Math.round(b*_),T=Math.round(S*x);let O;O="sliceHack"===this.resizeType?this.sliceByTwo(d,b,S,w,T):"hermite"===this.resizeType?this.hermiteFastResize(d,b,S,w,T):"bilinear"===this.resizeType?this.bilinearFiltering(d,b,S,w,T):"lanczos"===this.resizeType?this.lanczosResize(d,b,S,w,T):new ImageData(w,T),d.imageData=O}sliceByTwo(d,g,_,x,b){const S=d.imageData,w=.5;let T=!1,O=!1,D=g*w,k=_*w;const M=d.filterBackend.resources;let P=0,E=0;const A=g;let j=0;M.sliceByTwo||(M.sliceByTwo=pt());const F=M.sliceByTwo;(F.width<1.5*g||F.height<_)&&(F.width=1.5*g,F.height=_);const L=F.getContext("2d");for(L.clearRect(0,0,1.5*g,_),L.putImageData(S,0,0),x=Math.floor(x),b=Math.floor(b);!T||!O;)g=D,_=k,x<Math.floor(D*w)?D=Math.floor(D*w):(D=x,T=!0),b<Math.floor(k*w)?k=Math.floor(k*w):(k=b,O=!0),L.drawImage(F,P,E,g,_,A,j,D,k),P=A,E=j,j+=k;return L.getImageData(P,E,x,b)}lanczosResize(d,g,_,x,b){const S=d.imageData.data,w=d.ctx.createImageData(x,b),T=w.data,O=this.lanczosCreate(this.lanczosLobes),D=this.rcpScaleX,k=this.rcpScaleY,M=2/this.rcpScaleX,P=2/this.rcpScaleY,E=Math.ceil(D*this.lanczosLobes/2),A=Math.ceil(k*this.lanczosLobes/2),j={},F={x:0,y:0},L={x:0,y:0};return function t(d){let B,R,X,W,Y,V,z,G,N,H,U;for(F.x=(d+.5)*D,L.x=Math.floor(F.x),B=0;B<b;B++){for(F.y=(B+.5)*k,L.y=Math.floor(F.y),Y=0,V=0,z=0,G=0,N=0,R=L.x-E;R<=L.x+E;R++)if(!(R<0||R>=g)){H=Math.floor(1e3*Math.abs(R-F.x)),j[H]||(j[H]={});for(let d=L.y-A;d<=L.y+A;d++)d<0||d>=_||(U=Math.floor(1e3*Math.abs(d-F.y)),j[H][U]||(j[H][U]=O(Math.sqrt(Math.pow(H*M,2)+Math.pow(U*P,2))/1e3)),X=j[H][U],X>0&&(W=4*(d*g+R),Y+=X,V+=X*S[W],z+=X*S[W+1],G+=X*S[W+2],N+=X*S[W+3]))}W=4*(B*x+d),T[W]=V/Y,T[W+1]=z/Y,T[W+2]=G/Y,T[W+3]=N/Y}return++d<x?t(d):w}(0)}bilinearFiltering(d,g,_,x,b){let S,w,T,O,D,k,M,P,E,A,j,F,L,B=0;const R=this.rcpScaleX,X=this.rcpScaleY,W=4*(g-1),Y=d.imageData.data,V=d.ctx.createImageData(x,b),z=V.data;for(M=0;M<b;M++)for(P=0;P<x;P++)for(D=Math.floor(R*P),k=Math.floor(X*M),E=R*P-D,A=X*M-k,L=4*(k*g+D),j=0;j<4;j++)S=Y[L+j],w=Y[L+4+j],T=Y[L+W+j],O=Y[L+W+4+j],F=S*(1-E)*(1-A)+w*E*(1-A)+T*A*(1-E)+O*E*A,z[B++]=F;return V}hermiteFastResize(d,g,_,x,b){const S=this.rcpScaleX,w=this.rcpScaleY,T=Math.ceil(S/2),O=Math.ceil(w/2),D=d.imageData.data,k=d.ctx.createImageData(x,b),M=k.data;for(let d=0;d<b;d++)for(let _=0;_<x;_++){const b=4*(_+d*x);let k=0,P=0,E=0,A=0,j=0,F=0,L=0;const B=(d+.5)*w;for(let x=Math.floor(d*w);x<(d+1)*w;x++){const d=Math.abs(B-(x+.5))/O,b=(_+.5)*S,w=d*d;for(let d=Math.floor(_*S);d<(_+1)*S;d++){let _=Math.abs(b-(d+.5))/T;const S=Math.sqrt(w+_*_);S>1&&S<-1||(k=2*S*S*S-3*S*S+1,k>0&&(_=4*(d+x*g),L+=k*D[_+3],E+=k,D[_+3]<255&&(k=k*D[_+3]/250),A+=k*D[_],j+=k*D[_+1],F+=k*D[_+2],P+=k))}}M[b]=A/P,M[b+1]=j/P,M[b+2]=F/P,M[b+3]=L/E}return k}}t(ch,"type","Resize"),t(ch,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),t(ch,"uniformLocations",["uDelta","uTaps"]),at.setClass(ch);class lh extends ja{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(d){let{imageData:{data:g}}=d;const _=-this.saturation;for(let d=0;d<g.length;d+=4){const x=Math.max(g[d],g[d+1],g[d+2]);g[d]+=x!==g[d]?(x-g[d])*_:0,g[d+1]+=x!==g[d+1]?(x-g[d+1])*_:0,g[d+2]+=x!==g[d+2]?(x-g[d+2])*_:0}}sendUniformData(d,g){d.uniform1f(g.uSaturation,-this.saturation)}isNeutralState(){return 0===this.saturation}}t(lh,"type","Saturation"),t(lh,"defaults",{saturation:0}),t(lh,"uniformLocations",["uSaturation"]),at.setClass(lh);class uh extends ja{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(d){let{imageData:{data:g}}=d;const _=-this.vibrance;for(let d=0;d<g.length;d+=4){const x=Math.max(g[d],g[d+1],g[d+2]),b=(g[d]+g[d+1]+g[d+2])/3,S=2*Math.abs(x-b)/255*_;g[d]+=x!==g[d]?(x-g[d])*S:0,g[d+1]+=x!==g[d+1]?(x-g[d+1])*S:0,g[d+2]+=x!==g[d+2]?(x-g[d+2])*S:0}}sendUniformData(d,g){d.uniform1f(g.uVibrance,-this.vibrance)}isNeutralState(){return 0===this.vibrance}}t(uh,"type","Vibrance"),t(uh,"defaults",{vibrance:0}),t(uh,"uniformLocations",["uVibrance"]),at.setClass(uh);var fh=Object.freeze({__proto__:null,BaseFilter:ja,BlackWhite:th,BlendColor:La,BlendImage:Ba,Blur:Xa,Brightness:Wa,Brownie:Na,ColorMatrix:Ya,Composed:Ja,Contrast:Qa,Convolute:$a,Gamma:eh,Grayscale:ih,HueRotation:rh,Invert:nh,Kodachrome:Ua,Noise:oh,Pixelate:ah,Polaroid:Ka,RemoveColor:hh,Resize:ch,Saturation:lh,Sepia:Za,Technicolor:qa,Vibrance:uh,Vintage:Ha});export{Vo as ActiveSelection,Bn as BaseBrush,Ns as BaseFabricObject,xn as Canvas,Ho as Canvas2dFilterBackend,un as CanvasDOMManager,Gn as Circle,Nn as CircleBrush,Xo as ClipPathLayout,Nt as Color,zs as Control,eo as Ellipse,Qo as FabricImage,yi as FabricObject,So as FabricText,Cr as FitContentLayout,Wo as FixedLayout,Ln as Gradient,Dr as Group,Io as IText,Qo as Image,mi as InteractiveFabricObject,Fs as Intersection,Tr as LayoutManager,xr as LayoutStrategy,Zn as Line,yi as Object,st as Observable,Yn as Path,In as Pattern,qn as PatternBrush,Vn as PencilBrush,ot as Point,oo as Polygon,no as Polyline,fr as Rect,us as Shadow,Un as SprayBrush,ue as StaticCanvas,ce as StaticCanvasDOMManager,So as Text,Bo as Textbox,$n as Triangle,zo as WebGLFilterBackend,x as cache,at as classRegistry,d as config,Ma as controlsUtils,ct as createCollectionMixin,fh as filters,oa as getCSSRules,p as getEnv,m as getFabricDocument,v as getFabricWindow,Uo as getFilterBackend,O as iMatrix,No as initFilterBackend,ka as isPutImageFaster,Oa as isWebGLPipelineState,da as loadSVGFromString,ga as loadSVGFromURL,ur as parseAttributes,ar as parseFontDeclaration,so as parsePointsAttribute,ua as parseSVGDocument,cr as parseStyleAttribute,nr as parseTransformAttribute,gt as runningAnimations,f as setEnv,qo as setFilterBackend,pn as util,b as version};

